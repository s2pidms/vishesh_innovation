"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9692],{99692:(ht,v,l)=>{l.r(v),l.d(v,{BookSalesOrderModule:()=>ut});var d=l(96814),h=l(1076),_=l(43818),g=l(25116),S=l(79250),t=l(65879),u=l(99328),T=l(59840),b=l(88059),f=l(37285),A=l(53421);function D(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",21,22)(9,"span",23),t._uU(10),t.qZA()(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td")(18,"div",24),t._UZ(19,"button",25),t.TgZ(20,"div",26)(21,"a",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",r,"view"))}),t._UZ(22,"i",28),t._uU(23," View "),t.qZA(),t.TgZ(24,"a",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",r,"edit"))}),t._UZ(25,"i",29),t._uU(26," Edit "),t.qZA(),t.TgZ(27,"a",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",r,"cancel"))}),t._UZ(28,"i",30),t._uU(29," Cancel "),t.qZA(),t.TgZ(30,"a",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",r,"approve"))}),t._UZ(31,"i",31),t._uU(32," Approve "),t.qZA(),t.TgZ(33,"a",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.update(r,"Report Generated"))}),t._UZ(34,"img",32),t._uU(35," Generate Report "),t.qZA(),t.TgZ(36,"a",27),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.navigateToPrint("/#/print/so_confirmation",r,"print","previewSO"))}),t._UZ(37,"i",33),t._uU(38," Preview SO "),t.qZA()()()()()}if(2&s){const e=c.$implicit,o=t.MAs(8),n=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.SONumber),t.xp6(2),t.Oqu(null==e?null:e.SODateS),t.xp6(2),t.Oqu(null==e?null:e.salesCategory),t.xp6(1),t.Udp("width",o.clientWidth),t.xp6(2),t.Q6J("positionTarget",o)("ngbTooltip",e.customerName),t.xp6(1),t.hij(" ",e.customerName," "),t.xp6(2),t.Oqu(null==e?null:e.currency),t.xp6(2),t.Oqu(null==e?null:e.SOTotalAmount),t.xp6(2),t.Oqu(null==e?null:e.SOStatus),t.xp6(5),t.Q6J("accessType",n.rolePermissionActions.viewAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.SOStatus)),t.Q6J("accessType",n.rolePermissionActions.editAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.SOStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.SOStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Created"===(null==e?null:e.SOStatus)),t.Q6J("accessType",n.rolePermissionActions.generateReportAction),t.xp6(3),t.Q6J("accessType",n.rolePermissionActions.createAction)}}const U=function(s,c,e,o){return{page:s,pageSize:c,collection:e,search:o,type:"list"}};let x=(()=>{class s{constructor(e,o,n,r,i,p,m){this.exportExcelService=e,this.salesService=o,this.toastService=n,this.spinner=r,this.activatedRoute=i,this.exportToPDFService=p,this.utilityService=m,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Created","Approved"],this.rolePermissionActions=g.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(e,o,n){this.utilityService.navigateToForm({path:e,status:o.SOStatus,action:n,id:o._id,activatedRoute:this.activatedRoute})}trackByFn(e,o){return o?._id}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=e.value,this.getAll()}}navigateToPrint(e,o,n,r){window.open(`${window.location.origin}${e}?id=${o?._id}&action=${n}&preview=${r}`,"_blank")}update(e,o){"Approved"===e?.SOStatus&&(this.spinner.show(),this.salesService.update(e._id,{_id:e._id,SOStatus:o}).subscribe(n=>{this.toastService.success(n.message),this.getAll(),this.spinner.hide()}))}getAll(e=!1,o=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,excel:e,statusArray:this.statusArray};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.salesService.getAll(n).subscribe(r=>{"EXCEL"==o?this.excelDownload(r.rows):"PDF"==o?this.pdfDownload(r.rows):(this.tableData=r.rows,this.collection=r.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(e){let o=(0,S.p3)(e);this.exportToPDFService.generatePdf(o.tableData,o.title)}excelDownload(e){this.exportExcelService.exportExcel((0,S.U$)(e))}onSort({column:e,direction:o}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.column=e,this.direction="asc"==o?1:-1,this.getAll()}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(u.Ol),t.Y36(T.VD),t.Y36(u.kl),t.Y36(u.V),t.Y36(h.gz),t.Y36(u.$L),t.Y36(u.tI))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-bso-list"]],viewQuery:function(o,n){if(1&o&&t.Gf(_.j,5),2&o){let r;t.iGM(r=t.CRH())&&(n.headers=r)}},decls:32,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],["type","button",1,"btn","btn-primary","btn-add",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","SONumber",3,"sort"],["sortable","SODateS",3,"sort"],["sortable","salesCategory",3,"sort"],["sortable","customerName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","SOTotalAmount",3,"sort"],["sortable","SOStatus",3,"sort"],["sortable","status",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["customerName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa","fa-times","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","text-success"],["src","./assets/images/new.svg","width","14",1,"me-3"],["aria-hidden","true",1,"fa","fa-print","fa-lg","me-3","text-primary"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3," Sales Order (Entry)"),t.qZA()(),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return n.navigateTo("../form",{},"create")}),t._UZ(6,"i",5),t._uU(7," Generate Sales Order [SO] "),t.qZA()(),t._UZ(8,"hr",6),t.TgZ(9,"div",7)(10,"app-setting-header",8),t.NdJ("dataChange",function(i){return n.eventHeader(i)}),t.qZA(),t.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(15,"SO No."),t.qZA(),t.TgZ(16,"th",13),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(17,"SO Date"),t.qZA(),t.TgZ(18,"th",14),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(19,"Sales Category"),t.qZA(),t.TgZ(20,"th",15),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(21,"Customer Name"),t.qZA(),t.TgZ(22,"th",16),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(23,"Currency"),t.qZA(),t.TgZ(24,"th",17),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(25,"SO Value"),t.qZA(),t.TgZ(26,"th",18),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(27,"Status"),t.qZA(),t.TgZ(28,"th",19),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(29,"Action"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,D,39,25,"tr",20),t.qZA()()()()),2&o&&(t.xp6(4),t.Q6J("accessType",n.rolePermissionActions.createAction),t.xp6(6),t.Q6J("data",t.l5B(4,U,n.page,n.pageSize,n.collection,n.search)),t.xp6(21),t.Q6J("ngForOf",n.tableData)("ngForTrackBy",n.trackByFn))},dependencies:[d.sg,b.P,f._L,_.j,A.J],encapsulation:2})}return s})();var a=l(60095),N=l(21631),w=l(22096),y=l(77609),C=l(43154),F=l(46634),q=l(45622),M=l(5382),k=l(24992),J=l(16897),P=l(50363),Y=l(95346),B=l(14906),L=l(83344),I=l(84231);function Q(s,c){if(1&s&&(t.TgZ(0,"option",64),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.label," ")}}function R(s,c){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==e?null:e.orderedQty,"1.2-2")," ")}}const Z=function(){return{standalone:!0}};function E(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"input",74),t.NdJ("ngModelChange",function(n){t.CHM(e);const r=t.oxw().$implicit;return t.KtG(r.orderedQty=n)})("input",function(){t.CHM(e);const n=t.oxw().$implicit,r=t.oxw();return t.KtG(r.setLineValue(n))}),t.qZA()}if(2&s){const e=t.oxw().$implicit;t.Q6J("ngModel",e.orderedQty)("ngModelOptions",t.DdM(2,Z))}}function K(s,c){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&s){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==e?null:e.discount,"1.2-2")," ")}}function V(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"input",75),t.NdJ("ngModelChange",function(n){t.CHM(e);const r=t.oxw().$implicit;return t.KtG(r.discount=n)})("input",function(){t.CHM(e);const n=t.oxw().$implicit,r=t.oxw();return t.KtG(r.setNetRate(n))}),t.qZA()}if(2&s){const e=t.oxw().$implicit;t.Q6J("ngModel",e.discount)("ngModelOptions",t.DdM(2,Z))}}const O=function(){return["approve","reject","view","generate","cancel"]};function j(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",65,66)(5,"span",67),t._uU(6),t.qZA()(),t.TgZ(7,"td",65,68)(9,"span",67),t._uU(10),t.qZA()(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"SalesUOMUnitMaster"),t.qZA(),t.TgZ(16,"td")(17,"div",56),t.YNc(18,R,3,4,"span",69),t.YNc(19,E,1,3,"input",70),t.qZA()(),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"number"),t.qZA(),t.TgZ(23,"td")(24,"div",56),t.YNc(25,K,3,4,"span",69),t.YNc(26,V,1,3,"input",71),t.qZA()(),t.TgZ(27,"td"),t._uU(28),t.ALo(29,"number"),t.qZA(),t.TgZ(30,"td"),t._uU(31),t.ALo(32,"number"),t.qZA(),t.TgZ(33,"td")(34,"span",72),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.openSOScheduleModal(r))}),t._UZ(35,"div",73),t.qZA()()()}if(2&s){const e=c.$implicit,o=t.MAs(4),n=t.MAs(8),r=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.SKUNo),t.xp6(1),t.Udp("width",o.clientWidth),t.xp6(2),t.Q6J("positionTarget",o)("ngbTooltip",e.SKUName),t.xp6(1),t.hij(" ",e.SKUName," "),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",e.SKUDescription),t.xp6(1),t.hij(" ",e.SKUDescription," "),t.xp6(2),t.Oqu(null==e?null:e.customerPartNo),t.xp6(2),t.Oqu(t.lcZ(15,20,null==e?null:e.UOM)),t.xp6(4),t.Q6J("ngIf",t.DdM(31,O).includes(r.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(32,O).includes(r.action)),t.xp6(2),t.Oqu(t.xi3(22,22,null==e?null:e.standardRate,"1.2-2")),t.xp6(4),t.Q6J("ngIf",t.DdM(33,O).includes(r.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(34,O).includes(r.action)),t.xp6(2),t.Oqu(t.xi3(29,25,null==e?null:e.netRate,"1.2-2")),t.xp6(3),t.Oqu(t.xi3(32,28,null==e?null:e.lineValue,"1.2-2"))}}function G(s,c){1&s&&(t.TgZ(0,"div",76)(1,"div",77)(2,"div",78),t._uU(3," Reason for Cancellation"),t.TgZ(4,"span",79),t._uU(5,"*"),t.qZA(),t.TgZ(6,"span"),t._uU(7,"\u25b6"),t.qZA()(),t._UZ(8,"input",80),t.qZA()())}function H(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",81)(1,"button",82),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.reset())}),t._uU(2,"Reset"),t.qZA(),t.TgZ(3,"button",83),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.ESCPreview())}),t._uU(4," Esc "),t.qZA(),t.TgZ(5,"button",84),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.preview())}),t._uU(6,"Preview"),t.qZA(),t.TgZ(7,"button",85),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submit())}),t._uU(8," Save "),t.qZA()()}if(2&s){const e=t.oxw();t.xp6(3),t.Q6J("disabled",!e.isESCPreview),t.xp6(4),t.Q6J("disabled",!e.isPreview)}}function z(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",81)(1,"button",86),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submit())}),t._uU(2,"Save"),t.qZA()()}}function $(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",87)(1,"button",86),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.openCancelModal())}),t._uU(2,"Cancel"),t.qZA()()}}function X(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",87)(1,"button",86),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.submit())}),t._uU(2,"Approve"),t.qZA()()}}const W=function(s,c,e,o){return{page:s,pageSize:c,collection:e,search:o,excelDisplay:"none"}},tt=function(){return["create"]},et=function(){return["edit"]};let nt=(()=>{class s{trackByFn(e,o){return o?._id}constructor(e,o,n,r,i,p,m,pt,dt,mt){this.activatedRoute=e,this.spinner=o,this.menuTitleService=n,this.toastService=r,this.salesService=i,this.validationService=p,this.modalService=m,this.utilityService=pt,this.storageService=dt,this.location=mt,this.page=1,this.pageSize=6,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.flag=-1,this.SODetailsArray=[],this.openPONumberArr=[],this.customerOptions=[],this.selectedCustomer={},this.displayName={},this.selectedCustomerDetails={},this.submitted=!1,this.popupResponse="No",this.isPreview=!1,this.action="create",this.statusArr={create:"Created",edit:"Created",approve:"Approved",cancel:"Cancelled"},this.otherCharges={action:"create",packagingAndForwarding:0,freight:0,insurance:0,loadingAndUnloading:0,miscellaneous:0,totalAmount:0},this.SOTypeObj=g.LT,this.SOTypeArr=g.LT.getAllSOType(),this.ESCPreviewArr=[],this.isESCPreview=!1,this.masterData={autoIncrementNo:"",billFromLocationOptions:[],freightTermsOptions:[],modeOfTransportOptions:[],paymentTermsOptions:[],salesCategoryOptions:[],transporterOptions:[],customerOptions:[],companyData:{_id:"",placesOfBusiness:[]}},this.form=new a.nJ({_id:new a.p4(null),salesCategory:new a.p4(null,[a.kI.required]),customer:new a.p4(null,[a.kI.required]),SONumber:new a.p4(null),SODate:new a.p4(""),billFromLocation:new a.p4(null,[a.kI.required]),PONumber:new a.p4(null,[a.kI.required]),PODate:new a.p4("",[a.kI.required]),quotationProformaRef:new a.p4(null),currency:new a.p4(null),SOFileName:new a.p4(null),SOTargetDate:new a.p4(""),SOTotalAmount:new a.p4(null,[a.kI.required]),SODetails:new a.p4([]),customerShippingAddress:new a.p4({}),customerBillingAddress:new a.p4({}),SORemarks:new a.p4(null),SOCancellationReason:new a.p4(null),SOType:new a.p4(this.SOTypeObj.Regular),isActive:new a.p4(!0),SOStatus:new a.p4("Created",[a.kI.required]),billFromAddress:new a.p4({}),billToAddress:new a.p4({}),paymentTerms:new a.p4(null),modeOfTransport:new a.p4(null),frightCharge:new a.p4(null),frightTerms:new a.p4(null),transporter:new a.p4(null),destination:new a.p4(null)})}ngOnInit(){this.displayName=this.storageService.get("menuTitle")?.title,this.getInitialData()}get f(){return this.form.controls}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.page=1,this.flag=-1;break;case"EXCEL":default:break;case"PAGE":this.page=e.value}}submit(){if(this.submitted=!0,this.isPreview=!1,this.form.enable(),"cancel"!=this.action&&this.validationService.checkErrors(this.form,C.tm))return;if("cancel"==this.action&&!this.form.controls.SOCancellationReason.value)return void this.toastService.warning("Reason for Cancellation is Required");let e=this.form.value;if(e.otherCharges=this.otherCharges,e.popupResponse=this.popupResponse,e.SOTargetDate=this.utilityService.getTodayDate("YYYY-MM-DD"),e.SODetails=this.SODetailsArray,e.SODetails=this.SODetailsArray?.map(o=>(o.discount=o.discount??0,o)),this.SOTypeObj.Planned!=this.f.SOType.value)for(const o of e.SODetails)if(!o.dispatchSchedule||0==o.dispatchSchedule.length){let n=1;for(let r=0;r<n;r++)o.dispatchSchedule=[{scheduleNo:r+1,quantity:o.orderedQty,UOM:o.UOM,dispatchDate:o.SOLineTargetDate,PPICDate:o.SOLineTargetDate}],o.dispatchCount=1}if("cancel"!=this.action)for(let o=0;o<C.tm.length;o++){const n=C.tm[o];if(n.key&&!e[n.key])return void this.toastService.warning(n.message)}if(this.SOTypeObj.Planned==this.f.SOType.value||this.SOTypeObj.Regular==this.f.SOType.value){if("create"==this.action&&!e.SODetails.some(n=>n.dispatchSchedule))return void this.toastService.warning("Dispatch Schedule is required");if("edit"==this.action&&!e.SODetails.some(n=>n.dispatchSchedule.length>0))return void this.toastService.warning("Dispatch Schedule is required")}e._id?this.update(e):(delete e._id,this.create(e))}update(e){this.spinner.show(),this.salesService.update(e._id,e).subscribe(o=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(o.message),this.location.back()})}create(e){this.spinner.show(),this.salesService.create(e).subscribe(o=>{this.submitted=!1,this.spinner.hide(),"Yes"==o.POExists?this.openConfirmSOModal():(this.toastService.success(o.message),this.location.back())})}reset(){this.form.reset(),this.SODetailsArray=[],this.customerOptions=[],this.collection=this.SODetailsArray.length,this.openPONumberArr=[],this.getInitialData()}getInitialData(){this.spinner.show(),this.salesService.getAllMasterData({}).subscribe(e=>{this.masterData=e,this.form.controls.SONumber.setValue(this.masterData?.autoIncrementNo),this.form.controls.isActive.setValue(!0),this.form.controls.SOType.setValue(this.SOTypeObj.Regular),this.f.PODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.f.SODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.SOStatus.setValue(this.statusArr[this.action]),this.activatedRoute.queryParams.pipe((0,N.z)(o=>(this.action=o.action,this.utilityService.accessDenied(this.action),o.id?this.salesService.getById(o.id):(0,w.of)({})))).subscribe(o=>{this.spinner.hide(),0!=Object.keys(o).length&&(o.SODate&&(o.SODate=this.utilityService.getFormatDate(o?.SODate,"YYYY-MM-DD")),o.customer=o.customer._id,this.customerOptions=this.masterData?.customerOptions.filter(n=>n.salesCategory==o.customerCategory),o.PODate&&(o.PODate=this.utilityService.getFormatDate(o?.PODate,"YYYY-MM-DD")),o.SOTargetDate&&(o.SOTargetDate=this.utilityService.getFormatDate(o?.SOTargetDate,"YYYY-MM-DD")),this.selectedCustomer=this.masterData?.customerOptions.find(n=>n._id==o.customer),this.SODetailsArray=o?.SODetails.map((n,r)=>({SOLineNumber:n.SOLineNumber,SKU:n?.SKU?._id,SKUNo:n?.SKU?.SKUNo,SKUName:n?.SKU?.SKUName,SKUDescription:n.SKU?.SKUDescription,customerPartNo:n?.customerPartNo,UOM:n?.UOM,dispatchSchedule:n?.dispatchSchedule,dispatchCount:n?.dispatchCount,orderedQty:n?.orderedQty,balancedQty:n?.orderedQty,JCCQty:n?.orderedQty,standardRate:n?.standardRate,discount:n?.discount,netRate:n?.netRate,lineValue:n?.lineValue,SOLineTargetDate:this.utilityService.getFormatDate(n?.SOLineTargetDate,"YYYY-MM-DD")})),this.collection=this.SODetailsArray.length,this.otherCharges=o.otherCharges,o.SOStatus=this.statusArr[this.action],this.form.patchValue(o),("edit"==this.action||"view"==this.action||"cancel"==this.action||"approve"==this.action)&&(this.form.disable(),this.form.controls.SOCancellationReason.enable()))}),this.menuTitleService.set({title:"cancel"==this.action?"Sales Order Cancellation":`${this.displayName}`,subTitle:null,type:null})})}openCancelModal(){const e=this.modalService.open(y.er,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.heading="SO Cancellation",e.componentInstance.cancelText="Do You Want to Cancel Sales Order ?",e.result.then(o=>{"Yes"==o&&this.submit()},o=>{})}openConfirmSOModal(){const e=this.modalService.open(y.er,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.heading="SO Confirmation",e.componentInstance.cancelText="SO already created against this PO. still you want to create new SO against same PO",e.result.then(o=>{"Yes"==o&&(this.popupResponse="Yes",this.submit())},o=>{})}setDelivery(){this.SODetailsArray=this.SODetailsArray.map(e=>(e.SOLineTargetDate=this.utilityService.getFormatDate(this.f.SOLineTargetDate.value,"YYYY-MM-DD"),e))}customerValueChange(e){this.form.controls.PONumber.setValue(null),this.form.controls.PODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.paymentTerms.setValue(e.customerPaymentTerms),this.f.currency.setValue(e?.customerCurrency),this.selectedCustomer=e,this.salesService.getAllSalesSKUList({customerId:e?._id}).subscribe(o=>{this.SODetailsArray=o.SKUList.map((n,r)=>(n.SOLineNumber=1,n)),this.collection=this.SODetailsArray.length,this.openPONumberArr=o?.PODetails})}openPONumber(){const e=this.modalService.open(F.n,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.customerId=this.form.controls.customer.value,e.componentInstance.openPONumberArr=this.openPONumberArr,e.result.then(o=>{o&&["create","edit"].includes(this.action)&&(this.SODetailsArray=o?.SODetailsArray.map((n,r)=>(n.SOLineNumber=r+1,n)),this.collection=this.SODetailsArray.length,this.openPONumberArr=o.openPONumberArr,this.form.controls.PONumber.setValue(o?.selectedData?.PONo),this.form.controls.PODate.setValue(this.utilityService.getFormatDate(o?.selectedData?.PODate,"YYYY-MM-DD")))},o=>{})}getCustomers(){this.f.customer.setValue(null),this.f.currency.setValue(null),this.selectedCustomerDetails={},this.SODetailsArray=[],this.customerOptions=this.masterData?.customerOptions.filter(e=>e.customerCategory==this.f.salesCategory.value)}setLineValue(e){let o=this.SODetailsArray.findIndex(n=>n.SOLineNumber==e.SOLineNumber&&n.SKU==e.SKU);if((this.SODetailsArray[o].lineValue=+e.orderedQty*+e.netRate).toFixed(2),(this.SODetailsArray[o].balancedQty=+e.orderedQty).toFixed(2),(this.SODetailsArray[o].JCCQty=+e.orderedQty).toFixed(2),this.f.SOTotalAmount.setValue(this.SODetailsArray.map(n=>n.lineValue).reduce((n,r)=>n+r,0).toFixed(2)),e.dispatchSchedule){let n=Math.floor(e.orderedQty/e.dispatchCount),r=e.orderedQty%e.dispatchCount;for(let i=0;i<e.dispatchCount;i++){let m=n;i===e.dispatchCount-1&&(m+=r),this.SODetailsArray[o].dispatchSchedule[i].quantity=m}}}setNetRate(e){let o=this.SODetailsArray.findIndex(n=>n.SOLineNumber==e.SOLineNumber&&n.SKU==e.SKU);this.SODetailsArray[o].netRate=e.standardRate-e.standardRate*(e.discount/100),this.SODetailsArray[o].lineValue=e.orderedQty*e.netRate,this.f.SOTotalAmount.setValue(this.SODetailsArray.map(n=>n.lineValue).reduce((n,r)=>n+r,0).toFixed(2))}ESCPreview(){this.search="",this.isPreview=!1,this.SODetailsArray=this.ESCPreviewArr,this.collection=this.SODetailsArray.length}preview(){this.search="",this.isESCPreview=!0,this.ESCPreviewArr=this.SODetailsArray,this.SODetailsArray=this.SODetailsArray.filter(e=>e.orderedQty>0),this.SODetailsArray.length?this.isPreview=!0:(this.toastService.warning("At least One Row is Required"),this.isPreview=!1),this.collection=this.SODetailsArray.length}onSort({column:e,direction:o}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.SODetailsArray=""===o||""===e?this.SODetailsArray:[...this.SODetailsArray].sort((n,r)=>{let i="string"==typeof n[e]?n[e].toLowerCase():n[e],p="string"==typeof r[e]?r[e].toLowerCase():r[e];const m=i<p?-1:i>p?1:0;return"asc"===o?m:-m})}openSOScheduleModal(e){if(!this.form.controls.SOType.value)return void this.toastService.warning("PO Type is required !");const o=this.modalService.open(q.f,{centered:!0,windowClass:"custom-modal-sm",backdrop:"static",keyboard:!1});o.componentInstance.bookSalesOrder="Book Sales Order",o.componentInstance.SOType=this.form.controls.SOType.value,o.componentInstance.action=this.action,o.componentInstance.POQty=e.orderedQty,o.componentInstance.deliveryCount=e.dispatchCount,o.componentInstance.UOM=e.UOM,o.componentInstance.regularType=e,o.componentInstance.dispatchDate=this.utilityService.getFormatDate(e.SOLineTargetDate,"YYYY-MM-DD"),o.componentInstance.PPICDate=this.utilityService.getFormatDate(e.SOLineTargetDate,"YYYY-MM-DD"),e.dispatchSchedule&&(o.componentInstance.deliveryScheduleArr=e?.dispatchSchedule.map(n=>(n.dispatchDate=this.utilityService.getFormatDate(n.dispatchDate,"YYYY-MM-DD"),n.PPICDate=this.utilityService.getFormatDate(n.PPICDate,"YYYY-MM-DD"),n))),o.result.then(n=>{if(n&&["create","edit"].includes(this.action)){let r=this.SODetailsArray.findIndex(i=>i.SOLineNumber==e.SOLineNumber&&i.SKU==e.SKU);this.SODetailsArray[r].dispatchCount=n.deliveryCount,this.SODetailsArray[r].dispatchSchedule=n.deliverySchedule}},n=>{})}openSOTermsDetailsModal(){const e=this.modalService.open(M.y,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.SOTermsArr={transporterArr:this.masterData?.transporterOptions,freightTerms:this.masterData?.freightTermsOptions,modeOfTransport:this.masterData?.modeOfTransportOptions,paymentTermsArr:this.masterData?.paymentTermsOptions},e.componentInstance.SOTermsData={paymentTerms:this.form.controls.paymentTerms.value,modeOfTransport:this.form.controls.modeOfTransport.value,frightCharge:this.form.controls.frightCharge.value,frightTerms:this.form.controls.frightTerms.value,transporter:this.form.controls.transporter.value,destination:this.form.controls.destination.value,SORemarks:this.form.controls.SORemarks.value},e.componentInstance.billFromAddress=this.form.controls.billFromAddress.value,e.componentInstance.billToAddress=this.form.controls.billToAddress.value,e.componentInstance.billFromLocation=this.form.controls.billFromLocation.value,e.componentInstance.billFromCompanyData=this.masterData?.companyData,e.componentInstance.billFromLocationArr=this.masterData?.billFromLocationOptions,e.componentInstance.customerShippingAddress=this.form.controls.customerShippingAddress.value,e.componentInstance.customerBillingAddress=this.form.controls.customerBillingAddress.value,e.componentInstance.selectedCustomerData=this.selectedCustomer?.customerShippingAddress,e.componentInstance.selectedCustomerBillingData=this.selectedCustomer?.customerBillingAddress,e.componentInstance.otherCharges=this.otherCharges,e.result.then(o=>{o&&["create","edit"].includes(this.action)&&(this.form.patchValue(o?.SOTermsData),this.otherCharges=o?.SOTermsData?.otherCharges,this.form.controls.billFromAddress.patchValue(o?.billFromAddress),this.form.controls.billToAddress.patchValue(o?.billToAddress),this.form.controls.customerShippingAddress.patchValue(o?.customerShippingAddress),this.form.controls.customerBillingAddress.patchValue(o?.customerBillingAddress),this.form.controls.billFromLocation.setValue(o?.billFromLocation))},o=>{})}openSOTypeModal(){const e=this.modalService.open(k.Q,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.SOType=this.form.controls.SOType.value,e.result.then(o=>{o&&["create","edit"].includes(this.action)&&this.form.controls.SOType.setValue(o)},o=>{})}openCustomersDetailsModal(){const e=this.modalService.open(y.e7,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.selectedCustomerDetails=this.selectedCustomerDetails,e.componentInstance.customerOptions=this.customerOptions,e.componentInstance.customer=this.form.controls.customer.value,e.result.then(o=>{o&&(console.log("success",o),this.selectedCustomerDetails=o?.selectedCustomerDetails,this.form.controls.customer.setValue(o?.selectedCustomerDetails?._id),this.customerValueChange(this.selectedCustomerDetails))},o=>{})}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(h.gz),t.Y36(u.V),t.Y36(u.Uh),t.Y36(u.kl),t.Y36(T.VD),t.Y36(J.RJ),t.Y36(f.FF),t.Y36(u.tI),t.Y36(u.V1),t.Y36(d.Ye))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-bso-form"]],viewQuery:function(o,n){if(1&o&&t.Gf(_.j,5),2&o){let r;t.iGM(r=t.CRH())&&(n.headers=r)}},decls:122,vars:39,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading"],[1,""],[1,"form-body"],[1,"row","mb-2"],[1,"col-md-5"],[1,"row"],[1,"col-5"],[1,"form-label","mb-0"],[1,"text-danger"],["formControlName","salesCategory",1,"form-select",3,"change"],["selected","","disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"col-3","px-0"],["type","text","formControlName","SONumber","readonly","",1,"form-control"],[1,"col-4","pe-0"],["type","date","formControlName","SODate","readonly","",1,"form-control"],[1,"col-7"],[1,"col-4","pe-4"],[1,"d-flex","align-items-center"],[1,"col-11"],["bindLabel","customerName","bindValue","_id","formControlName","customer",3,"items","clearable","change"],["id","basic-addon1",1,"input-group-text","bg-primary","pointer","col-auto","fs-4",2,"height","2.9rem",3,"click"],["aria-hidden","true",1,"fa","fa-search","text-white"],[1,"col-3","pe-0"],[1,"form-label","mb-0","d-flex","justify-content-between"],["type","button",1,"btn","btn-primary","px-1","form-btn-sm","py-0",3,"click"],["type","text","formControlName","PONumber",1,"form-control"],[1,"col-3"],["type","date","formControlName","PODate",1,"form-control"],[1,"col-2","ps-0"],["type","text","formControlName","currency","readonly","",1,"form-control",3,"change"],[1,"row","line-border"],[3,"data","dataChange"],[1,"table-responsive","mt-0","text-wrap",2,"min-height","22rem"],[1,"table","table-bordered","mt-0","table-sm"],[1,"bg-info"],[1,"text-white"],["sortable","SKUNo",3,"sort"],["sortable","SKUName",1,"text-start",3,"sort"],["sortable","SKUDescription",1,"text-start",3,"sort"],["sortable","customerPartNo",3,"sort"],["sortable","UOM",3,"sort"],["sortable","orderedQty",3,"sort"],["sortable","standardRate",3,"sort"],["sortable","discount",3,"sort"],["sortable","netRate",3,"sort"],["sortable","lineValue",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"row","mb-3","align-items-center","mt-3"],[1,"col-md-auto"],[1,"plusIconSvg","btn","btn-primary","me-1"],["type","button",1,"btn","btn-primary","me-5","px-4",3,"click"],[1,"col-4","mt-1"],[1,"d-flex","justify-content-center"],[1,"col-form-label","text-nowrap","pe-2","pt-0"],["type","button",1,"btn","btn-info","py-1","ms-2"],["type","number","formControlName","SOTotalAmount","readonly","",1,"form-control"],["class","col px-0",4,"ngIf"],[1,"col-md-auto","ms-auto"],["class","d-grid gap-2 d-md-block",4,"ngIf"],["class","content-end",4,"ngIf"],[3,"value"],[1,"text-start"],["SKUName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],["SKUDescription",""],[4,"ngIf"],["type","number","class","form-control form-control-sm w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["type","number","class","form-control form-control-xs w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],[1,"d-flex","justify-content-center","pointer",3,"click"],[1,"assetCalendarTD"],["type","number",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],["type","number",1,"form-control","form-control-xs","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],[1,"col","px-0"],[1,"d-flex","justify-content-center","align-items-center"],[1,"col-form-label","text-nowrap"],[1,"text-danger","me-2"],["type","text","formControlName","SOCancellationReason",1,"form-control","mx-2"],[1,"d-grid","gap-2","d-md-block"],["type","button",1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","me-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","px-4","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"disabled","click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"content-end"]],template:function(o,n){1&o&&(t.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),t._uU(5),t.ALo(6,"titlecase"),t.qZA()()(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),t._uU(13," Customer Category "),t.TgZ(14,"span",11),t._uU(15,"*"),t.qZA()(),t.TgZ(16,"select",12),t.NdJ("change",function(){return n.getCustomers()}),t.TgZ(17,"option",13),t._uU(18,"Select"),t.qZA(),t.YNc(19,Q,2,2,"option",14),t.qZA()(),t.TgZ(20,"div",15)(21,"label",10),t._uU(22," SO No. "),t._UZ(23,"span",11),t.qZA(),t._UZ(24,"input",16),t.qZA(),t.TgZ(25,"div",17)(26,"label",10),t._uU(27," SO Date "),t._UZ(28,"span",11),t.qZA(),t._UZ(29,"input",18),t.qZA()()(),t.TgZ(30,"div",19)(31,"div",8)(32,"div",20)(33,"label",10),t._uU(34," Customer Name "),t.TgZ(35,"span",11),t._uU(36,"*"),t.qZA()(),t.TgZ(37,"div",21)(38,"div",22)(39,"ng-select",23),t.NdJ("change",function(i){return n.customerValueChange(i)}),t.qZA()(),t.TgZ(40,"div",24),t.NdJ("click",function(){return n.openCustomersDetailsModal()}),t._UZ(41,"i",25),t.qZA()()(),t.TgZ(42,"div",26)(43,"label",27),t._uU(44," PO No."),t.TgZ(45,"span",11),t._uU(46,"*"),t.qZA(),t._UZ(47,"span")(48,"span")(49,"span")(50,"span")(51,"span")(52,"span")(53,"span"),t.TgZ(54,"button",28),t.NdJ("click",function(){return n.openSOTypeModal()}),t._uU(55," PO Type "),t.qZA()(),t._UZ(56,"input",29),t.qZA(),t.TgZ(57,"div",30)(58,"label",10),t._uU(59," PO Date "),t.TgZ(60,"span",11),t._uU(61,"*"),t.qZA()(),t._UZ(62,"input",31),t.qZA(),t.TgZ(63,"div",32)(64,"label",10),t._uU(65," Currency "),t.qZA(),t.TgZ(66,"input",33),t.NdJ("change",function(){return n.setDelivery()}),t.qZA()()()()()(),t._UZ(67,"hr",34),t.TgZ(68,"div",4)(69,"app-setting-header",35),t.NdJ("dataChange",function(i){return n.eventHeader(i)}),t.qZA()(),t.TgZ(70,"div",36)(71,"table",37)(72,"thead",38)(73,"tr",39)(74,"th",40),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(75,"SKU Code"),t.qZA(),t.TgZ(76,"th",41),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(77),t.ALo(78,"labelTranslate"),t.qZA(),t.TgZ(79,"th",42),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(80),t.ALo(81,"labelTranslate"),t.qZA(),t.TgZ(82,"th",43),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(83,"Part No."),t.qZA(),t.TgZ(84,"th",44),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(85,"UoM"),t.qZA(),t.TgZ(86,"th",45),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(87,"SO Qty"),t.qZA(),t.TgZ(88,"th",46),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(89,"Rate/Unit"),t.qZA(),t.TgZ(90,"th",47),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(91,"Disc %"),t.qZA(),t.TgZ(92,"th",48),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(93,"Net Rate"),t.qZA(),t.TgZ(94,"th",49),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(95,"Line Value"),t.qZA(),t.TgZ(96,"th"),t._uU(97,"Disp."),t.qZA()()(),t.TgZ(98,"tbody"),t.YNc(99,j,36,35,"tr",50),t.ALo(100,"slice"),t.ALo(101,"searchFi1ter"),t.qZA()()(),t._UZ(102,"hr",34),t.TgZ(103,"div",51)(104,"div",52),t._UZ(105,"button",53),t.TgZ(106,"button",54),t.NdJ("click",function(){return n.openSOTermsDetailsModal()}),t._uU(107," SO Terms/Details "),t.qZA()(),t.TgZ(108,"div",55)(109,"div",56)(110,"div",57),t._uU(111," Net SO Value: "),t.TgZ(112,"button",58),t._uU(113),t.ALo(114,"companyCurrency"),t.qZA()(),t._UZ(115,"input",59),t.qZA()(),t.YNc(116,G,9,0,"div",60),t.TgZ(117,"div",61),t.YNc(118,H,9,2,"div",62),t.YNc(119,z,3,0,"div",62),t.YNc(120,$,3,0,"div",63),t.YNc(121,X,3,0,"div",63),t.qZA()()()()),2&o&&(t.Q6J("formGroup",n.form),t.xp6(5),t.hij("Sales Order (",t.lcZ(6,17,n.action),")"),t.xp6(12),t.Q6J("value",null),t.xp6(2),t.Q6J("ngForOf",null==n.masterData?null:n.masterData.salesCategoryOptions),t.xp6(20),t.Q6J("items",n.customerOptions)("clearable",!1),t.xp6(30),t.Q6J("data",t.l5B(32,W,n.page,n.pageSize,n.collection,n.search)),t.xp6(8),t.hij(" ",t.lcZ(78,19,"SKU Name")," "),t.xp6(3),t.hij(" ",t.lcZ(81,21,"SKU Description")," "),t.xp6(19),t.Q6J("ngForOf",t.Dn7(100,23,t.xi3(101,27,n.SODetailsArray,n.search),(n.page-1)*n.pageSize,(n.page-1)*n.pageSize+n.pageSize))("ngForTrackBy",n.trackByFn),t.xp6(14),t.hij(" ",t.lcZ(114,30,"INR")," "),t.xp6(3),t.Q6J("ngIf","cancel"==n.action),t.xp6(2),t.Q6J("ngIf",t.DdM(37,tt).includes(n.action)),t.xp6(1),t.Q6J("ngIf",t.DdM(38,et).includes(n.action)),t.xp6(1),t.Q6J("ngIf","cancel"==n.action),t.xp6(1),t.Q6J("ngIf","approve"==n.action))},dependencies:[d.sg,d.O5,b.P,f._L,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.JL,a.sg,a.u,a.On,P.w9,_.j,d.OU,d.JJ,d.rS,Y.G,B.c,L.f,I.Q],styles:[".assetCalendarTD[_ngcontent-%COMP%]{background-color:transparent;background-image:url(Asset_Calendar.26a2ba3b333e16fe.svg);background-size:100% 100%;border:0;color:#fff;height:1.6rem;width:1.6rem}"]})}return s})();function ot(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",18,19)(11,"span",20),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td")(20,"div",21),t._UZ(21,"button",22),t.TgZ(22,"div",23)(23,"a",24),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.navigateTo("/default/sales/transactions/book_sales_order/form",r,"cancel"))}),t._UZ(24,"i",25),t._uU(25," Cancel "),t.qZA()()()()()}if(2&s){const e=c.$implicit,o=t.MAs(10),n=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.SONumber),t.xp6(2),t.Oqu(null==e?null:e.SODateS),t.xp6(2),t.Oqu(null==e?null:e.PONumber),t.xp6(2),t.Oqu(null==e?null:e.salesCategory),t.xp6(1),t.Udp("width",o.clientWidth),t.xp6(2),t.Q6J("positionTarget",o)("ngbTooltip",e.customerName),t.xp6(1),t.hij(" ",null==e?null:e.customerName," "),t.xp6(2),t.Oqu(null==e?null:e.currency),t.xp6(2),t.Oqu(null==e?null:e.SOTotalAmount),t.xp6(2),t.Oqu(null==e?null:e.SOStatus),t.xp6(5),t.Q6J("accessType",n.rolePermissionActions.approveAction)}}const rt=function(s,c,e,o){return{page:s,pageSize:c,collection:e,search:o,type:"list"}},at=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:x},{path:"cso-list",component:(()=>{class s{constructor(e,o,n,r,i,p){this.exportExcelService=e,this.salesService=o,this.router=n,this.spinner=r,this.activatedRoute=i,this.exportToPDFService=p,this.page=1,this.pageSize=10,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Created","Approved","Report Generated"],this.rolePermissionActions=g.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(e,o,n){this.router.navigate([e],{queryParams:{id:o?._id,action:n}})}trackByFn(e,o){return o?._id}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=e.value,this.getAll()}}getAll(e=!1,o=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:e};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.salesService.getAll(n).subscribe(r=>{"EXCEL"==o?this.excelDownload(r.rows):"PDF"==o?this.pdfDownload(r.rows):(this.tableData=r.rows,this.collection=r.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(e){let o=(0,S.S$)(e);this.exportToPDFService.generatePdf(o.tableData,o.title)}excelDownload(e){this.exportExcelService.exportExcel((0,S.B6)(e))}onSort({column:e,direction:o}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.column=e,this.direction="asc"==o?1:-1,this.getAll()}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(u.Ol),t.Y36(T.VD),t.Y36(h.F0),t.Y36(u.V),t.Y36(h.gz),t.Y36(u.$L))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-bso-list"]],viewQuery:function(o,n){if(1&o&&t.Gf(_.j,5),2&o){let r;t.iGM(r=t.CRH())&&(n.headers=r)}},decls:30,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered","table-sticky"],[1,"bg-primary"],[1,"text-white"],["sortable","SONumber",3,"sort"],["sortable","SODateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","salesCategory",3,"sort"],["sortable","customerName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","SOTotalAmount",3,"sort"],["sortable","status",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["customerName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa","fa-times","fa-lg","me-2","text-primary"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Cancellation[SO] Summary"),t.qZA()(),t._UZ(4,"hr",3),t.TgZ(5,"div",4)(6,"app-setting-header",5),t.NdJ("dataChange",function(i){return n.eventHeader(i)}),t.qZA(),t.TgZ(7,"table",6)(8,"thead",7)(9,"tr",8)(10,"th",9),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(11,"SO No."),t.qZA(),t.TgZ(12,"th",10),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(13,"SO Date"),t.qZA(),t.TgZ(14,"th",11),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(15,"PO No."),t.qZA(),t.TgZ(16,"th",12),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(17,"Sales Category"),t.qZA(),t.TgZ(18,"th",13),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(19,"Customer Name"),t.qZA(),t.TgZ(20,"th",14),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(21,"Currency"),t.qZA(),t.TgZ(22,"th",15),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(23,"SO Value"),t.qZA(),t.TgZ(24,"th",15),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(25,"Status"),t.qZA(),t.TgZ(26,"th",16),t.NdJ("sort",function(i){return n.onSort(i)}),t._uU(27,"Action"),t.qZA()()(),t.TgZ(28,"tbody"),t.YNc(29,ot,26,13,"tr",17),t.qZA()()()()),2&o&&(t.xp6(6),t.Q6J("data",t.l5B(3,rt,n.page,n.pageSize,n.collection,n.search)),t.xp6(23),t.Q6J("ngForOf",n.tableData)("ngForTrackBy",n.trackByFn))},dependencies:[d.sg,b.P,f._L,_.j,A.J],encapsulation:2})}return s})()},{path:"form",component:nt,resolve:{accessScreen:l(65876).x}}];let lt=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#n=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(at),h.Bz]})}return s})();var ct=l(56208);let ut=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#n=this.\u0275inj=t.cJS({imports:[d.ez,lt,ct.m]})}return s})()}}]);