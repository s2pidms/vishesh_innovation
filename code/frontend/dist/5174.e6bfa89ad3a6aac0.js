"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[5174],{65174:(Zt,N,c)=>{c.r(N),c.d(N,{GRNModule:()=>ft});var u=c(96814),_=c(1076),s=c(60095),G=c(21631),U=c(22096),g=c(43818),S=c(63375),t=c(65879),f=c(37285),A=c(50363);let q=(()=>{var a;class l{get f(){return this.form.controls}constructor(n){this.activeModal=n,this.action="",this.receivedDocuments={},this.transporterArr=[],this.form=new s.nJ({goodsDeliveryDate:new s.p4(null),transporterName:new s.p4(null),AWB_LR_BR:new s.p4(null),freightChargesPaid:new s.p4(null),otherChargesPaid:new s.p4(null),isTaxInvoice:new s.p4(null),isEWayBill:new s.p4(null),isDeliveryChallan:new s.p4(null),isPackingList:new s.p4(null),isCOATC:new s.p4(null)})}ngOnInit(){this.form.patchValue(this.receivedDocuments),["view","cancel"].includes(this.action)&&this.form.disable()}dismissModel(){this.activeModal.close(this.form.value)}}return(a=l).\u0275fac=function(n){return new(n||a)(t.Y36(f.Kz))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-addtional-info-modal"]],inputs:{action:"action",receivedDocuments:"receivedDocuments",transporterArr:"transporterArr"},decls:106,vars:3,consts:[[3,"formGroup"],[1,"modelPage"],[1,"modal-header"],[1,"heading"],["type","button","aria-label","Close",1,"btn","btn-cross","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"container-fluid","px-0"],[1,"row","px-5"],[1,"col-7","mt-4","pe-0"],[1,"text-primary","mb-0"],[1,""],["src","./assets/new_icons/transport_ul_1px.svg","alt","","width","132","height","6"],[1,"row","mt-4"],[1,"col-4","mt-1","pe-0"],[1,"form-label","text-nowrap"],[1,"col-auto","ps-4","pe-0"],[1,"fa","fa-caret-right","mt-1","text-primary"],[1,"col-6","ps-0"],["type","date","formControlName","goodsDeliveryDate",1,"form-control"],[1,"col-4","pe-0"],[1,"form-label"],[1,"fa","fa-caret-right","text-primary"],["bindLabel","label","bindValue","value","formControlName","transporterName",3,"items","clearable"],["type","text","formControlName","AWB_LR_BR",1,"form-control"],["type","number","formControlName","freightChargesPaid",1,"form-control"],["type","number","formControlName","otherChargesPaid",1,"form-control"],[1,"col-1","separator","text-center"],["src","./assets/new_icons/separator_1px.svg","width","8","height","260","alt",""],[1,"col-4","mt-4","p-0"],["src","./assets/new_icons/transport_ul_1px.svg","alt","","width","151","height","6"],[1,"col-4","text-start"],[1,"col-auto","ps-5","pe-0"],[1,"fa","fa-caret-right","text-primary","ps-5","pe-0"],[1,"col","text-start","ps-0"],["formControlName","isTaxInvoice","type","checkbox",1,"form-check-input","pointer","ps-0"],[1,"row","margin"],[1,"col-4","text-start","pe-0"],["formControlName","isEWayBill","type","checkbox",1,"form-check-input","pointer"],["formControlName","isDeliveryChallan","type","checkbox",1,"form-check-input","pointer"],["formControlName","isPackingList","type","checkbox",1,"form-check-input","pointer"],["formControlName","isCOATC","type","checkbox",1,"form-check-input","pointer"],[1,"line-border","my-5","px-5"],[1,"text-center"],["type","button",1,"btn","bg-primary","px-5","mb-5",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4,"Addional Information"),t.qZA(),t.TgZ(5,"div")(6,"button",4),t.NdJ("click",function(){return e.dismissModel()}),t._UZ(7,"i",5),t.qZA()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"h4",9),t._uU(12,"Transport Details"),t.qZA(),t.TgZ(13,"span",10),t._UZ(14,"img",11),t.qZA(),t.TgZ(15,"div",12)(16,"div",13)(17,"label",14),t._uU(18,"Goods Delivery Date"),t.qZA()(),t.TgZ(19,"div",15),t._UZ(20,"i",16),t.qZA(),t.TgZ(21,"div",17),t._UZ(22,"input",18),t.qZA()(),t.TgZ(23,"div",12)(24,"div",19)(25,"label",20),t._uU(26,"Transporter Name"),t.qZA()(),t.TgZ(27,"div",15),t._UZ(28,"i",21),t.qZA(),t.TgZ(29,"div",17),t._UZ(30,"ng-select",22),t.qZA()(),t.TgZ(31,"div",12)(32,"div",19)(33,"label",20),t._uU(34,"Docket/AWB No."),t.qZA()(),t.TgZ(35,"div",15),t._UZ(36,"i",21),t.qZA(),t.TgZ(37,"div",17),t._UZ(38,"input",23),t.qZA()(),t.TgZ(39,"div",12)(40,"div",19)(41,"label",14),t._uU(42,"Freight Charges Paid"),t.qZA()(),t.TgZ(43,"div",15),t._UZ(44,"i",21),t.qZA(),t.TgZ(45,"div",17),t._UZ(46,"input",24),t.qZA()(),t.TgZ(47,"div",12)(48,"div",19)(49,"label",14),t._uU(50,"Other Charges Paid"),t.qZA()(),t.TgZ(51,"div",15),t._UZ(52,"i",21),t.qZA(),t.TgZ(53,"div",17),t._UZ(54,"input",25),t.qZA()()(),t.TgZ(55,"div",26),t._UZ(56,"img",27),t.qZA(),t.TgZ(57,"div",28)(58,"h4",9),t._uU(59,"Document Checklist"),t.qZA(),t.TgZ(60,"span",10),t._UZ(61,"img",29),t.qZA(),t.TgZ(62,"div",12)(63,"div",30)(64,"label",14),t._uU(65,"Tax Invoice"),t.qZA()(),t.TgZ(66,"div",31),t._UZ(67,"i",32),t.qZA(),t.TgZ(68,"div",33),t._UZ(69,"input",34),t.qZA()(),t.TgZ(70,"div",35)(71,"div",36)(72,"label",14),t._uU(73,"E-way Bill"),t.qZA()(),t.TgZ(74,"div",31),t._UZ(75,"i",32),t.qZA(),t.TgZ(76,"div",33),t._UZ(77,"input",37),t.qZA()(),t.TgZ(78,"div",35)(79,"div",30)(80,"label",14),t._uU(81,"Delivery Challan"),t.qZA()(),t.TgZ(82,"div",31),t._UZ(83,"i",32),t.qZA(),t.TgZ(84,"div",33),t._UZ(85,"input",38),t.qZA()(),t.TgZ(86,"div",35)(87,"div",30)(88,"label",14),t._uU(89,"Packing List"),t.qZA()(),t.TgZ(90,"div",31),t._UZ(91,"i",32),t.qZA(),t.TgZ(92,"div",33),t._UZ(93,"input",39),t.qZA()(),t.TgZ(94,"div",35)(95,"div",30)(96,"label",14),t._uU(97,"PDIR/TC/CoA"),t.qZA()(),t.TgZ(98,"div",31),t._UZ(99,"i",32),t.qZA(),t.TgZ(100,"div",33),t._UZ(101,"input",40),t.qZA()()()(),t._UZ(102,"hr",41),t.TgZ(103,"div",42)(104,"button",43),t.NdJ("click",function(){return e.dismissModel()}),t._uU(105," Save & Close "),t.qZA()()()()()),2&n&&(t.Q6J("formGroup",e.form),t.xp6(30),t.Q6J("items",e.transporterArr)("clearable",!1))},dependencies:[s._Y,s.Fj,s.wV,s.Wl,s.JJ,s.JL,s.sg,s.u,A.w9],styles:[".fa-caret-right[_ngcontent-%COMP%]{font-size:2rem!important;margin-right:4rem!important}.margin[_ngcontent-%COMP%]{margin-top:2.2rem;justify-content:flex-end}.separator[_ngcontent-%COMP%]{margin-top:4rem}"]}),l})();var M=c(73634),O=c(86007),C=c(77203);const w=[{label:"Purchase Category",value:"purchaseCategory",class:""},{label:"PO Type",value:"POType",class:""},{label:"PO No.",value:"PONumber",class:""},{label:"Location",value:"deliveryLocation",class:""}];var Z=c(73374),p=c(2742),P=c(16897),b=c(88059),F=c(95346),I=c(14906),J=c(83344),Q=c(59103);function k(a,l){1&a&&t._UZ(0,"div",70)}function L(a,l){1&a&&t._UZ(0,"div",70)}function Y(a,l){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,i.GRNQty,"1.2-2")," ")}}const y=function(){return{standalone:!0}};function E(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"input",71),t.NdJ("input",function(){t.CHM(i);const e=t.oxw().$implicit,o=t.oxw();return t.KtG(o.changeGRNQty(e.GRNLineNumber,e))})("ngModelChange",function(e){t.CHM(i);const o=t.oxw().$implicit;return t.KtG(o.GRNQty=e)})("ngModelChange",function(e){t.CHM(i);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.grnQtyChange(e,o.GRNLineNumber))}),t.qZA()}if(2&a){const i=t.oxw().$implicit;t.Q6J("ngModel",i.GRNQty)("ngModelOptions",t.DdM(2,y))}}function B(a,l){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.hij(" ",i.batchDate," ")}}function j(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"input",72),t.NdJ("ngModelChange",function(e){t.CHM(i);const o=t.oxw().$implicit;return t.KtG(o.batchDate=e)}),t.qZA()}if(2&a){const i=t.oxw().$implicit;t.Q6J("ngModel",i.batchDate)("ngModelOptions",t.DdM(2,y))}}function z(a,l){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const i=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,i.invoicedQty,"1.2-2")," ")}}function H(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"input",73),t.NdJ("input",function(){t.CHM(i);const e=t.oxw().$implicit,o=t.oxw();return t.KtG(o.setInvoiceQty(e.GRNLineNumber,e))})("ngModelChange",function(e){t.CHM(i);const o=t.oxw().$implicit;return t.KtG(o.invoicedQty=e)}),t.qZA()}if(2&a){const i=t.oxw().$implicit;t.Q6J("ngModel",i.invoicedQty)("ngModelOptions",t.DdM(2,y))}}const v=function(){return["approve","view","generate","cancel"]},D=function(){return["view","generate","cancel"]};function $(a,l){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td",57,58)(7,"span",59),t._uU(8),t.qZA()(),t.TgZ(9,"td",57,60)(11,"span",59),t._uU(12),t.qZA()(),t.TgZ(13,"td")(14,"div",61)(15,"span",62),t._uU(16),t.ALo(17,"UOMUnitsMaster"),t.qZA(),t.TgZ(18,"span",63),t.YNc(19,k,1,0,"div",64),t.YNc(20,L,1,0,"div",64),t.qZA()()(),t.TgZ(21,"td"),t._uU(22),t.ALo(23,"number"),t.qZA(),t.TgZ(24,"td")(25,"div",65),t.YNc(26,Y,3,4,"span",66),t.YNc(27,E,1,3,"input",67),t.qZA()(),t.TgZ(28,"td")(29,"div",65),t.YNc(30,B,2,1,"span",66),t.YNc(31,j,1,3,"input",68),t.qZA()(),t.TgZ(32,"td")(33,"div",65),t.YNc(34,z,3,4,"span",66),t.YNc(35,H,1,3,"input",69),t.qZA()(),t.TgZ(36,"td"),t._uU(37),t.qZA(),t.TgZ(38,"td"),t._uU(39),t.ALo(40,"number"),t.qZA()()),2&a){const i=l.$implicit,n=t.MAs(6),e=t.MAs(10),o=t.oxw();t.xp6(2),t.Oqu(null==i?null:i.GRNLineNumber),t.xp6(2),t.Oqu(null==i?null:i.itemCode),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",i.itemName),t.xp6(1),t.hij(" ",null==i?null:i.itemName," "),t.xp6(1),t.Udp("width",e.clientWidth),t.xp6(2),t.Q6J("positionTarget",e)("ngbTooltip",i.itemDescription),t.xp6(1),t.hij(" ",null==i?null:i.itemDescription," "),t.xp6(3),t.Q6J("ngbTooltip",i.conversionOfUnits)("ngClass",i.UOM==i.secondaryUnit?"text-primary pointer":"text-secondary pointer"),t.xp6(1),t.hij(" ",t.lcZ(17,26,null==i?null:i.UOM)," "),t.xp6(3),t.Q6J("ngIf",i.secondaryUnit),t.xp6(1),t.Q6J("ngIf",!i.secondaryUnit),t.xp6(2),t.Oqu(t.xi3(23,28,null==i?null:i.balancedQty,"1.2-2")),t.xp6(4),t.Q6J("ngIf",t.DdM(34,v).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(35,v).includes(o.action)),t.xp6(3),t.Q6J("ngIf",t.DdM(36,v).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(37,v).includes(o.action)),t.xp6(3),t.Q6J("ngIf",t.DdM(38,D).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(39,D).includes(o.action)),t.xp6(2),t.Oqu(null==i?null:i.purchaseRate),t.xp6(2),t.hij(" ",t.xi3(40,31,(null==i?null:i.purchaseRate)*(null!=i&&i.invoicedQty?null==i?null:i.invoicedQty:0),"1.2-2")," ")}}function V(a,l){1&a&&(t.TgZ(0,"div",74)(1,"div",47)(2,"span",75),t._uU(3,"GRN Remark "),t.qZA(),t._UZ(4,"input",76),t.qZA()())}function W(a,l){1&a&&(t.TgZ(0,"div",77)(1,"div",47)(2,"span",75),t._uU(3,"Reason for Cancellation "),t.qZA(),t._UZ(4,"input",78),t.qZA()())}function K(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"button",83),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.reset())}),t._uU(1," Reset "),t.qZA()}}function X(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"button",84),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.submit())}),t._uU(1," Save "),t.qZA()}}function tt(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"div",85)(1,"button",84),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.submit())}),t._uU(2,"Approve"),t.qZA()()}}function et(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"div",85)(1,"button",84),t.NdJ("click",function(){t.CHM(i);const e=t.oxw(2);return t.KtG(e.openCancelModal())}),t._uU(2,"Cancel"),t.qZA()()}}const nt=function(){return["edit","generate","approve","cancel"]};function it(a,l){if(1&a&&(t.TgZ(0,"div",79)(1,"div"),t.YNc(2,K,2,0,"button",80),t.YNc(3,X,2,0,"button",81),t.qZA(),t.YNc(4,tt,3,0,"div",82),t.YNc(5,et,3,0,"div",82),t.qZA()),2&a){const i=t.oxw();t.xp6(2),t.Q6J("ngIf",!t.DdM(4,nt).includes(i.action)),t.xp6(1),t.Q6J("ngIf","approve"!=i.action&&"generate"!=i.action&&"cancel"!=i.action),t.xp6(1),t.Q6J("ngIf","approve"==i.action),t.xp6(1),t.Q6J("ngIf","cancel"==i.action)}}const ot=function(a,l,i,n){return{page:a,pageSize:l,collection:i,search:n,excelDisplay:"none"}};let rt=(()=>{var a;class l{get f(){return this.form.controls}constructor(n,e,o,r,d,m,h,vt){this.grnServices=n,this.activatedRoute=e,this.spinner=o,this.toastService=r,this.validationService=d,this.utilityService=m,this.modalService=h,this.location=vt,this.page=1,this.pageSize=5,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.flag=-1,this.selectedDetails={},this.tableHead=w,this.submitted=!1,this.action="create",this.POFilter=[],this.selectedSupplierDetails={},this.GRNDetailsArray=[],this.masterData={autoIncrementNo:"",GRNQtyPercent:0,transporterOptions:[],suppliersOptions:[]},this.statusArr={create:"Awaiting Approval",edit:"Awaiting Approval",approve:"Approved",generate:"Report Generated",cancel:"Cancelled"},this.form=new s.nJ({_id:new s.p4(null),GRNNumber:new s.p4(null,[s.kI.required]),GRNDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD"),[s.kI.required]),PONumber:new s.p4(null,[s.kI.required]),PODate:new s.p4(null),supplier:new s.p4(null,[s.kI.required]),supplierInvoiceRef:new s.p4(null,[s.kI.required]),supplierInvoiceRefDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD"),[s.kI.required]),GRNStatus:new s.p4("Awaiting Approval",[s.kI.required]),remarks:new s.p4(null),transporterName:new s.p4(null),goodsDeliveryDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD")),freightChargesPaid:new s.p4(null),otherChargesPaid:new s.p4(null),AWB_LR_BR:new s.p4(null),GRNDetails:new s.p4([]),isTaxInvoice:new s.p4(!1),isEWayBill:new s.p4(!1),isDeliveryChallan:new s.p4(!1),isPackingList:new s.p4(!1),isCOATC:new s.p4(!1),deliveryLocation:new s.p4(null),cancellationReason:new s.p4(null),storageLocationMapping:new s.p4({})})}ngOnInit(){this.getInitialData()}submit(){if(this.GRNDetailsArray=this.GRNDetailsArray.filter(e=>e.GRNQty>0),this.submitted=!0,this.form.value.GRNDetails=this.GRNDetailsArray,this.validationService.checkErrors(this.form,S.BL))return;if(0==this.GRNDetailsArray.length)return void this.toastService.warning("Please select at least 1 Order");this.form.enable();let n=this.form.value;n.GRNDetails=this.GRNDetailsArray,"approve"==this.action&&n.GRNDetails.some(e=>e.invoicedQty<=0)?this.toastService.warning("Invoice quantity can not be zero"):n._id?this.update(n):(delete n._id,this.create(n))}update(n){this.spinner.show(),this.grnServices.update(n._id,n).subscribe(e=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(e.message),this.location.back()})}create(n){this.spinner.show(),this.grnServices.create(n).subscribe(e=>{this.submitted=!1,this.spinner.hide(),this.toastService.success(e.message),this.location.back()})}reset(){this.form.reset(),this.GRNDetailsArray=[],this.POFilter=[],this.collection=this.GRNDetailsArray.length,this.getInitialData()}trackByFn(n,e){return e?._id}getInitialData(){this.spinner.show(),this.spinner.show(),this.grnServices.getAllMasterData({}).subscribe(n=>{this.masterData=n,this.form.controls.GRNNumber.setValue(this.masterData?.autoIncrementNo),this.form.controls.GRNStatus.setValue("Awaiting Approval"),this.form.controls.goodsDeliveryDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.GRNDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.supplierInvoiceRefDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.activatedRoute.queryParams.pipe((0,G.z)(e=>(this.action=e.action,this.utilityService.accessDenied(this.action),e.id?this.grnServices.getById(e.id):(0,U.of)({})))).subscribe(e=>{this.spinner.hide(),0!=Object.keys(e).length&&(this.GRNDetailsArray=e.GRNDetails.map((o,r)=>({POLineNumber:o.POLineNumber,GRNLineNumber:r+1,item:o?.item?._id,itemCode:o?.item?.itemCode,itemName:o?.item?.itemName,itemDescription:o?.item?.itemDescription,conversionOfUnits:o?.item?.conversionOfUnits,standardRate:o?.standardRate,purchaseRate:o?.purchaseRate,primaryUnit:o?.primaryUnit,secondaryUnit:o?.secondaryUnit,primaryToSecondaryConversion:o?.primaryToSecondaryConversion,secondaryToPrimaryConversion:o?.secondaryToPrimaryConversion,UOM:o.UOM?o.UOM:o.primaryUnit,POQty:o?.POQty,GRNQty:o?.GRNQty,balancedMRNQty:o?.balancedMRNQty,invoicedQty:o?.invoicedQty,balancedQty:o?.balancedQty,receivedQty:o?.receivedQty,canceledQty:o?.canceledQty,batchDate:this.utilityService.getFormatDate(o?.batchDate,"YYYY-MM-DD")})),this.collection=this.GRNDetailsArray.length,this.POFilter=[{PONumber:e?.PONumber.PONumber,_id:e?.PONumber._id}],e.PONumber=e.PONumber._id,e.supplier=e.supplier._id,e.PODate&&(e.PODate=this.utilityService.getFormatDate(e.PODate,"YYYY-MM-DD")),e.GRNDate=this.utilityService.getFormatDate(e.GRNDate,"YYYY-MM-DD"),e.supplierInvoiceRefDate=this.utilityService.getFormatDate(e.supplierInvoiceRefDate,"YYYY-MM-DD"),e.GRNStatus=this.statusArr[this.action],this.form.patchValue(e),this.f.PONumber.disable(),this.f.supplier.disable(),"edit"!=this.action&&(this.form.disable(),"cancel"==this.action&&this.f.cancellationReason.enable()))}),this.spinner.hide()})}cancelGRN(){this.form.enable();let n=this.form.value;n.cancellationReason?(this.spinner.show(),this.grnServices.updateOnCancel(n._id,n).subscribe(e=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(e.message),this.location.back()})):this.toastService.warning("Reason for Cancellation is Required")}openCancelModal(){const n=this.modalService.open(O.e,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.heading="GRN Cancellation",n.componentInstance.cancelText="Do You Want to Cancel GRN ?",n.result.then(e=>{"Yes"==e&&this.cancelGRN()},e=>{})}getPONum(n){this.f.PONumber.setValue(null),this.f.PODate.setValue(null),this.f.deliveryLocation.setValue(null),this.GRNDetailsArray=[],this.collection=this.GRNDetailsArray.length,this.spinner.show(),this.grnServices.getPOBySupplierId(n?.value).subscribe(e=>{this.POFilter=e,this.spinner.hide()})}setTableDetails(n){this.f.PODate.setValue(this.utilityService.getFormatDate(n?.PODate,"YYYY-MM-DD")),this.f.deliveryLocation.setValue(n?.deliveryLocation),this.spinner.show(),this.grnServices.getGRNDetailsByPOId(n._id).subscribe(e=>{this.GRNDetailsArray=e.map((o,r)=>(o.GRNLineNumber=r+1,o)),this.collection=this.GRNDetailsArray.length,this.spinner.hide()})}setInvoiceQty(n,e){let o=this.GRNDetailsArray.map(r=>r.GRNLineNumber).indexOf(n);e.invoicedQty>e.balancedQty+e.balancedQty*+this.masterData.GRNQtyPercent&&(this.GRNDetailsArray[o].invoicedQty=0,this.toastService.warning(`Invoice Quantity '${e.invoicedQty}' cannot be greater than Balance Quantity '${e.balancedQty}'!Tolerance allowed is 50%.`))}changeGRNQty(n,e){let o=this.GRNDetailsArray.map(r=>r.GRNLineNumber).indexOf(n);e.GRNQty>e.balancedQty+e.balancedQty*+this.masterData.GRNQtyPercent&&(this.GRNDetailsArray[o].GRNQty=0,this.toastService.warning(`GRN Quantity '${e.GRNQty}' cannot be greater than Balance Quantity '${e.balancedQty}'!Tolerance allowed is 50%.`))}grnQtyChange(n,e){let o=this.GRNDetailsArray.map(r=>r.GRNLineNumber).indexOf(e);this.GRNDetailsArray[o].GRNQty=Math.abs(n),this.GRNDetailsArray[o].balancedMRNQty=Math.abs(n)}setConversionOfUnit(n){let e=this.GRNDetailsArray.map(o=>o.GRNLineNumber).indexOf(n.GRNLineNumber);this.GRNDetailsArray[e].UOM=this.GRNDetailsArray[e].UOM==n.secondaryUnit?n.primaryUnit:n.secondaryUnit}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.flag=-1;break;case"EXCEL":default:break;case"PAGE":this.page=n.value}}onSort({column:n,direction:e}){this.headers.forEach(o=>{o.sortable!==n&&(o.direction="")}),this.GRNDetailsArray=""===e||""===n?this.GRNDetailsArray:[...this.GRNDetailsArray].sort((o,r)=>{let d="string"==typeof o[n]?o[n].toLowerCase():o[n],m="string"==typeof r[n]?r[n].toLowerCase():r[n];const h=d<m?-1:d>m?1:0;return"asc"===e?h:-h})}openAditionalInfoModal(){const n=this.modalService.open(q,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.transporterArr=this.masterData?.transporterOptions,n.componentInstance.receivedDocuments={isTaxInvoice:this.form.value.isTaxInvoice,isEWayBill:this.form.value.isEWayBill,isDeliveryChallan:this.form.value.isDeliveryChallan,isPackingList:this.form.value.isPackingList,isCOATC:this.form.value.isCOATC,goodsDeliveryDate:this.form.value.goodsDeliveryDate,transporterName:this.form.value.transporterName,AWB_LR_BR:this.form.value.AWB_LR_BR,freightChargesPaid:this.form.value.freightChargesPaid,otherChargesPaid:this.form.value.otherChargesPaid},n.result.then(e=>{this.form.patchValue(e)},e=>{})}openStorageLocationMappingModal(){const n=this.modalService.open(M.o,{centered:!0,size:"md",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.storageLocationMapping=this.form.value.storageLocationMapping,n.result.then(e=>{this.form.controls.storageLocationMapping.patchValue(e)},e=>{})}openSupplierDetailsModal(){const n=this.modalService.open(C.Nx,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.selectedSupplierDetails=this.selectedSupplierDetails,n.componentInstance.supplierOptions=this.masterData.suppliersOptions,n.componentInstance.supplier=this.form.controls.supplier.value,n.result.then(e=>{e&&(this.selectedSupplierDetails=e?.selectedSupplierDetails,this.form.controls.supplier.setValue(e?.selectedSupplierDetails?._id),this.getPONum(this.selectedSupplierDetails))},e=>{})}openPODetailsModal(){if("create"==this.action){const n=this.modalService.open(C.xv,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.title="PO No. Details",n.componentInstance.selectedDetails=this.selectedDetails,n.componentInstance.tableHead=this.tableHead,n.componentInstance.bodyList=this.POFilter?.map(e=>(e.PODate=this.utilityService.getFormatDate(e?.PODate,"YYYY-MM-DD"),e)),n.componentInstance._id=this.form.controls.PONumber.value,n.result.then(e=>{e&&(this.selectedDetails=e?.selectedDetails,this.form.controls.PONumber.setValue(e?.selectedDetails?._id),this.setTableDetails(e?.selectedDetails))},e=>{})}}}return(a=l).\u0275fac=function(n){return new(n||a)(t.Y36(Z.zP),t.Y36(_.gz),t.Y36(p.V),t.Y36(p.kl),t.Y36(P.RJ),t.Y36(p.tI),t.Y36(f.FF),t.Y36(u.Ye))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-form"]],viewQuery:function(n,e){if(1&n&&t.Gf(g.j,5),2&n){let o;t.iGM(o=t.CRH())&&(e.headers=o)}},decls:106,vars:35,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading"],[1,""],[1,"form-body"],[1,"row"],[1,"col-6","pe-5"],[1,"col-3","pe-2"],[1,"form-label"],["type","text","formControlName","GRNNumber","readonly","",1,"form-control"],["type","date","formControlName","GRNDate",1,"form-control"],[1,"text-danger"],[1,"d-flex","align-items-center"],[1,"col-11"],["bindLabel","label","bindValue","value","formControlName","supplier","placeholder","Select a Supplier",3,"items","clearable","change"],["id","basic-addon1",1,"input-group-text","bg-primary","pointer","col-auto","fs-4",2,"height","2.9rem",3,"click"],["aria-hidden","true",1,"fa","fa-search","text-white"],[1,"col-6","ps-3"],[1,"col-3","ps-0","pe-5"],["bindLabel","PONumber","bindValue","_id","formControlName","PONumber","placeholder","Select Purchase Order No.",3,"items","clearable","change"],[1,"col-3","ps-4"],["type","date","formControlName","PODate","readonly","",1,"form-control","pe-0"],[1,"col-3","ps-2"],["type","text","name","supplierInvoiceRef","formControlName","supplierInvoiceRef",1,"form-control"],["type","date","formControlName","supplierInvoiceRefDate",1,"form-control"],[1,"row","line-border"],[3,"data","dataChange"],[1,"table-responsive",2,"min-height","22rem"],[1,"table","table-bordered","table-sticky"],[1,"bg-primary"],[1,"text-white"],["sortable","GRNLineNumber",3,"sort"],["sortable","itemCode",3,"sort"],["sortable","itemName",1,"text-start",3,"sort"],["sortable","itemDescription",1,"text-start",3,"sort"],["sortable","UOM",3,"sort"],["sortable","balancedQty",3,"sort"],["sortable","GRNQty",3,"sort"],["sortable","batchDate",3,"sort"],["sortable","invoicedQty",3,"sort"],["sortable","purchaseRate",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-4"],[1,"d-flex","justify-content-end"],[1,"text-nowrap"],[1,"text-nowrap","bg-secondary","text-white","d-flex","align-items-center","px-3","fs-4","h-100"],[1,"d-flex"],["type","text","formControlName","deliveryLocation","readonly","",1,"form-control","border-end-0"],[1,"input-group-text","statusSpanHeight"],[1,"bomDocInfo","pointer",3,"click"],[1,"col-3"],["type","button",1,"btn","btn-primary","px-5","me-3",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],["class","col-4 ps-0 ms-0",4,"ngIf"],["class","col-6",4,"ngIf"],["class","col-md-auto ms-auto",4,"ngIf"],[1,"text-start"],["itemName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],["itemDescription",""],[1,"d-flex","justify-content-between","px-2"],["placement","top",3,"ngbTooltip","ngClass"],[1,"pointer","d-flex","align-items-center"],["class","unit-switch-gray",4,"ngIf"],[1,"d-flex","justify-content-center"],[4,"ngIf"],["class","form-control form-control-sm w-75","type","number",3,"ngModel","ngModelOptions","input","ngModelChange",4,"ngIf"],["class","form-control form-control-sm w-75","type","date",3,"ngModel","ngModelOptions","ngModelChange",4,"ngIf"],["class","form-control form-control-sm w-25","type","number",3,"ngModel","ngModelOptions","input","ngModelChange",4,"ngIf"],[1,"unit-switch-gray"],["type","number",1,"form-control","form-control-sm","w-75",3,"ngModel","ngModelOptions","input","ngModelChange"],["type","date",1,"form-control","form-control-sm","w-75",3,"ngModel","ngModelOptions","ngModelChange"],["type","number",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","input","ngModelChange"],[1,"col-4","ps-0","ms-0"],[1,"text-nowrap","bg-primary","text-white","d-flex","align-items-center","px-3","fs-4"],["type","text","formControlName","remarks",1,"form-control","input-margin"],[1,"col-6"],["type","text","formControlName","cancellationReason",1,"form-control","input-margin"],[1,"col-md-auto","ms-auto"],["class","btn btn-primary px-5 me-4","type","button",3,"click",4,"ngIf"],["type","button","class","btn btn-primary px-5",3,"click",4,"ngIf"],["class","content-end",4,"ngIf"],["type","button",1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"content-end"]],template:function(n,e){1&n&&(t.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),t._uU(5),t.ALo(6,"titlecase"),t.qZA()()(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",6)(11,"div",8)(12,"label",9),t._uU(13,"GRN No."),t.qZA(),t._UZ(14,"input",10),t.qZA(),t.TgZ(15,"div",8)(16,"label",9),t._uU(17,"GRN Date"),t.qZA(),t._UZ(18,"input",11),t.qZA(),t.TgZ(19,"div",7)(20,"label",9),t._uU(21," Supplier Name"),t.TgZ(22,"span",12),t._uU(23,"*"),t.qZA()(),t.TgZ(24,"div",13)(25,"div",14)(26,"ng-select",15),t.NdJ("change",function(r){return e.getPONum(r)}),t.qZA()(),t.TgZ(27,"div",16),t.NdJ("click",function(){return e.openSupplierDetailsModal()}),t._UZ(28,"i",17),t.qZA()()()()(),t.TgZ(29,"div",18)(30,"div",6)(31,"div",19)(32,"label",9),t._uU(33,"PO No."),t.qZA(),t.TgZ(34,"div",13)(35,"div",14)(36,"ng-select",20),t.NdJ("change",function(r){return e.setTableDetails(r)}),t.qZA()(),t.TgZ(37,"div",16),t.NdJ("click",function(){return e.openPODetailsModal()}),t._UZ(38,"i",17),t.qZA()()(),t.TgZ(39,"div",21)(40,"label",9),t._uU(41,"PO Date"),t.qZA(),t._UZ(42,"input",22),t.qZA(),t.TgZ(43,"div",23)(44,"label",9),t._uU(45,"Supplier Inv. No."),t.qZA(),t._UZ(46,"input",24),t.qZA(),t.TgZ(47,"div",23)(48,"label",9),t._uU(49,"Supplier Inv. Dt."),t.qZA(),t._UZ(50,"input",25),t.qZA()()()(),t._UZ(51,"hr",26),t.TgZ(52,"app-setting-header",27),t.NdJ("dataChange",function(r){return e.eventHeader(r)}),t.qZA(),t.TgZ(53,"div",28)(54,"table",29)(55,"thead",30)(56,"tr",31)(57,"th",32),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(58,"SN"),t.qZA(),t.TgZ(59,"th",33),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(60,"Item Code"),t.qZA(),t.TgZ(61,"th",34),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(62,"Item Name"),t.qZA(),t.TgZ(63,"th",35),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(64," Item Description "),t.qZA(),t.TgZ(65,"th",36),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(66,"UoM"),t.qZA(),t.TgZ(67,"th",37),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(68,"PO Bal Qty"),t.qZA(),t.TgZ(69,"th",38),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(70,"GRN Qty"),t.qZA(),t.TgZ(71,"th",39),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(72,"Batch Dt"),t.qZA(),t.TgZ(73,"th",40),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(74,"Inv Qty"),t.qZA(),t.TgZ(75,"th",41),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(76),t.ALo(77,"companyCurrency"),t.qZA(),t.TgZ(78,"th",37),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(79),t.ALo(80,"companyCurrency"),t.qZA()()(),t.TgZ(81,"tbody"),t.YNc(82,$,41,40,"tr",42),t.ALo(83,"slice"),t.ALo(84,"searchFi1ter"),t.qZA()()(),t.TgZ(85,"div",6)(86,"div",43)(87,"div",44)(88,"div",45)(89,"span",46),t._uU(90),t.ALo(91,"labelTranslate"),t.qZA()(),t.TgZ(92,"div",47),t._UZ(93,"input",48),t.TgZ(94,"span",49)(95,"div",50),t.NdJ("click",function(){return e.openStorageLocationMappingModal()}),t.qZA()()()()()(),t._UZ(96,"hr",26),t.TgZ(97,"div",6)(98,"div",51)(99,"div")(100,"button",52),t.NdJ("click",function(){return e.openAditionalInfoModal()}),t._UZ(101,"i",53),t._uU(102," Addional Info "),t.qZA()()(),t.YNc(103,V,5,0,"div",54),t.YNc(104,W,5,0,"div",55),t.YNc(105,it,6,5,"div",56),t.qZA()()()()),2&n&&(t.Q6J("formGroup",e.form),t.xp6(5),t.hij("GRN (",t.lcZ(6,15,e.action),")"),t.xp6(21),t.Q6J("items",e.masterData.suppliersOptions)("clearable",!1),t.xp6(10),t.Q6J("items",e.POFilter)("clearable",!1),t.xp6(16),t.Q6J("data",t.l5B(30,ot,e.page,e.pageSize,e.collection,e.search)),t.xp6(24),t.hij(" Rate | ",t.lcZ(77,17,"INR")," "),t.xp6(3),t.hij(" Inv Amt | ",t.lcZ(80,19,"INR")," "),t.xp6(3),t.Q6J("ngForOf",t.Dn7(83,21,t.xi3(84,25,e.GRNDetailsArray,e.search),(e.page-1)*e.pageSize,(e.page-1)*e.pageSize+e.pageSize))("ngForTrackBy",e.trackByFn),t.xp6(8),t.hij(" ",t.lcZ(91,28,"Delivery Location")," "),t.xp6(13),t.Q6J("ngIf","cancel"!=e.action),t.xp6(1),t.Q6J("ngIf","cancel"==e.action),t.xp6(1),t.Q6J("ngIf","view"!=e.action))},dependencies:[u.mk,u.sg,u.O5,b.P,f._L,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,s.On,A.w9,g.j,u.OU,u.JJ,u.rS,F.G,I.c,J.f,Q.S],styles:[".location[_ngcontent-%COMP%]{padding:0 3rem;border-radius:1.5px;border:.1px solid #302f2f!important;color:#555353!important;height:2.3rem;width:4rem;display:flex;align-items:center;justify-content:center;margin-top:0rem;margin-left:.2rem;font-size:1.3rem}.grn-location-btn-sm[_ngcontent-%COMP%]{margin-top:-.6rem!important;height:2.8rem;font-size:1.4rem!important}.input-margin[_ngcontent-%COMP%]{margin-top:.1rem}"]}),l})();var R=c(25116),at=c(31655),T=c(17645),x=c(53421);function st(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",22,23)(11,"span",24),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td")(22,"div",25),t._UZ(23,"button",26),t.TgZ(24,"div",27)(25,"a",28),t.NdJ("click",function(){const o=t.CHM(i).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"view"))}),t._UZ(26,"i",29),t._uU(27," View "),t.qZA(),t.TgZ(28,"a",28),t.NdJ("click",function(){const o=t.CHM(i).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"edit"))}),t._UZ(29,"i",30),t._uU(30," Edit "),t.qZA(),t.TgZ(31,"a",28),t.NdJ("click",function(){const o=t.CHM(i).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"approve"))}),t._UZ(32,"i",31),t._uU(33," Approve "),t.qZA(),t.TgZ(34,"a",28),t.NdJ("click",function(){const o=t.CHM(i).$implicit,r=t.oxw();return t.KtG(r.update(o,"Report Generated"))}),t._UZ(35,"img",32),t._uU(36," Generate Report "),t.qZA()()()()()}if(2&a){const i=l.$implicit,n=t.MAs(10),e=t.oxw();t.xp6(2),t.Oqu(null==i?null:i.GRNNumber),t.xp6(2),t.Oqu(null==i?null:i.GRNDateS),t.xp6(2),t.Oqu(null==i?null:i.PONumber),t.xp6(2),t.Oqu(null==i?null:i.PODate),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",i.supplier)("positionTarget",n),t.xp6(1),t.hij(" ",i.supplier," "),t.xp6(2),t.Oqu(null==i?null:i.supplierInvoiceRef),t.xp6(2),t.Oqu(null==i?null:i.supplierInvoiceRefDate),t.xp6(2),t.Oqu(null==i?null:i.deliveryLocation),t.xp6(2),t.Oqu(null==i?null:i.GRNStatus),t.xp6(5),t.Q6J("accessType",e.rolePermissionActions.viewAction),t.xp6(3),t.ekj("disable","Approved"===(null==i?null:i.GRNStatus)||"Report Generated"===(null==i?null:i.GRNStatus)),t.Q6J("accessType",e.rolePermissionActions.editAction),t.xp6(3),t.ekj("disable","Approved"===(null==i?null:i.GRNStatus)||"edit"===(null==i?null:i.GRNStatus)),t.Q6J("accessType",e.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Awaiting Approval"===(null==i?null:i.GRNStatus)||"Report Generated"===(null==i?null:i.GRNStatus)),t.Q6J("accessType",e.rolePermissionActions.generateReportAction)}}const lt=function(a,l,i,n){return{page:a,pageSize:l,collection:i,search:n,type:"list"}};let ct=(()=>{var a;class l{constructor(n,e,o,r,d,m,h){this.exportExcelService=n,this.grnServices=e,this.toastService=o,this.spinner=r,this.activatedRoute=d,this.exportToPDFService=m,this.utilityService=h,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Report Generated","Closed","Cancelled","Deleted"],this.rolePermissionActions=R.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(n,e,o){this.utilityService.navigateToForm({path:n,status:e.GRNStatus,action:o,id:e._id,activatedRoute:this.activatedRoute})}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=n.value,this.getAll()}}update(n,e){"Approved"==n?.GRNStatus&&(this.spinner.show(),this.grnServices.update(n._id,{GRNStatus:e}).subscribe(o=>{this.toastService.success(o.message),this.getAll(),this.spinner.hide()}))}trackByFn(n,e){return e?._id}getAll(n=!1,e=""){this.spinner.show();let o={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:n};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.grnServices.getAll(o).subscribe(r=>{"EXCEL"==e?this.excelDownload(r.rows):"PDF"==e?this.pdfDownload(r.rows):(this.tableData=r.rows,this.collection=r.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(n){let e=(0,at.Fh)(n);this.exportToPDFService.generatePdf(e.tableData,e.title)}excelDownload(n){this.exportExcelService.exportExcel((0,T.S8)(n))}onSort({column:n,direction:e}){this.headers.forEach(o=>{o.sortable!==n&&(o.direction="")}),this.column=n,this.direction="asc"==e?1:-1,this.getAll()}}return(a=l).\u0275fac=function(n){return new(n||a)(t.Y36(p.Ol),t.Y36(Z.zP),t.Y36(p.kl),t.Y36(p.V),t.Y36(_.gz),t.Y36(p.$L),t.Y36(p.tI))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-list"]],viewQuery:function(n,e){if(1&n&&t.Gf(g.j,5),2&n){let o;t.iGM(o=t.CRH())&&(e.headers=o)}},decls:36,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],["type","button",1,"btn","btn-primary","btn-add",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","GRNNumber",3,"sort"],["sortable","GRNDateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","PODate",3,"sort"],["sortable","supplier",1,"text-start",3,"sort"],["sortable","supplierInvoiceRef",3,"sort"],["sortable","supplierInvoiceRefDate",3,"sort"],["sortable","deliveryLocation",3,"sort"],["sortable","GRNStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplier",""],[1,"pointer",3,"ngbTooltip","positionTarget"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","me-2","text-success"],["src","./assets/images/new.svg","width","14",1,"me-2"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Goods Receipt Note [GRN] Summary"),t.qZA()(),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return e.navigateTo("../form",{},"create")}),t._UZ(6,"i",5),t._uU(7," Create Goods Receipt Note (GRN) "),t.qZA()(),t._UZ(8,"hr",6),t.TgZ(9,"div",7)(10,"app-setting-header",8),t.NdJ("dataChange",function(r){return e.eventHeader(r)}),t.qZA(),t.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(15,"GRN No."),t.qZA(),t.TgZ(16,"th",13),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(17,"GRN Dt."),t.qZA(),t.TgZ(18,"th",14),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(19,"PO No."),t.qZA(),t.TgZ(20,"th",15),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(21,"PO Date"),t.qZA(),t.TgZ(22,"th",16),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(23,"Supplier Name"),t.qZA(),t.TgZ(24,"th",17),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(25,"Supplier Inv. #"),t.qZA(),t.TgZ(26,"th",18),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(27,"Invoice Dt."),t.qZA(),t.TgZ(28,"th",19),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(29,"Location"),t.qZA(),t.TgZ(30,"th",20),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(31,"GRN Status"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Action"),t.qZA()()(),t.TgZ(34,"tbody"),t.YNc(35,st,37,23,"tr",21),t.qZA()()()()),2&n&&(t.xp6(4),t.Q6J("accessType",e.rolePermissionActions.createAction),t.xp6(6),t.Q6J("data",t.l5B(4,lt,e.page,e.pageSize,e.collection,e.search)),t.xp6(25),t.Q6J("ngForOf",e.tableData)("ngForTrackBy",e.trackByFn))},dependencies:[u.sg,b.P,f._L,g.j,x.J],encapsulation:2}),l})();var pt=c(65876);function ut(a,l){if(1&a){const i=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",18,19)(11,"span",20),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td")(22,"div",21),t._UZ(23,"button",22),t.TgZ(24,"div",23)(25,"a",24),t.NdJ("click",function(){const o=t.CHM(i).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"cancel"))}),t._UZ(26,"i",25),t._uU(27," Cancel "),t.qZA()()()()()}if(2&a){const i=l.$implicit,n=t.MAs(10),e=t.oxw();t.xp6(2),t.Oqu(null==i?null:i.GRNNumber),t.xp6(2),t.Oqu(null==i?null:i.GRNDateS),t.xp6(2),t.Oqu(null==i?null:i.PONumber),t.xp6(2),t.Oqu(null==i?null:i.PODate),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",i.supplier)("positionTarget",n),t.xp6(1),t.hij(" ",i.supplier," "),t.xp6(2),t.Oqu(null==i?null:i.supplierInvoiceRef),t.xp6(2),t.Oqu(null==i?null:i.supplierInvoiceRefDate),t.xp6(2),t.Oqu(null==i?null:i.deliveryLocation),t.xp6(2),t.Oqu(null==i?null:i.GRNStatus),t.xp6(5),t.ekj("disable","Cancelled"===(null==i?null:i.GRNStatus)),t.Q6J("accessType",e.rolePermissionActions.approveAction)}}const dt=function(a,l,i,n){return{page:a,pageSize:l,collection:i,search:n,type:"list"}},ht=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:ct},{path:"form",component:rt,resolve:{accessScreen:pt.x}},{path:"cancel_grn",component:(()=>{var a;class l{constructor(n,e,o,r,d,m,h){this.exportExcelService=n,this.grnServices=e,this.toastService=o,this.router=r,this.spinner=d,this.activatedRoute=m,this.exportToPDFService=h,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Awaiting Approval","Rejected","GRN Partial Created","GRN Created","Closed","Cancelled"],this.rolePermissionActions=R.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(n,e,o){this.router.navigate([n],{relativeTo:this.activatedRoute,queryParams:{id:e?._id,action:o}})}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=n.value,this.getAll()}}update(n,e){"Approved"==n?.GRNStatus&&(this.spinner.show(),this.grnServices.update(n._id,{GRNStatus:e}).subscribe(o=>{this.toastService.success(o.message),this.getAll(),this.spinner.hide()}))}trackByFn(n,e){return e?._id}getAll(n=!1,e=""){this.spinner.show(),this.grnServices.getAll({page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:n}).subscribe(r=>{"EXCEL"==e?this.excelDownload(r.rows):"PDF"==e?this.pdfDownload(r.rows):(this.tableData=r.rows,this.collection=r.count),this.spinner.hide()})}pdfDownload(n){let e=(0,T.G1)(n);this.exportToPDFService.generatePdf(e.tableData,e.title)}excelDownload(n){this.exportExcelService.exportExcel((0,T.Fq)(n))}onSort({column:n,direction:e}){this.headers.forEach(o=>{o.sortable!==n&&(o.direction="")}),this.column=n,this.direction="asc"==e?1:-1,this.getAll()}}return(a=l).\u0275fac=function(n){return new(n||a)(t.Y36(p.Ol),t.Y36(Z.zP),t.Y36(p.kl),t.Y36(_.F0),t.Y36(p.V),t.Y36(_.gz),t.Y36(p.$L))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-cancel-grn"]],viewQuery:function(n,e){if(1&n&&t.Gf(g.j,5),2&n){let o;t.iGM(o=t.CRH())&&(e.headers=o)}},decls:31,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","GRNNumber",3,"sort"],["sortable","GRNDateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","PODate",3,"sort"],["sortable","supplier",1,"text-start",3,"sort"],["sortable","supplierInvoiceRef",3,"sort"],["sortable","supplierInvoiceRefDate",3,"sort"],["sortable","deliveryLocation",3,"sort"],["sortable","GRNStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplier",""],[1,"pointer",3,"ngbTooltip","positionTarget"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-close","fa-lg","text-primary"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Cancellation [GRN] Summary"),t.qZA()(),t.TgZ(4,"div",3)(5,"app-setting-header",4),t.NdJ("dataChange",function(r){return e.eventHeader(r)}),t.qZA(),t.TgZ(6,"table",5)(7,"thead",6)(8,"tr",7)(9,"th",8),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(10,"GRN No."),t.qZA(),t.TgZ(11,"th",9),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(12,"GRN Dt."),t.qZA(),t.TgZ(13,"th",10),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(14,"PO No."),t.qZA(),t.TgZ(15,"th",11),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(16,"PO Date"),t.qZA(),t.TgZ(17,"th",12),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(18,"Supplier Name"),t.qZA(),t.TgZ(19,"th",13),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(20,"Supplier Inv. #"),t.qZA(),t.TgZ(21,"th",14),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(22,"Invoice Dt."),t.qZA(),t.TgZ(23,"th",15),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(24,"Location"),t.qZA(),t.TgZ(25,"th",16),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(26,"GRN Status"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Action"),t.qZA()()(),t.TgZ(29,"tbody"),t.YNc(30,ut,28,16,"tr",17),t.qZA()()()()),2&n&&(t.xp6(5),t.Q6J("data",t.l5B(3,dt,e.page,e.pageSize,e.collection,e.search)),t.xp6(25),t.Q6J("ngForOf",e.tableData)("ngForTrackBy",e.trackByFn))},dependencies:[u.sg,b.P,f._L,g.j,x.J],encapsulation:2}),l})()}];let _t=(()=>{var a;class l{}return(a=l).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[_.Bz.forChild(ht),_.Bz]}),l})();var gt=c(56208);let ft=(()=>{var a;class l{}return(a=l).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[u.ez,_t,gt.m]}),l})()}}]);