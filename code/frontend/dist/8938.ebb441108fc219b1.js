"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[8938],{91090:(v,p,r)=>{r.r(p),r.d(p,{ShortPoClosingModule:()=>q});var d=r(96814),g=r(1076),b=r(43818),c=r(60095),t=r(65879),h=r(37285),C=r(16897),m=r(74659),u=r(99328);let f=(()=>{var s;class l{constructor(o,e,n,i,Z){this.activeModal=o,this.validationService=e,this.purchaseOrderService=n,this.toastService=i,this.spinner=Z,this.action="",this.condition="",this.tableData={},this.btnDisable=!1,this.page=1,this.pageSize=4,this.collection=0,this.search="",this.column="createdAt",this.direction=-1,this.itemId="",this.form=new c.nJ({canceledReason:new c.p4("",[c.kI.required])}),this.findFormErrors=[{message:"Cancel Reason is Required",key:"canceledReason"}]}ngOnInit(){this.collection=this.tableData.length,"view"==this.action&&this.form.disable()}save(){if(this.validationService.checkErrors(this.form,this.findFormErrors))return;this.spinner.show();let o=this.tableData;o.lineStatus="Cancelled",o.canceledReason=this.form.value.canceledReason,o.canceledQty=this.tableData.balancedQty,o.balancedQty=0,this.purchaseOrderService.updatePODetailsLineStatusById(this.tableData._id,o).subscribe(e=>{this.spinner.hide(),this.toastService.success(e.message),this.activeModal.close()})}}return(s=l).\u0275fac=function(o){return new(o||s)(t.Y36(h.Kz),t.Y36(C.RJ),t.Y36(m.x$),t.Y36(u.kl),t.Y36(u.V))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-cancel-po-line"]],inputs:{action:"action",condition:"condition",tableData:"tableData"},decls:54,vars:12,consts:[[1,"modelPage"],[1,"modal-header"],[1,"heading"],["type","button","aria-label","Close",1,"btn","btn-cross","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"row"],[3,"formGroup"],[1,""],[1,"px-5","mt-4"],[1,"table-responsive","px-5",2,"min-height","15rem"],[1,"table","table-bordered","table-sticky"],[1,"text-start"],[1,"col","px-5"],[1,"form-label","mb-3"],[1,"text-danger"],["type","text","formControlName","canceledReason",1,"form-control"],[1,"line-border","my-3","px-5"],[1,"text-center","d-grid","gap-2","d-md-block","mb-4"],["type","button",1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Are you sure that you want to Cancel PO Line Item?"),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return e.activeModal.close(e.tableData)}),t._UZ(6,"i",4),t.qZA()()(),t.TgZ(7,"div",5)(8,"Form",6)(9,"div",7)(10,"h5",8),t._uU(11,"PO Line Details:"),t.qZA(),t.TgZ(12,"div",9)(13,"table",10)(14,"tbody")(15,"tr")(16,"td",11),t._uU(17,"PO #"),t.qZA(),t.TgZ(18,"td"),t._uU(19),t.qZA()(),t.TgZ(20,"tr")(21,"td",11),t._uU(22,"PO Date"),t.qZA(),t.TgZ(23,"td"),t._uU(24),t.qZA()(),t.TgZ(25,"tr")(26,"td",11),t._uU(27,"Item Name"),t.qZA(),t.TgZ(28,"td"),t._uU(29),t.qZA()(),t.TgZ(30,"tr")(31,"td",11),t._uU(32,"Balance Qty"),t.qZA(),t.TgZ(33,"td"),t._uU(34),t.ALo(35,"number"),t.qZA()(),t.TgZ(36,"tr")(37,"td",11),t._uU(38,"Cancel Qty"),t.qZA(),t.TgZ(39,"td"),t._uU(40),t.ALo(41,"number"),t.qZA()()()()(),t.TgZ(42,"div",12)(43,"label",13),t._uU(44," Cancellation Reason"),t.TgZ(45,"span",14),t._uU(46,"*"),t.qZA()(),t._UZ(47,"input",15),t.qZA(),t._UZ(48,"hr",16),t.TgZ(49,"div",17)(50,"button",18),t.NdJ("click",function(){return e.activeModal.close(e.tableData)}),t._uU(51," Close "),t.qZA(),t.TgZ(52,"button",19),t.NdJ("click",function(){return e.save()}),t._uU(53,"Save"),t.qZA()()()()()()),2&o&&(t.xp6(8),t.Q6J("formGroup",e.form),t.xp6(11),t.Oqu(null==e.tableData?null:e.tableData.POLineNumber),t.xp6(5),t.Oqu(null==e.tableData?null:e.tableData.PODate),t.xp6(5),t.Oqu(null==e.tableData?null:e.tableData.itemName),t.xp6(5),t.Oqu(t.xi3(35,6,null==e.tableData?null:e.tableData.balancedQty,"1.2-2")),t.xp6(6),t.Oqu(t.xi3(41,9,null==e.tableData?null:e.tableData.balancedQty,"1.2-2")))},dependencies:[c.Fj,c.JJ,c.JL,c.sg,c.u,d.JJ],encapsulation:2}),l})();var T=r(25116),_=r(22460),A=r(88059),P=r(53421);function S(s,l){if(1&s){const a=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",18,19)(11,"span",20),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.ALo(17,"number"),t.qZA(),t.TgZ(18,"td",18,21)(20,"span",20),t._uU(21),t.qZA()(),t.TgZ(22,"td")(23,"div",22),t._UZ(24,"button",23),t.TgZ(25,"div",24)(26,"a",25),t.NdJ("click",function(){const n=t.CHM(a).$implicit,i=t.oxw();return t.KtG(i.openCancelPoModal(n))}),t._UZ(27,"i",26),t._uU(28," Cancel "),t.qZA()()()()()}if(2&s){const a=l.$implicit,o=t.MAs(10),e=t.MAs(19),n=t.oxw();t.xp6(2),t.Oqu(null==a?null:a.PODate),t.xp6(2),t.Oqu(null==a?null:a.PONumber),t.xp6(2),t.Oqu(null==a?null:a.POLineNumber),t.xp6(2),t.Oqu(null==a?null:a.itemCode),t.xp6(1),t.Udp("width",o.clientWidth),t.xp6(2),t.Q6J("positionTarget",o)("ngbTooltip",a.itemName),t.xp6(1),t.hij(" ",a.itemName," "),t.xp6(2),t.Oqu(null==a?null:a.balancedQty),t.xp6(2),t.Oqu(t.xi3(17,19,null==a?null:a.lineValue,"1.2-2")),t.xp6(2),t.Udp("width",e.clientWidth),t.xp6(2),t.Q6J("positionTarget",e)("ngbTooltip",a.supplierName),t.xp6(1),t.hij(" ",a.supplierName," "),t.xp6(5),t.ekj("disable","Cancelled"===(null==a?null:a.POStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction)}}const y=function(s,l,a,o){return{page:s,pageSize:l,collection:a,search:o,type:"list"}};let D=(()=>{var s;class l{constructor(o,e,n,i,Z,N,x,J,w){this.purchaseService=o,this.router=e,this.toastService=n,this.spinner=i,this.exportExcelService=Z,this.activeModal=N,this.modalService=x,this.activatedRoute=J,this.exportToPDFService=w,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Rejected","GRN Partial Created","GRN Created","Closed","Cancelled"],this.rolePermissionActions=T.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(o,e,n){this.router.navigate([o],{queryParams:{id:e?._id,action:n}})}eventHeader(o){switch(o.key){case"SEARCH":this.search=o.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=o.value,this.getAll()}}getAll(o=!1,e=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:o};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.purchaseService.getAllShortPOForClosing(n).subscribe(i=>{"EXCEL"==e?this.excelDownload(i.rows):"PDF"==e?this.pdfDownload(i.rows):(this.tableData=i.rows,this.collection=i.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(o,e){return e?._id}update(o,e){"Approved"===o?.POStatus&&(o.POStatus=e,this.spinner.show(),this.purchaseService.update(o._id,o).subscribe(n=>{this.toastService.success(n.message),this.getAll(),this.spinner.hide()}))}excelDownload(o){this.exportExcelService.exportExcel((0,_.Ow)(o))}pdfDownload(o){let e=(0,_.m0)(o);this.exportToPDFService.generatePdf(e.tableData,e.title)}onSort({column:o,direction:e}){this.headers.forEach(n=>{n.sortable!==o&&(n.direction="")}),this.column=o,this.direction="asc"==e?1:-1,this.getAll()}openCancelPoModal(o){const e=this.modalService.open(f,{centered:!0,backdrop:"static",keyboard:!1,windowClass:"modelPage"});e.componentInstance.tableData=o,e.result.then(n=>{this.getAll()},n=>{})}}return(s=l).\u0275fac=function(o){return new(o||s)(t.Y36(m.x$),t.Y36(g.F0),t.Y36(u.kl),t.Y36(u.V),t.Y36(u.Ol),t.Y36(h.Kz),t.Y36(h.FF),t.Y36(g.gz),t.Y36(u.$L))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-short-po-closing"]],viewQuery:function(o,e){if(1&o&&t.Gf(b.j,5),2&o){let n;t.iGM(n=t.CRH())&&(e.headers=n)}},decls:30,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"row","line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","PODateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","POLineNumber",3,"sort"],["sortable","itemCode",3,"sort"],["sortable","itemName",1,"text-start",3,"sort"],["sortable","balancedQty",3,"sort"],["sortable","lineValue",3,"sort"],["sortable","supplierName",1,"text-start",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["itemName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],["supplierName",""],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-close","fa-lg","text-primary"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Short PO Closing"),t.qZA()(),t._UZ(4,"hr",3),t.TgZ(5,"div",4)(6,"app-setting-header",5),t.NdJ("dataChange",function(i){return e.eventHeader(i)}),t.qZA(),t.TgZ(7,"table",6)(8,"thead",7)(9,"tr",8)(10,"th",9),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(11,"PO Date"),t.qZA(),t.TgZ(12,"th",10),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(13,"PO #"),t.qZA(),t.TgZ(14,"th",11),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(15,"Line #"),t.qZA(),t.TgZ(16,"th",12),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(17,"Item #"),t.qZA(),t.TgZ(18,"th",13),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(19,"Item Name #"),t.qZA(),t.TgZ(20,"th",14),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(21,"Bal Qty"),t.qZA(),t.TgZ(22,"th",15),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(23,"Bal Value (\u20b9)"),t.qZA(),t.TgZ(24,"th",16),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(25,"Supplier Name"),t.qZA(),t.TgZ(26,"th"),t._uU(27,"Action"),t.qZA()()(),t.TgZ(28,"tbody"),t.YNc(29,S,29,22,"tr",17),t.qZA()()()()),2&o&&(t.xp6(6),t.Q6J("data",t.l5B(3,y,e.page,e.pageSize,e.collection,e.search)),t.xp6(23),t.Q6J("ngForOf",e.tableData)("ngForTrackBy",e.trackByFn))},dependencies:[d.sg,A.P,h._L,b.j,P.J,d.JJ],encapsulation:2}),l})();var U=r(56208);const O=[{path:"",component:D}];let q=(()=>{var s;class l{}return(s=l).\u0275fac=function(o){return new(o||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[h.Kz],imports:[d.ez,g.Bz.forChild(O),U.m]}),l})()},13107:(v,p,r)=>{r.d(p,{t:()=>d});const d={width:24,style:{alignment:{vertical:"middle",horizontal:"center",wrapText:!0}}}},28402:(v,p,r)=>{r.d(p,{J:()=>d});const d=({data:g,headers:b,widths:c,title:t})=>({tableData:{widths:c,headerRows:1,body:[b.map(m=>({text:m.header,style:"header"})),...g.map(m=>b.map(u=>({style:"subheader",text:m[u.key]})))]},title:t})}}]);