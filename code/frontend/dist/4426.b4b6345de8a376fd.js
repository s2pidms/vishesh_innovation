"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4426],{24426:(P,g,c)=>{c.r(g),c.d(g,{ShipmentCreationModule:()=>lt});var l=c(96814),u=c(1076),d=c(43818),N=c(25116),T=c(77055),t=c(65879),h=c(2742),C=c(35747),A=c(88059),_=c(37285),v=c(53421);function b(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",20,21)(9,"span",22),t._uU(10),t.qZA()(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td")(18,"div",23),t._UZ(19,"button",24),t.TgZ(20,"div",25)(21,"a",26),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"view"))}),t._UZ(22,"i",27),t._uU(23," View "),t.qZA(),t.TgZ(24,"a",26),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"edit"))}),t._UZ(25,"i",28),t._uU(26," Edit "),t.qZA(),t.TgZ(27,"a",26),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"rejection"))}),t._UZ(28,"i",29),t._uU(29," Reject "),t.qZA(),t.TgZ(30,"a",26),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"approval"))}),t._UZ(31,"i",30),t._uU(32," Approve "),t.qZA()()()()()}if(2&a){const e=p.$implicit,i=t.MAs(8),n=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.DRNNumber),t.xp6(2),t.Oqu(null==e?null:e.DRNDateS),t.xp6(2),t.Oqu(null==e?null:e.customerCategory),t.xp6(1),t.Udp("width",i.clientWidth),t.xp6(2),t.Q6J("positionTarget",i)("ngbTooltip",e.customerName),t.xp6(1),t.hij(" ",e.customerName?e.customerName:null," "),t.xp6(2),t.Oqu(e.currency[0]),t.xp6(2),t.Oqu(null==e?null:e.shipmentValue),t.xp6(2),t.Oqu(null==e?null:e.SPStatus),t.xp6(5),t.Q6J("accessType",n.rolePermissionActions.viewAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.SPStatus)||"Rejected"===(null==e?null:e.SPStatus)),t.Q6J("accessType",n.rolePermissionActions.editAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.SPStatus)||"Rejected"===(null==e?null:e.SPStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.SPStatus)||"Rejected"===(null==e?null:e.SPStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction)}}const Z=function(a,p,e,i){return{page:a,pageSize:p,collection:e,search:i,type:"list"}};let y=(()=>{class a{constructor(e,i,n,o,r,f,S,x){this.exportExcelService=e,this.shipmentPlanningService=i,this.router=n,this.activatedRoute=o,this.spinner=r,this.exportToPDFService=f,this.appGlobalService=S,this.utilityService=x,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.rolePermissionActions=N.a1,this.menuItemId=""}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll(),this.menuItemId=this.appGlobalService.menuItemId}navigateTo(e,i,n){this.utilityService.navigateToForm({path:e,status:i.SPStatus,action:n,id:i._id,activatedRoute:this.activatedRoute})}trackByFn(e,i){return i?._id}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=e.value,this.getAll()}}getAll(e=!1,i=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,excel:e};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.shipmentPlanningService.getAll(n).subscribe(o=>{"EXCEL"==i?this.excelDownload(o.rows):"PDF"==i?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(e){let i=(0,T.Fp)(e);this.exportToPDFService.generatePdf(i.tableData,i.title)}excelDownload(e){this.exportExcelService.exportExcel((0,T.Mw)(e))}onSort({column:e,direction:i}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.column=e,this.direction="asc"==i?1:-1,this.getAll()}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(h.Ol),t.Y36(C.Cp),t.Y36(u.F0),t.Y36(u.gz),t.Y36(h.V),t.Y36(h.$L),t.Y36(h.P0),t.Y36(h.tI))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-shipment-creation-list"]],viewQuery:function(i,n){if(1&i&&t.Gf(d.j,5),2&i){let o;t.iGM(o=t.CRH())&&(n.headers=o)}},decls:32,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],[1,"plusIconSvg","btn","btn-primary","me-1"],["type","button",1,"btn","btn-primary","btn-add","px-4",3,"click"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-info"],[1,"text-white"],["sortable","DRNId",3,"sort"],["sortable","DRNDateS",3,"sort"],["sortable","SPNumber",3,"sort"],["sortable","customerName",1,"text-start",3,"sort"],["sortable","SPDetails",3,"sort"],["sortable","shipmentValue",3,"sort"],["sortable","SPStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["SKUName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa","fa-times","fa-lg","me-3","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","text-success"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Shipment Summary"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"button",4),t.TgZ(6,"button",5),t.NdJ("click",function(){return n.navigateTo("../form",{},"create")}),t._uU(7," Create New Shipment "),t.qZA()(),t._UZ(8,"hr",6),t.TgZ(9,"div",7)(10,"app-setting-header",8),t.NdJ("dataChange",function(r){return n.eventHeader(r)}),t.qZA(),t.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(15,"DRN No."),t.qZA(),t.TgZ(16,"th",13),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(17,"DRN Date"),t.qZA(),t.TgZ(18,"th",14),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(19,"Customer Category"),t.qZA(),t.TgZ(20,"th",15),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(21,"Customer Name"),t.qZA(),t.TgZ(22,"th",16),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(23,"Currency"),t.qZA(),t.TgZ(24,"th",17),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(25,"Shipment Value"),t.qZA(),t.TgZ(26,"th",18),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(27,"Status"),t.qZA(),t.TgZ(28,"th"),t._uU(29,"Action"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,b,33,21,"tr",19),t.qZA()()()()),2&i&&(t.xp6(4),t.Q6J("accessType",n.rolePermissionActions.createAction),t.xp6(6),t.Q6J("data",t.l5B(4,Z,n.page,n.pageSize,n.collection,n.search)),t.xp6(21),t.Q6J("ngForOf",n.tableData)("ngForTrackBy",n.trackByFn))},dependencies:[l.sg,A.P,_._L,d.j,v.J],encapsulation:2})}return a})();var s=c(60095),I=c(21631),U=c(22096),m=c(77203),O=c(51785),F=c(56438),k=c(16897),w=c(50363),V=c(95346),L=c(14906),q=c(83344),M=c(84231);function J(a,p){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==e?null:e.purchaseRate,".2-2")," ")}}const R=function(){return{standalone:!0}};function Q(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"input",44),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.purchaseRate=n)})("input",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.setLineValue(n))}),t.qZA()}if(2&a){const e=t.oxw().$implicit;t.Q6J("ngModel",e.purchaseRate)("ngModelOptions",t.DdM(2,R))}}function G(a,p){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==e?null:e.discount,".2-2")," ")}}function K(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"input",44),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.discount=n)})("input",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.setNetRate(n))}),t.qZA()}if(2&a){const e=t.oxw().$implicit;t.Q6J("ngModel",e.discount)("ngModelOptions",t.DdM(2,R))}}const D=function(){return["approval","rejection","view","generate","cancel"]};function E(a,p){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td",38,39)(7,"span",40),t._uU(8),t.qZA()(),t.TgZ(9,"td",38,41)(11,"span",40),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"SalesUOMUnitMaster"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.ALo(18,"number"),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td")(22,"div",42),t.YNc(23,J,3,4,"span",37),t.YNc(24,Q,1,3,"input",43),t.qZA()(),t.TgZ(25,"td")(26,"div",42),t.YNc(27,G,3,4,"span",37),t.YNc(28,K,1,3,"input",43),t.qZA()(),t.TgZ(29,"td"),t._uU(30),t.ALo(31,"number"),t.qZA(),t.TgZ(32,"td"),t._uU(33),t.ALo(34,"number"),t.qZA()()),2&a){const e=p.$implicit,i=p.index,n=t.MAs(6),o=t.MAs(10),r=t.oxw();t.xp6(2),t.Oqu(i+1),t.xp6(2),t.Oqu(null==e?null:e.SKUNo),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",e.SKUName)("positionTarget",n),t.xp6(1),t.hij(" ",null==e?null:e.SKUName," "),t.xp6(1),t.Udp("width",o.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",e.SKUDescription)("positionTarget",o),t.xp6(1),t.hij(" ",null==e?null:e.SKUDescription," "),t.xp6(2),t.Oqu(t.lcZ(15,21,null==e?null:e.UOM)),t.xp6(3),t.Oqu(t.xi3(18,23,null==e?null:e.dispatchQty,".2-2")),t.xp6(3),t.hij(" ",null==e?null:e.batchDate," "),t.xp6(3),t.Q6J("ngIf",t.DdM(32,D).includes(r.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(33,D).includes(r.action)),t.xp6(3),t.Q6J("ngIf",t.DdM(34,D).includes(r.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(35,D).includes(r.action)),t.xp6(2),t.hij(" ",t.xi3(31,26,null==e?null:e.netRate,"1.2-2")," "),t.xp6(3),t.hij(" ",t.xi3(34,29,null==e?null:e.lineValue,"1.2-2")," ")}}function j(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"div",47)(1,"div",53)(2,"div",54),t._UZ(3,"button",55),t.TgZ(4,"button",56),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.openShipmentDetailsModal())}),t._uU(5," Shipment Details "),t.qZA()()()()}}function Y(a,p){1&a&&(t.TgZ(0,"div",47)(1,"div",42)(2,"div",57),t._uU(3," Total Shipment Value: "),t.TgZ(4,"button",58),t._uU(5),t.ALo(6,"companyCurrency"),t.qZA()(),t._UZ(7,"input",59),t.qZA()()),2&a&&(t.xp6(5),t.hij(" ",t.lcZ(6,1,"INR")," "))}function B(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.reset())}),t._uU(1," Reset "),t.qZA()}}function H(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"button",61),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.submit())}),t._uU(1," Save "),t.qZA()}}function z(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"div",47)(1,"button",61),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.submit())}),t._uU(2,"Approve"),t.qZA()()}}function $(a,p){if(1&a){const e=t.EpF();t.TgZ(0,"div",62)(1,"div",63)(2,"span",64),t._uU(3," Remark"),t.qZA(),t._UZ(4,"input",65),t.qZA(),t.TgZ(5,"div",66)(6,"div",42)(7,"div",57),t._uU(8," Total Shipment Value: "),t.TgZ(9,"button",58),t._uU(10),t.ALo(11,"companyCurrency"),t.qZA()(),t._UZ(12,"input",59),t.qZA()(),t.TgZ(13,"div",67)(14,"button",61),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.submit())}),t._uU(15,"Reject"),t.qZA()()()}2&a&&(t.xp6(10),t.hij(" ",t.lcZ(11,1,"INR")," "))}const X=function(){return["create","edit","approval","view"]},W=function(){return["create","edit","approval"]},tt=function(){return["view","edit","rejection","approval"]},et=function(){return["create","edit"]};function nt(a,p){if(1&a&&(t.ynx(0),t._UZ(1,"hr",21),t.TgZ(2,"div",45),t.YNc(3,j,6,0,"div",46),t.YNc(4,Y,8,3,"div",46),t.TgZ(5,"div",47)(6,"div",48),t.YNc(7,B,2,0,"button",49),t.YNc(8,H,2,0,"button",50),t.qZA()(),t.YNc(9,z,3,0,"div",46),t.qZA(),t.TgZ(10,"div",51),t.YNc(11,$,16,3,"div",52),t.qZA(),t.BQk()),2&a){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",t.DdM(6,X).includes(e.action)),t.xp6(1),t.Q6J("ngIf",t.DdM(7,W).includes(e.action)),t.xp6(3),t.Q6J("ngIf",!t.DdM(8,tt).includes(e.action)),t.xp6(1),t.Q6J("ngIf",t.DdM(9,et).includes(e.action)),t.xp6(1),t.Q6J("ngIf","approval"==e.action),t.xp6(2),t.Q6J("ngIf","rejection"==e.action)}}const it=function(a,p,e,i){return{page:a,pageSize:p,collection:e,search:i,excelDisplay:"none"}};let ot=(()=>{class a{constructor(e,i,n,o,r,f,S,x){this.shipmentPlanningService=e,this.activatedRoute=i,this.spinner=n,this.location=o,this.toastService=r,this.validationService=f,this.modalService=S,this.utilityService=x,this.SPDetailsArray=[],this.customerName="",this.findFormErrors=[],this.DRNOptions=[],this.DRNList=[],this.salesCategory=[],this.dispatchDetails={},this.selectedCustomer={},this.page=1,this.pageSize=6,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.submitted=!1,this.isPreview=!1,this.action="create",this.statusArr={create:"Awaiting Approval",edit:"Awaiting Approval",approval:"Approved",cancel:"Cancelled",rejection:"Rejected"},this.otherCharges={action:"create",totalProductValue:0,packagingAndForwarding:0,freight:0,insurance:0,loadingAndUnloading:0,miscellaneous:0,totalAmount:0,totalShipmentValue:0},this.masterData={autoIncrementNo:"",billFromLocationOptions:[],freightTermsOptions:[],modeOfTransportOptions:[],paymentTermsOptions:[],transporterOptions:[],companyData:{_id:"",placesOfBusiness:[]}},this.form=new s.nJ({_id:new s.p4(null),SPNumber:new s.p4(null),SPTotalAmount:new s.p4(null),DRNId:new s.p4(null,[s.kI.required]),DRNDate:new s.p4(null),customer:new s.p4(""),billFromLocation:new s.p4(null,[s.kI.required]),SPDetails:new s.p4([]),remarks:new s.p4(null),shipmentValue:new s.p4(null),SPV:new s.p4(null),billFromAddress:new s.p4({}),billToAddress:new s.p4({}),SPStatus:new s.p4("Awaiting Approval",[s.kI.required]),customerCategory:new s.p4(""),currency:new s.p4(null),customerShippingAddress:new s.p4({}),paymentTerms:new s.p4(null,[s.kI.required]),modeOfTransport:new s.p4(null,[s.kI.required]),frightTerms:new s.p4(null,[s.kI.required]),transporter:new s.p4(null,[s.kI.required]),destination:new s.p4(null,[s.kI.required]),packingList:new s.p4(null),exportsInfo:new s.nJ({exportsInvoiceNo:new s.p4(null),exportsInvoiceDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD")),exportsInvoiceTotalValue:new s.p4(null),exchangeRate:new s.p4(null),finalDestination:new s.p4(null)})})}get f(){return this.form.controls}trackByFn(e,i){return i?._id}submit(){if(this.submitted=!0,this.isPreview=!1,this.form.enable(),this.validationService.checkErrors(this.form,O.JT))return;if("rejection"==this.action&&!this.form.controls.remarks.value)return void this.toastService.warning("Reject Remark is Required");if(0==this.SPDetailsArray.length)return void this.toastService.warning("Atleast one row is Required");let e={...this.form.value,...this.dispatchDetails};e.otherCharges=this.otherCharges,e.SPDetails=this.SPDetailsArray.filter(i=>i.dispatchQty>0)?.map(i=>(i.discount=i?.discount??0,i)),e._id?this.update(e):(delete e._id,this.create(e))}ngOnInit(){this.getInitialData()}update(e){this.spinner.show(),this.shipmentPlanningService.update(e._id,e).subscribe(i=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(i.message),this.location.back()})}create(e){this.spinner.show(),this.shipmentPlanningService.create(e).subscribe(i=>{this.submitted=!1,this.spinner.hide(),this.toastService.success(i.message),this.location.back()})}preview(){this.search="",this.SPDetailsArray=this.SPDetailsArray.filter(e=>e.dispatchQty>0),this.SPDetailsArray.length&&(this.isPreview=!0),this.collection=this.SPDetailsArray.length}reset(){this.form.reset(),this.customerName="",this.SPDetailsArray=[],this.collection=this.SPDetailsArray.length,this.getInitialData()}getInitialData(){this.spinner.show(),this.shipmentPlanningService.getAllMasterData({}).subscribe(e=>{this.masterData=e,this.form.controls.SPNumber.patchValue(this.masterData?.autoIncrementNo),this.form.controls.SPStatus.patchValue("Awaiting Approval"),this.form.controls.SPStatus.setValue(this.statusArr[this.action]),this.DRNList=e.DRNList,this.DRNOptions=e.DRNList,this.salesCategory=e.salesCategory,this.activatedRoute.queryParams.pipe((0,I.z)(i=>(this.action=i.action,this.utilityService.accessDenied(this.action),i.id?this.shipmentPlanningService.getById(i.id):(0,U.of)({})))).subscribe(i=>{this.spinner.hide(),0!=Object.keys(i).length&&(i.DRNDate&&(i.DRNDate=i.DRNDate.split("T")[0]),i.DRNId._id&&(this.DRNOptions=[{DRNNumber:i.DRNId.DRNNumber,_id:i.DRNId?._id}],i.DRNId=i.DRNId?._id),this.customerName=i?.customer?.customerName,this.selectedCustomer=i?.customer,this.SPDetailsArray=i?.SPDetails.map((n,o)=>({SPLineNumber:n?.SONumber,SONumber:n?.SONumber,SODate:n.SODate,SKUNo:n.SKUNo,SKUName:n.SKUName,SKUDescription:n.SKUDescription,UOM:n.UOM,dispatchQty:n.dispatchQty,currency:n.currency,purchaseRate:n.standardRate,discount:n.discount,netRate:n.netRate,lineValue:n.lineValue,SPVLine:n.SPVLine,DRNLineNumber:n.DRNLineNumber,standardRate:n.standardRate,SKU:n.SKU,SOId:n.SOId,FGINQty:n.FGINQty,FGINMfgDate:n?.FGINMfgDate,batchDate:n?.batchDate,FGINId:n.FGINId})),this.otherCharges=i.otherCharges,this.collection=this.SPDetailsArray.length,i.SPStatus=this.statusArr[this.action],this.form.patchValue(i),this.dispatchDetails={customerShippingAddress:i.customerShippingAddress,modeOfTransport:i.modeOfTransport,frightTerms:i.frightTerms,transporter:i.transporter,destination:i.destination},("edit"==this.action||"view"==this.action||"approval"==this.action)&&this.form.disable(),"rejection"==this.action&&(this.form.disable(),this.form.controls.remarks.enable()))})})}openDispatchDetailsModal(){const e=this.modalService.open(m.XB,{centered:!0,backdrop:"static",keyboard:!1,windowClass:"modelPage"});e.componentInstance.dispatchDetails=this.dispatchDetails,e.componentInstance.otherCharges=this.otherCharges,e.componentInstance.action=this.action,e.componentInstance.data={transporterArr:this.masterData?.transporterOptions,freightTerms:this.masterData?.freightTermsOptions,modeOfTransport:this.masterData?.modeOfTransportOptions,addressArr:this.selectedCustomer?.customerShippingAddress},e.result.then(i=>{["create","edit"].includes(this.action)&&(this.dispatchDetails=i,this.otherCharges=i.otherCharges)},i=>{})}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value;break;case"EXCEL":default:break;case"PAGE":this.page=e.value}}onSort({column:e,direction:i}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.SPDetailsArray=""===i||""===e?this.SPDetailsArray:[...this.SPDetailsArray].sort((n,o)=>{let r="string"==typeof n[e]?n[e].toLowerCase():n[e],f="string"==typeof o[e]?o[e].toLowerCase():o[e];const S=r<f?-1:r>f?1:0;return"asc"===i?S:-S})}DRNNumberValueChange(e){this.customerName=e.customer.customerName,this.selectedCustomer=e.customer,this.selectedCustomer&&this.selectedCustomer.customerShippingAddress.length>0&&(this.f.billToAddress.patchValue(this.selectedCustomer?.customerShippingAddress[0]),this.f.customerShippingAddress.patchValue(this.selectedCustomer?.customerShippingAddress[0])),this.f.DRNDate.patchValue(this.utilityService.getFormatDate(e?.DRNDate,"YYYY-MM-DD")),this.f.customerCategory.setValue(e?.salesCategory),this.f.paymentTerms.setValue(e?.paymentTerms),this.f.exportsInfo.patchValue(e?.exportsInfo),this.f.modeOfTransport.setValue(e?.modeOfTransport),this.f.frightTerms.setValue(e?.frightTerms),this.f.transporter.setValue(e?.transporter),this.f.destination.setValue(e?.destination),this.f.currency.setValue(e?.customer?.customerCurrency),this.f.customer.patchValue(e?.customer?._id),this.f.DRNDate.disable(),this.f.customer.disable();let i=this.DRNList.find(n=>n._id==this.f.DRNId.value);this.SPDetailsArray=i.DRNDetails.map((n,o)=>({SPLineNumber:o+1,SOId:n?.SOId,SONumber:n?.SONumber,SODate:n?.SODate,SKU:n?.SKU,SKUNo:n?.SKUNo,SKUName:n?.SKUName,SKUDescription:n?.SKUDescription,UOM:n?.UOM,dispatchQty:n?.dispatchQty,currency:n?.currency,standardRate:n?.standardRate,purchaseRate:n?.standardRate,discount:n?.discount??0,netRate:n?.netRate??n?.standardRate,lineValue:+n?.netRate*+n?.dispatchQty,SPVLine:0,DRNLineNumber:n?.DRNLineNumber,FGINQty:n?.FGINQty,FGINMfgDate:n?.FGINMfgDate,batchDate:n?.tBatchNo,FGINId:n.FGINId})),this.collection=this.SPDetailsArray.length,this.f.SPTotalAmount.setValue(this.SPDetailsArray.map(n=>+n.lineValue).reduce((n,o)=>+n+ +o,0).toFixed(2)),this.f.shipmentValue.setValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)),this.f.SPV.setValue(this.SPDetailsArray.map(n=>+n.SPVLine).reduce((n,o)=>+n+ +o,0).toFixed(2))}setLineValue(e){let i=this.SPDetailsArray.findIndex(n=>n.DRNLineNumber==e.DRNLineNumber&&n.SKUNo==e.SKUNo&&n.SONumber==e.SONumber);this.SPDetailsArray[i].netRate=+e.purchaseRate-+e.discount/100*+e.purchaseRate,this.SPDetailsArray[i].lineValue=+e.dispatchQty*+e.netRate,this.SPDetailsArray[i].SPVLine=+e.dispatchQty*+e.standardRate-+e.dispatchQty*+e.netRate,this.f.SPTotalAmount.setValue(this.SPDetailsArray.map(n=>+n.lineValue).reduce((n,o)=>+n+ +o,0).toFixed(2)),this.f.shipmentValue.patchValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)),this.f.SPV.setValue(this.SPDetailsArray.map(n=>+n.SPVLine).reduce((n,o)=>+n+ +o,0).toFixed(2))}setNetRate(e){let i=this.SPDetailsArray.findIndex(n=>n.DRNLineNumber==e.DRNLineNumber&&n.SKUNo==e.SKUNo&&n.SONumber==e.SONumber);this.SPDetailsArray[i].netRate=+e.purchaseRate-+e.discount/100*+e.purchaseRate,this.SPDetailsArray[i].lineValue=+e.dispatchQty*+e.netRate,this.SPDetailsArray[i].SPVLine=+e.dispatchQty*+e.standardRate-+e.dispatchQty*+e.netRate,this.f.SPTotalAmount.setValue(this.SPDetailsArray.map(n=>+n.lineValue).reduce((n,o)=>+n+ +o,0).toFixed(2)),this.f.shipmentValue.setValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)),this.f.SPV.setValue(this.SPDetailsArray.map(n=>+n.SPVLine).reduce((n,o)=>+n+ +o,0).toFixed(2))}openOtherChargesModal(){const e=this.modalService.open(m.Oy,{centered:!0,size:"md",backdrop:"static",keyboard:!1});this.otherCharges.action=this.action,e.componentInstance.otherCharges=this.otherCharges,e.result.then(i=>{["create","edit"].includes(this.action)&&(this.otherCharges=i,this.f.shipmentValue.patchValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)))},i=>{})}openViewDRNTermsModal(){const e=this.modalService.open(F.af,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.SOTermsArr={transporterArr:this.masterData?.transporterOptions,freightTerms:this.masterData?.freightTermsOptions,modeOfTransport:this.masterData?.modeOfTransportOptions,paymentTermsArr:this.masterData?.paymentTermsOptions},e.componentInstance.SOTermsData={paymentTerms:this.form.controls.paymentTerms.value,modeOfTransport:this.form.controls.modeOfTransport.value,frightTerms:this.form.controls.frightTerms.value,transporter:this.form.controls.transporter.value,destination:this.form.controls.destination.value},e.componentInstance.billFromAddress=this.form.controls.billFromAddress.value,e.componentInstance.billToAddress=this.form.controls.billToAddress.value,e.componentInstance.billFromLocation=this.form.controls.billFromLocation.value,e.componentInstance.billFromCompanyData=this.masterData?.companyData,e.componentInstance.billFromLocationArr=this.masterData?.billFromLocationOptions,e.componentInstance.customerShippingAddress=this.form.controls.customerShippingAddress.value,e.componentInstance.selectedCustomerData=this.selectedCustomer?.customerShippingAddress,e.componentInstance.otherCharges=this.otherCharges,e.result.then(i=>{i&&["create","edit"].includes(this.action)&&(this.form.patchValue(i?.SOTermsData),this.form.controls.billFromAddress.patchValue(i?.billFromAddress),this.form.controls.billToAddress.patchValue(i?.billToAddress),this.form.controls.customerShippingAddress.patchValue(i?.customerShippingAddress),this.form.controls.billFromLocation.setValue(i?.billFromLocation))},i=>{})}openShipmentDetailsModal(){const e=this.modalService.open(F.z8,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.shipmentLineValue=this.form.controls.shipmentValue.value,e.componentInstance.SPTotalAmount=this.f.SPTotalAmount.value,e.componentInstance.packingList=this.form.controls.packingList.value,e.componentInstance.otherCharges=this.otherCharges,e.result.then(i=>{i&&["create","edit"].includes(this.action)&&(this.form.controls.packingList.setValue(i?.packingList),this.otherCharges=i?.otherCharges,this.form.controls.shipmentValue.setValue(i?.otherCharges?.totalShipmentValue))},i=>{})}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(C.Cp),t.Y36(u.gz),t.Y36(h.V),t.Y36(l.Ye),t.Y36(h.kl),t.Y36(k.RJ),t.Y36(_.FF),t.Y36(h.tI))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-shipment-creation-form"]],viewQuery:function(i,n){if(1&i&&t.Gf(d.j,5),2&i){let o;t.iGM(o=t.CRH())&&(n.headers=o)}},decls:80,vars:31,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading","ms-2"],[1,"form-body"],[1,"row"],[1,"col-4","pe-0"],[1,"col-7","pe-2"],[1,"form-label"],[1,"text-danger"],["bindLabel","DRNNumber","bindValue","_id","formControlName","DRNId",3,"items","clearable","change"],[1,"col-5","ps-4"],["type","date","formControlName","DRNDate","readonly","",1,"form-control"],[1,"col-md-2","pe-0"],["type","text","readonly","","formControlName","customerCategory",1,"form-control"],[1,"col-3"],["type","text","readonly","",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange"],[1,"col-5","ps-2","pe-0"],["type","text","readonly","","formControlName","currency",1,"form-control"],[1,"col-7","ps-0","d-flex","justify-content-end","align-items-end"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","line-border"],[1,""],[3,"data","dataChange"],[1,"table-responsive","text-wrap",2,"min-height","22rem"],[1,"table","table-bordered","table-sticky"],[1,"bg-info"],[1,"text-white"],["sortable","SKUNo",3,"sort"],["sortable","SKUName",1,"text-start",3,"sort"],["sortable","SKUDescription",1,"text-start",3,"sort"],["sortable","UOM",3,"sort"],["sortable","SOBalancedQty",3,"sort"],["sortable","FGINMfgDate",3,"sort"],["sortable","FGINQty",3,"sort"],["sortable","dispatchQty",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"text-start"],["SKUName",""],[1,"pointer",3,"ngbTooltip","positionTarget"],["SKUDescription",""],[1,"d-flex","justify-content-center"],["type","number","class","form-control form-control-xs w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["type","number",1,"form-control","form-control-xs","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],[1,"row","d-flex","justify-content-between","align-items-center","mb-0"],["class","col-md-auto",4,"ngIf"],[1,"col-md-auto"],[1,"d-grid","gap-2","d-md-block"],["class","btn btn-primary px-5 me-4",3,"click",4,"ngIf"],["class","btn btn-primary px-5","type","button",3,"click",4,"ngIf"],[1,"row","d-flex"],["class","d-flex justify-content-start",4,"ngIf"],[1,"d-flex"],[1,"col-form-label","text-nowrap","me-2"],[1,"plusIconSvg","btn","btn-primary","me-1"],["type","button",1,"btn","btn-primary","px-4",3,"click"],[1,"col-form-label","text-nowrap","pe-1","pt-0"],["type","button",1,"btn","btn-info","py-1","ms-2"],["type","number","formControlName","shipmentValue","readonly","",1,"form-control"],[1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"d-flex","justify-content-start"],[1,"d-flex","inputGroup","ms-0","col-4"],[1,"input-group-text","text-white","bg-primary"],["type","text","formControlName","remarks",1,"form-control"],[1,"col-5","ms-5"],[1,"col-3","text-end","pe-5"]],template:function(i,n){1&i&&(t.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label"),t._uU(5),t.ALo(6,"titlecase"),t.qZA()()(),t.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",5)(11,"div",7)(12,"label",8),t._uU(13," DRN No. "),t.TgZ(14,"span",9),t._uU(15,"*"),t.qZA()(),t.TgZ(16,"ng-select",10),t.NdJ("change",function(r){return n.DRNNumberValueChange(r)}),t.qZA()(),t.TgZ(17,"div",11)(18,"label",8),t._uU(19," DRN Date "),t._UZ(20,"span",9),t.qZA(),t._UZ(21,"input",12),t.qZA()()(),t.TgZ(22,"div",13)(23,"label",8),t._uU(24," Customer Category"),t.TgZ(25,"span",9),t._uU(26,"*"),t.qZA()(),t._UZ(27,"input",14),t.qZA(),t.TgZ(28,"div",15)(29,"label",8),t._uU(30," Customer Name "),t.TgZ(31,"span",9),t._uU(32,"*"),t.qZA()(),t.TgZ(33,"input",16),t.NdJ("ngModelChange",function(r){return n.customerName=r}),t.qZA()(),t.TgZ(34,"div",15)(35,"div",5)(36,"div",17)(37,"label",8),t._uU(38," Currency"),t._UZ(39,"span",9),t.qZA(),t._UZ(40,"input",18),t.qZA(),t.TgZ(41,"div",19)(42,"button",20),t.NdJ("click",function(){return n.openViewDRNTermsModal()}),t._uU(43," Shipment Terms "),t.qZA()()()()()(),t._UZ(44,"hr",21),t.TgZ(45,"div",22)(46,"app-setting-header",23),t.NdJ("dataChange",function(r){return n.eventHeader(r)}),t.qZA()(),t.TgZ(47,"div",24)(48,"table",25)(49,"thead",26)(50,"tr",27)(51,"th"),t._uU(52,"#"),t.qZA(),t.TgZ(53,"th",28),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(54,"SKU No."),t.qZA(),t.TgZ(55,"th",29),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(56),t.ALo(57,"labelTranslate"),t.qZA(),t.TgZ(58,"th",30),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(59),t.ALo(60,"labelTranslate"),t.qZA(),t.TgZ(61,"th",31),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(62,"UoM"),t.qZA(),t.TgZ(63,"th",32),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(64,"Disp. Qty"),t.qZA(),t.TgZ(65,"th",33),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(66,"Batch Date"),t.qZA(),t.TgZ(67,"th",34),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(68,"Rate/Unit"),t.qZA(),t.TgZ(69,"th",35),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(70,"Disc %"),t.qZA(),t.TgZ(71,"th",35),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(72,"Net Rate"),t.qZA(),t.TgZ(73,"th",35),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(74,"Line Value"),t.qZA()()(),t.TgZ(75,"tbody"),t.YNc(76,E,35,36,"tr",36),t.ALo(77,"slice"),t.ALo(78,"searchFi1ter"),t.qZA()()(),t.YNc(79,nt,12,10,"ng-container",37),t.qZA()()),2&i&&(t.Q6J("formGroup",n.form),t.xp6(5),t.hij(" Shipment [",t.lcZ(6,12,n.action),"]"),t.xp6(11),t.Q6J("items",n.DRNOptions)("clearable",!1),t.xp6(17),t.Q6J("ngModel",n.customerName)("ngModelOptions",t.DdM(25,R)),t.xp6(13),t.Q6J("data",t.l5B(26,it,n.page,n.pageSize,n.collection,n.search)),t.xp6(10),t.hij(" ",t.lcZ(57,14,"SKU Name")," "),t.xp6(3),t.hij(" ",t.lcZ(60,16,"SKU Description")," "),t.xp6(17),t.Q6J("ngForOf",t.Dn7(77,18,t.xi3(78,22,n.SPDetailsArray,n.search),(n.page-1)*n.pageSize,(n.page-1)*n.pageSize+n.pageSize))("ngForTrackBy",n.trackByFn),t.xp6(3),t.Q6J("ngIf","approval"==n.action||"rejection"==n.action||"generate"==n.action||"create"==n.action||"edit"==n.action||"view"==n.action))},dependencies:[l.sg,l.O5,A.P,_._L,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,s.On,w.w9,d.j,l.OU,l.JJ,l.rS,V.G,L.c,q.f,M.Q],encapsulation:2})}return a})();var rt=c(56208);const st=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:y},{path:"form",component:ot,resolve:{accessScreen:c(65876).x}}];let lt=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#n=this.\u0275inj=t.cJS({imports:[l.ez,u.Bz.forChild(st),rt.m]})}return a})()},77055:(P,g,c)=>{c.d(g,{xL:()=>b,Rn:()=>v,Fp:()=>h,Mw:()=>t});var l=c(13107),u=c(28402);let d=["*","*","*","*","*","*","*","*","*","*","*","*"],N="ShipmentPlanning Report",T=[{header:"Shipment ID",key:"SPNumber",...l.t},{header:"DRN No.",key:"DRNNumber",...l.t},{header:"DRN Date",key:"DRNDateS",...l.t},{header:"Customer Name",key:"customerName",...l.t},{header:"Bill From Location",key:"billFromLocation",...l.t},{header:"Currency",key:"currency",...l.t},{header:"Product Value",key:"SPTotalAmount",...l.t},{header:"Shipment Value",key:"shipmentValue",...l.t},{header:"SPV",key:"SPV",...l.t},{header:"Status",key:"SPStatus",...l.t}];const t=m=>({title:N,csvData:m,headers:T}),h=m=>(0,u.J)({data:m,headers:T,widths:d,title:N});let C=["*","*","*","*","*","*","*","*","*","*","*"],A="Advance Shipment Notice",_=[{header:"Invoice #",key:"salesInvoiceNumber",...l.t},{header:"Invoice Date",key:"salesInvoiceDate",...l.t},{header:"Invoice Value",key:"invoiceValue",...l.t},{header:"ASN #",key:"ASNNumber",...l.t},{header:"Customer Name",key:"customerName",...l.t},{header:"State of supply",key:"stateOfSupply",...l.t},{header:"Total Boxes",key:"totalNoOfBoxes",...l.t},{header:"Total Weight(kgs)",key:"totalGrossWeight",...l.t},{header:"Transporter",key:"transporter",...l.t},{header:"Status",key:"ASNStatus",...l.t}];const v=m=>({title:A,csvData:m,headers:_}),b=m=>(0,u.J)({data:m,headers:_,widths:C,title:A})},51785:(P,g,c)=>{c.d(g,{B7:()=>u,JT:()=>d}),c(21821);const u=[{message:"Invoice No. is Required",key:"salesInvoice"},{message:"Invoice Date is Required",key:"salesInvoiceDate"},{message:"Invoice Value is Required",key:"invoiceValue"},{message:"Customer Name is Required",key:"customerName"},{message:"Total No. of Boxes is Required",key:"totalNoOfBoxes"},{message:"Total Gross weight(kgs) is Required",key:"totalGrossWeight"}],d=[{message:"DRN No. is Required",key:"DRNId"},{message:"Bill From Location is Required",key:"billFromLocation"},{message:"Payment Terms is Required",key:"paymentTerms"},{message:"Mode Of Transport is Required",key:"modeOfTransport"},{message:"Fright Terms is Required",key:"frightTerms"},{message:"Transporter Name is Required",key:"transporter"},{message:"Destination/Port is Required",key:"destination"}]}}]);