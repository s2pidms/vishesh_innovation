"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[4426],{24426:(I,g,c)=>{c.r(g),c.d(g,{ShipmentCreationModule:()=>ct});var l=c(96814),h=c(1076),d=c(43818),N=c(25116),C=c(77055),t=c(65879),u=c(2742),y=c(35747),A=c(88059),_=c(37285),b=c(53421);function Z(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",20,21)(9,"span",22),t._uU(10),t.qZA()(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td")(18,"div",23),t._UZ(19,"button",24),t.TgZ(20,"div",25)(21,"a",26),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",i,"view"))}),t._UZ(22,"i",27),t._uU(23," View "),t.qZA(),t.TgZ(24,"a",26),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",i,"edit"))}),t._UZ(25,"i",28),t._uU(26," Edit "),t.qZA(),t.TgZ(27,"a",26),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",i,"rejection"))}),t._UZ(28,"i",29),t._uU(29," Reject "),t.qZA(),t.TgZ(30,"a",26),t.NdJ("click",function(){const i=t.CHM(o).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",i,"approval"))}),t._UZ(31,"i",30),t._uU(32," Approve "),t.qZA()()()()()}if(2&a){const o=p.$implicit,n=t.MAs(8),e=t.oxw();t.xp6(2),t.Oqu(null==o?null:o.DRNNumber),t.xp6(2),t.Oqu(null==o?null:o.DRNDateS),t.xp6(2),t.Oqu(null==o?null:o.customerCategory),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",o.customerName),t.xp6(1),t.hij(" ",o.customerName?o.customerName:null," "),t.xp6(2),t.Oqu(o.currency[0]),t.xp6(2),t.Oqu(null==o?null:o.shipmentValue),t.xp6(2),t.Oqu(null==o?null:o.SPStatus),t.xp6(5),t.Q6J("accessType",e.rolePermissionActions.viewAction),t.xp6(3),t.ekj("disable","Approved"===(null==o?null:o.SPStatus)||"Rejected"===(null==o?null:o.SPStatus)),t.Q6J("accessType",e.rolePermissionActions.editAction),t.xp6(3),t.ekj("disable","Approved"===(null==o?null:o.SPStatus)||"Rejected"===(null==o?null:o.SPStatus)),t.Q6J("accessType",e.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Approved"===(null==o?null:o.SPStatus)||"Rejected"===(null==o?null:o.SPStatus)),t.Q6J("accessType",e.rolePermissionActions.approveAction)}}const R=function(a,p,o,n){return{page:a,pageSize:p,collection:o,search:n,type:"list"}};let D=(()=>{var a;class p{constructor(n,e,i,r,S,f,T,P){this.exportExcelService=n,this.shipmentPlanningService=e,this.router=i,this.activatedRoute=r,this.spinner=S,this.exportToPDFService=f,this.appGlobalService=T,this.utilityService=P,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.rolePermissionActions=N.a1,this.menuItemId=""}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll(),this.menuItemId=this.appGlobalService.menuItemId}navigateTo(n,e,i){this.utilityService.navigateToForm({path:n,status:e.SPStatus,action:i,id:e._id,activatedRoute:this.activatedRoute})}trackByFn(n,e){return e?._id}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=n.value,this.getAll()}}getAll(n=!1,e=""){this.spinner.show();let i={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,excel:n};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.shipmentPlanningService.getAll(i).subscribe(r=>{"EXCEL"==e?this.excelDownload(r.rows):"PDF"==e?this.pdfDownload(r.rows):(this.tableData=r.rows,this.collection=r.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(n){let e=(0,C.Fp)(n);this.exportToPDFService.generatePdf(e.tableData,e.title)}excelDownload(n){this.exportExcelService.exportExcel((0,C.Mw)(n))}onSort({column:n,direction:e}){this.headers.forEach(i=>{i.sortable!==n&&(i.direction="")}),this.column=n,this.direction="asc"==e?1:-1,this.getAll()}}return(a=p).\u0275fac=function(n){return new(n||a)(t.Y36(u.Ol),t.Y36(y.Cp),t.Y36(h.F0),t.Y36(h.gz),t.Y36(u.V),t.Y36(u.$L),t.Y36(u.P0),t.Y36(u.tI))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-shipment-creation-list"]],viewQuery:function(n,e){if(1&n&&t.Gf(d.j,5),2&n){let i;t.iGM(i=t.CRH())&&(e.headers=i)}},decls:32,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],[1,"plusIconSvg","btn","btn-primary","me-1"],["type","button",1,"btn","btn-primary","btn-add","px-4",3,"click"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-info"],[1,"text-white"],["sortable","DRNId",3,"sort"],["sortable","DRNDateS",3,"sort"],["sortable","SPNumber",3,"sort"],["sortable","customerName",1,"text-start",3,"sort"],["sortable","SPDetails",3,"sort"],["sortable","shipmentValue",3,"sort"],["sortable","SPStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["SKUName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa","fa-times","fa-lg","me-3","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","text-success"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Shipment Summary"),t.qZA()(),t.TgZ(4,"div",3),t._UZ(5,"button",4),t.TgZ(6,"button",5),t.NdJ("click",function(){return e.navigateTo("../form",{},"create")}),t._uU(7," Create New Shipment "),t.qZA()(),t._UZ(8,"hr",6),t.TgZ(9,"div",7)(10,"app-setting-header",8),t.NdJ("dataChange",function(r){return e.eventHeader(r)}),t.qZA(),t.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(15,"DRN No."),t.qZA(),t.TgZ(16,"th",13),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(17,"DRN Date"),t.qZA(),t.TgZ(18,"th",14),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(19,"Customer Category"),t.qZA(),t.TgZ(20,"th",15),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(21,"Customer Name"),t.qZA(),t.TgZ(22,"th",16),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(23,"Currency"),t.qZA(),t.TgZ(24,"th",17),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(25,"Shipment Value"),t.qZA(),t.TgZ(26,"th",18),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(27,"Status"),t.qZA(),t.TgZ(28,"th"),t._uU(29,"Action"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,Z,33,21,"tr",19),t.qZA()()()()),2&n&&(t.xp6(4),t.Q6J("accessType",e.rolePermissionActions.createAction),t.xp6(6),t.Q6J("data",t.l5B(4,R,e.page,e.pageSize,e.collection,e.search)),t.xp6(21),t.Q6J("ngForOf",e.tableData)("ngForTrackBy",e.trackByFn))},dependencies:[l.sg,A.P,_._L,d.j,b.J],encapsulation:2}),p})();var s=c(60095),U=c(21631),F=c(22096),m=c(77203),k=c(51785),O=c(56438),w=c(16897),V=c(50363),L=c(95346),M=c(14906),q=c(83344),J=c(84231);function Q(a,p){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const o=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==o?null:o.purchaseRate,".2-2")," ")}}const x=function(){return{standalone:!0}};function G(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"input",44),t.NdJ("ngModelChange",function(e){t.CHM(o);const i=t.oxw().$implicit;return t.KtG(i.purchaseRate=e)})("input",function(){t.CHM(o);const e=t.oxw().$implicit,i=t.oxw();return t.KtG(i.setLineValue(e))}),t.qZA()}if(2&a){const o=t.oxw().$implicit;t.Q6J("ngModel",o.purchaseRate)("ngModelOptions",t.DdM(2,x))}}function K(a,p){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const o=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==o?null:o.discount,".2-2")," ")}}function E(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"input",44),t.NdJ("ngModelChange",function(e){t.CHM(o);const i=t.oxw().$implicit;return t.KtG(i.discount=e)})("input",function(){t.CHM(o);const e=t.oxw().$implicit,i=t.oxw();return t.KtG(i.setNetRate(e))}),t.qZA()}if(2&a){const o=t.oxw().$implicit;t.Q6J("ngModel",o.discount)("ngModelOptions",t.DdM(2,x))}}const v=function(){return["approval","rejection","view","generate","cancel"]};function j(a,p){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td",38,39)(7,"span",40),t._uU(8),t.qZA()(),t.TgZ(9,"td",38,41)(11,"span",40),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"SalesUOMUnitMaster"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.ALo(18,"number"),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td")(22,"div",42),t.YNc(23,Q,3,4,"span",37),t.YNc(24,G,1,3,"input",43),t.qZA()(),t.TgZ(25,"td")(26,"div",42),t.YNc(27,K,3,4,"span",37),t.YNc(28,E,1,3,"input",43),t.qZA()(),t.TgZ(29,"td"),t._uU(30),t.ALo(31,"number"),t.qZA(),t.TgZ(32,"td"),t._uU(33),t.ALo(34,"number"),t.qZA()()),2&a){const o=p.$implicit,n=p.index,e=t.MAs(6),i=t.MAs(10),r=t.oxw();t.xp6(2),t.Oqu(n+1),t.xp6(2),t.Oqu(null==o?null:o.SKUNo),t.xp6(1),t.Udp("width",e.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",o.SKUName)("positionTarget",e),t.xp6(1),t.hij(" ",null==o?null:o.SKUName," "),t.xp6(1),t.Udp("width",i.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",o.SKUDescription)("positionTarget",i),t.xp6(1),t.hij(" ",null==o?null:o.SKUDescription," "),t.xp6(2),t.Oqu(t.lcZ(15,21,null==o?null:o.UOM)),t.xp6(3),t.Oqu(t.xi3(18,23,null==o?null:o.dispatchQty,".2-2")),t.xp6(3),t.hij(" ",null==o?null:o.batchDate," "),t.xp6(3),t.Q6J("ngIf",t.DdM(32,v).includes(r.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(33,v).includes(r.action)),t.xp6(3),t.Q6J("ngIf",t.DdM(34,v).includes(r.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(35,v).includes(r.action)),t.xp6(2),t.hij(" ",t.xi3(31,26,null==o?null:o.netRate,"1.2-2")," "),t.xp6(3),t.hij(" ",t.xi3(34,29,null==o?null:o.lineValue,"1.2-2")," ")}}function Y(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"div",47)(1,"div",53)(2,"div",54),t._UZ(3,"button",55),t.TgZ(4,"button",56),t.NdJ("click",function(){t.CHM(o);const e=t.oxw(2);return t.KtG(e.openShipmentDetailsModal())}),t._uU(5," Shipment Details "),t.qZA()()()()}}function B(a,p){1&a&&(t.TgZ(0,"div",47)(1,"div",42)(2,"div",57),t._uU(3," Total Shipment Value: "),t.TgZ(4,"button",58),t._uU(5),t.ALo(6,"companyCurrency"),t.qZA()(),t._UZ(7,"input",59),t.qZA()()),2&a&&(t.xp6(5),t.hij(" ",t.lcZ(6,1,"INR")," "))}function H(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"button",60),t.NdJ("click",function(){t.CHM(o);const e=t.oxw(2);return t.KtG(e.reset())}),t._uU(1," Reset "),t.qZA()}}function z(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"button",61),t.NdJ("click",function(){t.CHM(o);const e=t.oxw(2);return t.KtG(e.submit())}),t._uU(1," Save "),t.qZA()}}function $(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"div",47)(1,"button",61),t.NdJ("click",function(){t.CHM(o);const e=t.oxw(2);return t.KtG(e.submit())}),t._uU(2,"Approve"),t.qZA()()}}function X(a,p){if(1&a){const o=t.EpF();t.TgZ(0,"div",62)(1,"div",63)(2,"span",64),t._uU(3," Remark"),t.qZA(),t._UZ(4,"input",65),t.qZA(),t.TgZ(5,"div",66)(6,"div",42)(7,"div",57),t._uU(8," Total Shipment Value: "),t.TgZ(9,"button",58),t._uU(10),t.ALo(11,"companyCurrency"),t.qZA()(),t._UZ(12,"input",59),t.qZA()(),t.TgZ(13,"div",67)(14,"button",61),t.NdJ("click",function(){t.CHM(o);const e=t.oxw(2);return t.KtG(e.submit())}),t._uU(15,"Reject"),t.qZA()()()}2&a&&(t.xp6(10),t.hij(" ",t.lcZ(11,1,"INR")," "))}const W=function(){return["create","edit","approval","view"]},tt=function(){return["create","edit","approval"]},et=function(){return["view","edit","rejection","approval"]},nt=function(){return["create","edit"]};function it(a,p){if(1&a&&(t.ynx(0),t._UZ(1,"hr",21),t.TgZ(2,"div",45),t.YNc(3,Y,6,0,"div",46),t.YNc(4,B,8,3,"div",46),t.TgZ(5,"div",47)(6,"div",48),t.YNc(7,H,2,0,"button",49),t.YNc(8,z,2,0,"button",50),t.qZA()(),t.YNc(9,$,3,0,"div",46),t.qZA(),t.TgZ(10,"div",51),t.YNc(11,X,16,3,"div",52),t.qZA(),t.BQk()),2&a){const o=t.oxw();t.xp6(3),t.Q6J("ngIf",t.DdM(6,W).includes(o.action)),t.xp6(1),t.Q6J("ngIf",t.DdM(7,tt).includes(o.action)),t.xp6(3),t.Q6J("ngIf",!t.DdM(8,et).includes(o.action)),t.xp6(1),t.Q6J("ngIf",t.DdM(9,nt).includes(o.action)),t.xp6(1),t.Q6J("ngIf","approval"==o.action),t.xp6(2),t.Q6J("ngIf","rejection"==o.action)}}const ot=function(a,p,o,n){return{page:a,pageSize:p,collection:o,search:n,excelDisplay:"none"}};let rt=(()=>{var a;class p{constructor(n,e,i,r,S,f,T,P){this.shipmentPlanningService=n,this.activatedRoute=e,this.spinner=i,this.location=r,this.toastService=S,this.validationService=f,this.modalService=T,this.utilityService=P,this.SPDetailsArray=[],this.customerName="",this.findFormErrors=[],this.DRNOptions=[],this.DRNList=[],this.salesCategory=[],this.dispatchDetails={},this.selectedCustomer={},this.page=1,this.pageSize=6,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.submitted=!1,this.isPreview=!1,this.action="create",this.statusArr={create:"Awaiting Approval",edit:"Awaiting Approval",approval:"Approved",cancel:"Cancelled",rejection:"Rejected"},this.otherCharges={action:"create",totalProductValue:0,packagingAndForwarding:0,freight:0,insurance:0,loadingAndUnloading:0,miscellaneous:0,totalAmount:0,totalShipmentValue:0},this.masterData={autoIncrementNo:"",billFromLocationOptions:[],freightTermsOptions:[],modeOfTransportOptions:[],paymentTermsOptions:[],transporterOptions:[],companyData:{_id:"",placesOfBusiness:[]}},this.form=new s.nJ({_id:new s.p4(null),SPNumber:new s.p4(null),SPTotalAmount:new s.p4(null),DRNId:new s.p4(null,[s.kI.required]),DRNDate:new s.p4(null),customer:new s.p4(""),billFromLocation:new s.p4(null,[s.kI.required]),SPDetails:new s.p4([]),remarks:new s.p4(null),shipmentValue:new s.p4(null),SPV:new s.p4(null),billFromAddress:new s.p4({}),billToAddress:new s.p4({}),SPStatus:new s.p4("Awaiting Approval",[s.kI.required]),customerCategory:new s.p4(""),currency:new s.p4(null),customerShippingAddress:new s.p4({}),paymentTerms:new s.p4(null,[s.kI.required]),modeOfTransport:new s.p4(null,[s.kI.required]),frightTerms:new s.p4(null,[s.kI.required]),transporter:new s.p4(null,[s.kI.required]),destination:new s.p4(null,[s.kI.required]),packingList:new s.p4(null),exportsInfo:new s.nJ({exportsInvoiceNo:new s.p4(null),exportsInvoiceDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD")),exportsInvoiceTotalValue:new s.p4(null),exchangeRate:new s.p4(null),finalDestination:new s.p4(null)})})}get f(){return this.form.controls}trackByFn(n,e){return e?._id}submit(){if(this.submitted=!0,this.isPreview=!1,this.form.enable(),this.validationService.checkErrors(this.form,k.JT))return;if("rejection"==this.action&&!this.form.controls.remarks.value)return void this.toastService.warning("Reject Remark is Required");if(0==this.SPDetailsArray.length)return void this.toastService.warning("Atleast one row is Required");let n={...this.form.value,...this.dispatchDetails};n.otherCharges=this.otherCharges,n.SPDetails=this.SPDetailsArray.filter(e=>e.dispatchQty>0)?.map(e=>(e.discount=e?.discount??0,e)),n._id?this.update(n):(delete n._id,this.create(n))}ngOnInit(){this.getInitialData()}update(n){this.spinner.show(),this.shipmentPlanningService.update(n._id,n).subscribe(e=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(e.message),this.location.back()})}create(n){this.spinner.show(),this.shipmentPlanningService.create(n).subscribe(e=>{this.submitted=!1,this.spinner.hide(),this.toastService.success(e.message),this.location.back()})}preview(){this.search="",this.SPDetailsArray=this.SPDetailsArray.filter(n=>n.dispatchQty>0),this.SPDetailsArray.length&&(this.isPreview=!0),this.collection=this.SPDetailsArray.length}reset(){this.form.reset(),this.customerName="",this.SPDetailsArray=[],this.collection=this.SPDetailsArray.length,this.getInitialData()}getInitialData(){this.spinner.show(),this.shipmentPlanningService.getAllMasterData({}).subscribe(n=>{this.masterData=n,this.form.controls.SPNumber.patchValue(this.masterData?.autoIncrementNo),this.form.controls.SPStatus.patchValue("Awaiting Approval"),this.form.controls.SPStatus.setValue(this.statusArr[this.action]),this.DRNList=n.DRNList,this.DRNOptions=n.DRNList,this.salesCategory=n.salesCategory,this.activatedRoute.queryParams.pipe((0,U.z)(e=>(this.action=e.action,this.utilityService.accessDenied(this.action),e.id?this.shipmentPlanningService.getById(e.id):(0,F.of)({})))).subscribe(e=>{this.spinner.hide(),0!=Object.keys(e).length&&(e.DRNDate&&(e.DRNDate=e.DRNDate.split("T")[0]),e.DRNId._id&&(this.DRNOptions=[{DRNNumber:e.DRNId.DRNNumber,_id:e.DRNId?._id}],e.DRNId=e.DRNId?._id),this.customerName=e?.customer?.customerName,this.selectedCustomer=e?.customer,this.SPDetailsArray=e?.SPDetails.map((i,r)=>({SPLineNumber:i?.SONumber,SONumber:i?.SONumber,SODate:i.SODate,SKUNo:i.SKUNo,SKUName:i.SKUName,SKUDescription:i.SKUDescription,UOM:i.UOM,dispatchQty:i.dispatchQty,currency:i.currency,purchaseRate:i.standardRate,discount:i.discount,netRate:i.netRate,lineValue:i.lineValue,SPVLine:i.SPVLine,DRNLineNumber:i.DRNLineNumber,standardRate:i.standardRate,SKU:i.SKU,SOId:i.SOId,FGINQty:i.FGINQty,FGINMfgDate:i?.FGINMfgDate,batchDate:i?.batchDate,FGINId:i.FGINId})),this.otherCharges=e.otherCharges,this.collection=this.SPDetailsArray.length,e.SPStatus=this.statusArr[this.action],this.form.patchValue(e),this.dispatchDetails={customerShippingAddress:e.customerShippingAddress,modeOfTransport:e.modeOfTransport,frightTerms:e.frightTerms,transporter:e.transporter,destination:e.destination},("edit"==this.action||"view"==this.action||"approval"==this.action)&&this.form.disable(),"rejection"==this.action&&(this.form.disable(),this.form.controls.remarks.enable()))})})}openDispatchDetailsModal(){const n=this.modalService.open(m.XB,{centered:!0,backdrop:"static",keyboard:!1,windowClass:"modelPage"});n.componentInstance.dispatchDetails=this.dispatchDetails,n.componentInstance.otherCharges=this.otherCharges,n.componentInstance.action=this.action,n.componentInstance.data={transporterArr:this.masterData?.transporterOptions,freightTerms:this.masterData?.freightTermsOptions,modeOfTransport:this.masterData?.modeOfTransportOptions,addressArr:this.selectedCustomer?.customerShippingAddress},n.result.then(e=>{["create","edit"].includes(this.action)&&(this.dispatchDetails=e,this.otherCharges=e.otherCharges)},e=>{})}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value;break;case"EXCEL":default:break;case"PAGE":this.page=n.value}}onSort({column:n,direction:e}){this.headers.forEach(i=>{i.sortable!==n&&(i.direction="")}),this.SPDetailsArray=""===e||""===n?this.SPDetailsArray:[...this.SPDetailsArray].sort((i,r)=>{let S="string"==typeof i[n]?i[n].toLowerCase():i[n],f="string"==typeof r[n]?r[n].toLowerCase():r[n];const T=S<f?-1:S>f?1:0;return"asc"===e?T:-T})}DRNNumberValueChange(n){this.customerName=n.customer.customerName,this.selectedCustomer=n.customer,this.selectedCustomer&&this.selectedCustomer.customerShippingAddress.length>0&&(this.f.billToAddress.patchValue(this.selectedCustomer?.customerShippingAddress[0]),this.f.customerShippingAddress.patchValue(this.selectedCustomer?.customerShippingAddress[0])),this.f.DRNDate.patchValue(this.utilityService.getFormatDate(n?.DRNDate,"YYYY-MM-DD")),this.f.customerCategory.setValue(n?.salesCategory),this.f.paymentTerms.setValue(n?.paymentTerms),this.f.exportsInfo.patchValue(n?.exportsInfo),this.f.modeOfTransport.setValue(n?.modeOfTransport),this.f.frightTerms.setValue(n?.frightTerms),this.f.transporter.setValue(n?.transporter),this.f.destination.setValue(n?.destination),this.f.currency.setValue(n?.customer?.customerCurrency),this.f.customer.patchValue(n?.customer?._id),this.f.DRNDate.disable(),this.f.customer.disable();let e=this.DRNList.find(i=>i._id==this.f.DRNId.value);this.SPDetailsArray=e.DRNDetails.map((i,r)=>({SPLineNumber:r+1,SOId:i?.SOId,SONumber:i?.SONumber,SODate:i?.SODate,SKU:i?.SKU,SKUNo:i?.SKUNo,SKUName:i?.SKUName,SKUDescription:i?.SKUDescription,UOM:i?.UOM,dispatchQty:i?.dispatchQty,currency:i?.currency,standardRate:i?.standardRate,purchaseRate:i?.standardRate,discount:i?.discount??0,netRate:i?.netRate??i?.standardRate,lineValue:+i?.netRate*+i?.dispatchQty,SPVLine:0,DRNLineNumber:i?.DRNLineNumber,FGINQty:i?.FGINQty,FGINMfgDate:i?.FGINMfgDate,batchDate:i?.tBatchNo,FGINId:i.FGINId})),this.collection=this.SPDetailsArray.length,this.f.SPTotalAmount.setValue(this.SPDetailsArray.map(i=>+i.lineValue).reduce((i,r)=>+i+ +r,0).toFixed(2)),this.f.shipmentValue.setValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)),this.f.SPV.setValue(this.SPDetailsArray.map(i=>+i.SPVLine).reduce((i,r)=>+i+ +r,0).toFixed(2))}setLineValue(n){let e=this.SPDetailsArray.findIndex(i=>i.DRNLineNumber==n.DRNLineNumber&&i.SKUNo==n.SKUNo&&i.SONumber==n.SONumber);this.SPDetailsArray[e].netRate=+n.purchaseRate-+n.discount/100*+n.purchaseRate,this.SPDetailsArray[e].lineValue=+n.dispatchQty*+n.netRate,this.SPDetailsArray[e].SPVLine=+n.dispatchQty*+n.standardRate-+n.dispatchQty*+n.netRate,this.f.SPTotalAmount.setValue(this.SPDetailsArray.map(i=>+i.lineValue).reduce((i,r)=>+i+ +r,0).toFixed(2)),this.f.shipmentValue.patchValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)),this.f.SPV.setValue(this.SPDetailsArray.map(i=>+i.SPVLine).reduce((i,r)=>+i+ +r,0).toFixed(2))}setNetRate(n){let e=this.SPDetailsArray.findIndex(i=>i.DRNLineNumber==n.DRNLineNumber&&i.SKUNo==n.SKUNo&&i.SONumber==n.SONumber);this.SPDetailsArray[e].netRate=+n.purchaseRate-+n.discount/100*+n.purchaseRate,this.SPDetailsArray[e].lineValue=+n.dispatchQty*+n.netRate,this.SPDetailsArray[e].SPVLine=+n.dispatchQty*+n.standardRate-+n.dispatchQty*+n.netRate,this.f.SPTotalAmount.setValue(this.SPDetailsArray.map(i=>+i.lineValue).reduce((i,r)=>+i+ +r,0).toFixed(2)),this.f.shipmentValue.setValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)),this.f.SPV.setValue(this.SPDetailsArray.map(i=>+i.SPVLine).reduce((i,r)=>+i+ +r,0).toFixed(2))}openOtherChargesModal(){const n=this.modalService.open(m.Oy,{centered:!0,size:"md",backdrop:"static",keyboard:!1});this.otherCharges.action=this.action,n.componentInstance.otherCharges=this.otherCharges,n.result.then(e=>{["create","edit"].includes(this.action)&&(this.otherCharges=e,this.f.shipmentValue.patchValue((+this.f.SPTotalAmount.value+ +this.otherCharges.totalAmount).toFixed(2)))},e=>{})}openViewDRNTermsModal(){const n=this.modalService.open(O.af,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.SOTermsArr={transporterArr:this.masterData?.transporterOptions,freightTerms:this.masterData?.freightTermsOptions,modeOfTransport:this.masterData?.modeOfTransportOptions,paymentTermsArr:this.masterData?.paymentTermsOptions},n.componentInstance.SOTermsData={paymentTerms:this.form.controls.paymentTerms.value,modeOfTransport:this.form.controls.modeOfTransport.value,frightTerms:this.form.controls.frightTerms.value,transporter:this.form.controls.transporter.value,destination:this.form.controls.destination.value},n.componentInstance.billFromAddress=this.form.controls.billFromAddress.value,n.componentInstance.billToAddress=this.form.controls.billToAddress.value,n.componentInstance.billFromLocation=this.form.controls.billFromLocation.value,n.componentInstance.billFromCompanyData=this.masterData?.companyData,n.componentInstance.billFromLocationArr=this.masterData?.billFromLocationOptions,n.componentInstance.customerShippingAddress=this.form.controls.customerShippingAddress.value,n.componentInstance.selectedCustomerData=this.selectedCustomer?.customerShippingAddress,n.componentInstance.otherCharges=this.otherCharges,n.result.then(e=>{e&&["create","edit"].includes(this.action)&&(this.form.patchValue(e?.SOTermsData),this.form.controls.billFromAddress.patchValue(e?.billFromAddress),this.form.controls.billToAddress.patchValue(e?.billToAddress),this.form.controls.customerShippingAddress.patchValue(e?.customerShippingAddress),this.form.controls.billFromLocation.setValue(e?.billFromLocation))},e=>{})}openShipmentDetailsModal(){const n=this.modalService.open(O.z8,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.shipmentLineValue=this.form.controls.shipmentValue.value,n.componentInstance.SPTotalAmount=this.f.SPTotalAmount.value,n.componentInstance.packingList=this.form.controls.packingList.value,n.componentInstance.otherCharges=this.otherCharges,n.result.then(e=>{e&&["create","edit"].includes(this.action)&&(this.form.controls.packingList.setValue(e?.packingList),this.otherCharges=e?.otherCharges,this.form.controls.shipmentValue.setValue(e?.otherCharges?.totalShipmentValue))},e=>{})}}return(a=p).\u0275fac=function(n){return new(n||a)(t.Y36(y.Cp),t.Y36(h.gz),t.Y36(u.V),t.Y36(l.Ye),t.Y36(u.kl),t.Y36(w.RJ),t.Y36(_.FF),t.Y36(u.tI))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-shipment-creation-form"]],viewQuery:function(n,e){if(1&n&&t.Gf(d.j,5),2&n){let i;t.iGM(i=t.CRH())&&(e.headers=i)}},decls:80,vars:31,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading","ms-2"],[1,"form-body"],[1,"row"],[1,"col-4","pe-0"],[1,"col-7","pe-2"],[1,"form-label"],[1,"text-danger"],["bindLabel","DRNNumber","bindValue","_id","formControlName","DRNId",3,"items","clearable","change"],[1,"col-5","ps-4"],["type","date","formControlName","DRNDate","readonly","",1,"form-control"],[1,"col-md-2","pe-0"],["type","text","readonly","","formControlName","customerCategory",1,"form-control"],[1,"col-3"],["type","text","readonly","",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange"],[1,"col-5","ps-2","pe-0"],["type","text","readonly","","formControlName","currency",1,"form-control"],[1,"col-7","ps-0","d-flex","justify-content-end","align-items-end"],["type","button",1,"btn","btn-primary",3,"click"],[1,"row","line-border"],[1,""],[3,"data","dataChange"],[1,"table-responsive","text-wrap",2,"min-height","22rem"],[1,"table","table-bordered","table-sticky"],[1,"bg-info"],[1,"text-white"],["sortable","SKUNo",3,"sort"],["sortable","SKUName",1,"text-start",3,"sort"],["sortable","SKUDescription",1,"text-start",3,"sort"],["sortable","UOM",3,"sort"],["sortable","SOBalancedQty",3,"sort"],["sortable","FGINMfgDate",3,"sort"],["sortable","FGINQty",3,"sort"],["sortable","dispatchQty",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[4,"ngIf"],[1,"text-start"],["SKUName",""],[1,"pointer",3,"ngbTooltip","positionTarget"],["SKUDescription",""],[1,"d-flex","justify-content-center"],["type","number","class","form-control form-control-xs w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["type","number",1,"form-control","form-control-xs","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],[1,"row","d-flex","justify-content-between","align-items-center","mb-0"],["class","col-md-auto",4,"ngIf"],[1,"col-md-auto"],[1,"d-grid","gap-2","d-md-block"],["class","btn btn-primary px-5 me-4",3,"click",4,"ngIf"],["class","btn btn-primary px-5","type","button",3,"click",4,"ngIf"],[1,"row","d-flex"],["class","d-flex justify-content-start",4,"ngIf"],[1,"d-flex"],[1,"col-form-label","text-nowrap","me-2"],[1,"plusIconSvg","btn","btn-primary","me-1"],["type","button",1,"btn","btn-primary","px-4",3,"click"],[1,"col-form-label","text-nowrap","pe-1","pt-0"],["type","button",1,"btn","btn-info","py-1","ms-2"],["type","number","formControlName","shipmentValue","readonly","",1,"form-control"],[1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"d-flex","justify-content-start"],[1,"d-flex","inputGroup","ms-0","col-4"],[1,"input-group-text","text-white","bg-primary"],["type","text","formControlName","remarks",1,"form-control"],[1,"col-5","ms-5"],[1,"col-3","text-end","pe-5"]],template:function(n,e){1&n&&(t.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label"),t._uU(5),t.ALo(6,"titlecase"),t.qZA()()(),t.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",5)(11,"div",7)(12,"label",8),t._uU(13," DRN No. "),t.TgZ(14,"span",9),t._uU(15,"*"),t.qZA()(),t.TgZ(16,"ng-select",10),t.NdJ("change",function(r){return e.DRNNumberValueChange(r)}),t.qZA()(),t.TgZ(17,"div",11)(18,"label",8),t._uU(19," DRN Date "),t._UZ(20,"span",9),t.qZA(),t._UZ(21,"input",12),t.qZA()()(),t.TgZ(22,"div",13)(23,"label",8),t._uU(24," Customer Category"),t.TgZ(25,"span",9),t._uU(26,"*"),t.qZA()(),t._UZ(27,"input",14),t.qZA(),t.TgZ(28,"div",15)(29,"label",8),t._uU(30," Customer Name "),t.TgZ(31,"span",9),t._uU(32,"*"),t.qZA()(),t.TgZ(33,"input",16),t.NdJ("ngModelChange",function(r){return e.customerName=r}),t.qZA()(),t.TgZ(34,"div",15)(35,"div",5)(36,"div",17)(37,"label",8),t._uU(38," Currency"),t._UZ(39,"span",9),t.qZA(),t._UZ(40,"input",18),t.qZA(),t.TgZ(41,"div",19)(42,"button",20),t.NdJ("click",function(){return e.openViewDRNTermsModal()}),t._uU(43," Shipment Terms "),t.qZA()()()()()(),t._UZ(44,"hr",21),t.TgZ(45,"div",22)(46,"app-setting-header",23),t.NdJ("dataChange",function(r){return e.eventHeader(r)}),t.qZA()(),t.TgZ(47,"div",24)(48,"table",25)(49,"thead",26)(50,"tr",27)(51,"th"),t._uU(52,"#"),t.qZA(),t.TgZ(53,"th",28),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(54,"SKU No."),t.qZA(),t.TgZ(55,"th",29),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(56),t.ALo(57,"labelTranslate"),t.qZA(),t.TgZ(58,"th",30),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(59),t.ALo(60,"labelTranslate"),t.qZA(),t.TgZ(61,"th",31),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(62,"UoM"),t.qZA(),t.TgZ(63,"th",32),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(64,"Disp. Qty"),t.qZA(),t.TgZ(65,"th",33),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(66,"Batch Date"),t.qZA(),t.TgZ(67,"th",34),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(68,"Rate/Unit"),t.qZA(),t.TgZ(69,"th",35),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(70,"Disc %"),t.qZA(),t.TgZ(71,"th",35),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(72,"Net Rate"),t.qZA(),t.TgZ(73,"th",35),t.NdJ("sort",function(r){return e.onSort(r)}),t._uU(74,"Line Value"),t.qZA()()(),t.TgZ(75,"tbody"),t.YNc(76,j,35,36,"tr",36),t.ALo(77,"slice"),t.ALo(78,"searchFi1ter"),t.qZA()()(),t.YNc(79,it,12,10,"ng-container",37),t.qZA()()),2&n&&(t.Q6J("formGroup",e.form),t.xp6(5),t.hij(" Shipment [",t.lcZ(6,12,e.action),"]"),t.xp6(11),t.Q6J("items",e.DRNOptions)("clearable",!1),t.xp6(17),t.Q6J("ngModel",e.customerName)("ngModelOptions",t.DdM(25,x)),t.xp6(13),t.Q6J("data",t.l5B(26,ot,e.page,e.pageSize,e.collection,e.search)),t.xp6(10),t.hij(" ",t.lcZ(57,14,"SKU Name")," "),t.xp6(3),t.hij(" ",t.lcZ(60,16,"SKU Description")," "),t.xp6(17),t.Q6J("ngForOf",t.Dn7(77,18,t.xi3(78,22,e.SPDetailsArray,e.search),(e.page-1)*e.pageSize,(e.page-1)*e.pageSize+e.pageSize))("ngForTrackBy",e.trackByFn),t.xp6(3),t.Q6J("ngIf","approval"==e.action||"rejection"==e.action||"generate"==e.action||"create"==e.action||"edit"==e.action||"view"==e.action))},dependencies:[l.sg,l.O5,A.P,_._L,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,s.On,V.w9,d.j,l.OU,l.JJ,l.rS,L.G,M.c,q.f,J.Q],encapsulation:2}),p})();var at=c(56208);const lt=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:D},{path:"form",component:rt,resolve:{accessScreen:c(65876).x}}];let ct=(()=>{var a;class p{}return(a=p).\u0275fac=function(n){return new(n||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[l.ez,h.Bz.forChild(lt),at.m]}),p})()},77055:(I,g,c)=>{c.d(g,{xL:()=>Z,Rn:()=>b,Fp:()=>u,Mw:()=>t});var l=c(13107),h=c(28402);let d=["*","*","*","*","*","*","*","*","*","*","*","*"],N="ShipmentPlanning Report",C=[{header:"Shipment ID",key:"SPNumber",...l.t},{header:"DRN No.",key:"DRNNumber",...l.t},{header:"DRN Date",key:"DRNDateS",...l.t},{header:"Customer Name",key:"customerName",...l.t},{header:"Bill From Location",key:"billFromLocation",...l.t},{header:"Currency",key:"currency",...l.t},{header:"Product Value",key:"SPTotalAmount",...l.t},{header:"Shipment Value",key:"shipmentValue",...l.t},{header:"SPV",key:"SPV",...l.t},{header:"Status",key:"SPStatus",...l.t}];const t=m=>({title:N,csvData:m,headers:C}),u=m=>(0,h.J)({data:m,headers:C,widths:d,title:N});let y=["*","*","*","*","*","*","*","*","*","*","*"],A="Advance Shipment Notice",_=[{header:"Invoice #",key:"salesInvoiceNumber",...l.t},{header:"Invoice Date",key:"salesInvoiceDate",...l.t},{header:"Invoice Value",key:"invoiceValue",...l.t},{header:"ASN #",key:"ASNNumber",...l.t},{header:"Customer Name",key:"customerName",...l.t},{header:"State of supply",key:"stateOfSupply",...l.t},{header:"Total Boxes",key:"totalNoOfBoxes",...l.t},{header:"Total Weight(kgs)",key:"totalGrossWeight",...l.t},{header:"Transporter",key:"transporter",...l.t},{header:"Status",key:"ASNStatus",...l.t}];const b=m=>({title:A,csvData:m,headers:_}),Z=m=>(0,h.J)({data:m,headers:_,widths:y,title:A})},51785:(I,g,c)=>{c.d(g,{B7:()=>h,JT:()=>d}),c(21821);const h=[{message:"Invoice No. is Required",key:"salesInvoice"},{message:"Invoice Date is Required",key:"salesInvoiceDate"},{message:"Invoice Value is Required",key:"invoiceValue"},{message:"Customer Name is Required",key:"customerName"},{message:"Total No. of Boxes is Required",key:"totalNoOfBoxes"},{message:"Total Gross weight(kgs) is Required",key:"totalGrossWeight"}],d=[{message:"DRN No. is Required",key:"DRNId"},{message:"Bill From Location is Required",key:"billFromLocation"},{message:"Payment Terms is Required",key:"paymentTerms"},{message:"Mode Of Transport is Required",key:"modeOfTransport"},{message:"Fright Terms is Required",key:"frightTerms"},{message:"Transporter Name is Required",key:"transporter"},{message:"Destination/Port is Required",key:"destination"}]}}]);