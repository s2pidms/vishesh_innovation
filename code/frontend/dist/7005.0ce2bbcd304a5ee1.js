"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[7005],{27005:(A,u,a)=>{a.r(u),a.d(u,{OperatingExpensesModule:()=>q});var r=a(96814),_=a(1076),f=a(25116),g=a(43818),t=a(65879),m=a(37285),x=a(98977),l=a(60095);function C(n,s){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&n){const o=s.$implicit,e=t.oxw();t.xp6(1),t.hij(" ","FY "+(+o.replace("fy_","")-1)+"-"+(+o.replace("fy_","")>+e.currentYear?+ +o.replace("fy_","")+"*":+o.replace("fy_",""))," ")}}function O(n,s){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const o=t.oxw().$implicit,e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e[o],"1.2-2")," ")}}function T(n,s){if(1&n){const o=t.EpF();t.TgZ(0,"div",24)(1,"input",25),t.NdJ("ngModelChange",function(i){t.CHM(o);const c=t.oxw().$implicit,d=t.oxw().$implicit;return t.KtG(d[c]=i)})("input",function(){t.CHM(o);const i=t.oxw(3);return t.KtG(i.calAllocationData())}),t.qZA()()}if(2&n){const o=t.oxw().$implicit,e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e[o])}}const h=function(){return[3]},y=function(){return["Total OPEX (Ccy)","Opex Cost (Ccy)/Unit"]};function v(n,s){if(1&n&&(t.TgZ(0,"td",22),t.YNc(1,O,3,4,"div",19),t.YNc(2,T,2,1,"div",23),t.qZA()),2&n){const o=t.oxw(),e=o.index,i=o.$implicit;t.Q6J("ngClass",t.DdM(3,h).includes(e)?"opex-color":null),t.xp6(1),t.Q6J("ngIf",t.DdM(4,y).includes(i.particulars)),t.xp6(1),t.Q6J("ngIf",!t.DdM(5,y).includes(i.particulars))}}function b(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td",20),t._uU(2),t.qZA(),t.YNc(3,v,3,6,"td",21),t.qZA()),2&n){const o=s.$implicit,e=s.index,i=t.oxw();t.xp6(1),t.Q6J("ngClass",t.DdM(3,h).includes(e)?"opex-color":null),t.xp6(1),t.hij(" ",o.particulars.replace("Ccy",i.companyCurrency)," "),t.xp6(1),t.Q6J("ngForOf",i.keys)}}function Z(n,s){if(1&n){const o=t.EpF();t.TgZ(0,"div")(1,"button",26),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.reset())}),t._uU(2,"Reset"),t.qZA(),t.TgZ(3,"button",27),t.NdJ("click",function(){t.CHM(o);const i=t.oxw();return t.KtG(i.dismissModel())}),t._uU(4,"Save"),t.qZA()()}}let M=(()=>{class n{constructor(o,e){this.activeModal=o,this.storageService=e,this.action="create",this.opexAllocation=[],this.costHeadList=[],this.oldOpexAllocation=[],this.keys=[],this.companyCurrency="",this.currentYear=0}ngOnInit(){this.keys=Object.keys(this.opexAllocation[0]).filter(e=>e.includes("fy_")).reverse();let o=this.costHeadList.find(e=>"TOTAL OPEX"==e.costHead);this.opexAllocation=this.opexAllocation.map(e=>("Total OPEX (Ccy)"==e.particulars&&(e.fy_25=o?.fy_25,e.fy_24=o?.fy_24,e.fy_23=o?.fy_23,e.fy_22=o?.fy_22),e)),this.calAllocationData(),this.oldOpexAllocation=JSON.parse(JSON.stringify(this.opexAllocation)),this.companyCurrency=this.storageService.get("IDMSAUser")?.currencySymbol??"INR",this.currentYear=(new Date).getFullYear().toString().slice(-2)}dismissModel(){this.activeModal.close(this.opexAllocation)}reset(){this.opexAllocation=JSON.parse(JSON.stringify(this.oldOpexAllocation))}calAllocationData(){let o=this.opexAllocation.map(e=>e.particulars).indexOf("Opex Cost (Ccy)/Unit");for(const e of this.keys){let i=this.opexAllocation.map(c=>c[e]);this.opexAllocation[o][e]=0==+i[2]?0:+Number(+i[1]/100*+i[0]/+i[2]).toFixed(2)}}static#t=this.\u0275fac=function(e){return new(e||n)(t.Y36(m.Kz),t.Y36(x.V1))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-opex-allocation-modal"]],viewQuery:function(e,i){if(1&e&&t.Gf(g.j,5),2&e){let c;t.iGM(c=t.CRH())&&(i.headers=c)}},inputs:{action:"action",opexAllocation:"opexAllocation",costHeadList:"costHeadList"},decls:26,vars:3,consts:[[1,"modelPage"],[1,"modal-header"],[1,"heading","ps-3"],["type","button","aria-label","Close",1,"btn","btn-cross","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"container-fluid","mt-5","px-0"],[1,"row","d-flex","justify-content-center"],[1,"col-11","px-3","mb-2"],[1,"table-responsive","mt-0","text-wrap"],[1,"table","table-bordered","mt-0","table-sm"],[1,"bg-info"],[1,"text-white","text-center"],[1,"text-start"],[4,"ngFor","ngForOf"],[1,"row","mb-5","px-0","mt-4","d-flex","justify-content-center"],[1,"col-11","px-3"],[1,"row"],[1,"col-6","fs-4"],[1,"col-6","text-end"],[4,"ngIf"],[1,"text-start",3,"ngClass"],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],["class","d-flex justify-content-center",4,"ngIf"],[1,"d-flex","justify-content-center"],["type","number",1,"form-control","form-control-sm",3,"ngModel","ngModelChange","input"],["type","button",1,"btn","btn-primary","px-5","me-3",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3,"Opex Allocation"),t.qZA(),t.TgZ(4,"div")(5,"button",3),t.NdJ("click",function(){return i.activeModal.close()}),t._UZ(6,"i",4),t.qZA()()(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t._uU(15,"Particulars"),t.qZA(),t.YNc(16,C,2,1,"th",13),t.qZA()(),t.TgZ(17,"tbody"),t.YNc(18,b,4,4,"tr",13),t.qZA()()()()(),t.TgZ(19,"div",14)(20,"div",15)(21,"div",16)(22,"div",17),t._uU(23,"Note : * - Budgeted OPEX"),t.qZA(),t.TgZ(24,"div",18),t.YNc(25,Z,5,0,"div",19),t.qZA()()()()()()),2&e&&(t.xp6(16),t.Q6J("ngForOf",i.keys),t.xp6(2),t.Q6J("ngForOf",i.opexAllocation),t.xp6(7),t.Q6J("ngIf","view"!==i.action))},dependencies:[r.mk,r.sg,r.O5,l.Fj,l.wV,l.JJ,l.On,r.JJ],styles:[".opex-color[_ngcontent-%COMP%]{background-color:#fff0ff}"]})}return n})();var S=a(82335),E=a(2498),F=a(53421),k=a(83344);function w(n,s){if(1&n&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&n){const o=s.$implicit,e=t.oxw();t.xp6(1),t.hij(" ","FY "+(+o.replace("fy_","")-1)+"-"+(+o.replace("fy_","")>+e.currentYear?+ +o.replace("fy_","")+"*":+o.replace("fy_",""))," ")}}function J(n,s){if(1&n&&(t.TgZ(0,"span",9),t._uU(1),t.qZA()),2&n){const o=s.$implicit;t.xp6(1),t.hij(" ",o," ")}}function P(n,s){if(1&n&&(t.O4$(),t.kcU(),t.TgZ(0,"div",30),t.YNc(1,J,2,1,"span",31),t.qZA()),2&n){const o=t.oxw(2).$implicit,e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.getTooltipOfCostHead(o.costHead))}}function H(n,s){if(1&n&&(t.TgZ(0,"span",25),t.O4$(),t.TgZ(1,"svg",26),t._UZ(2,"path",27)(3,"path",28),t.qZA(),t.YNc(4,P,2,1,"ng-template",null,29,t.W1O),t.qZA()),2&n){const o=t.MAs(5);t.xp6(1),t.Q6J("ngbTooltip",o)}}function N(n,s){if(1&n&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&n){const o=t.oxw().$implicit,e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e[o],"1.2-2")," ")}}function U(n,s){if(1&n){const o=t.EpF();t.TgZ(0,"div",34)(1,"input",35),t.NdJ("ngModelChange",function(i){t.CHM(o);const c=t.oxw().$implicit,d=t.oxw().$implicit;return t.KtG(d[c]=i)})("input",function(){t.CHM(o);const i=t.oxw(3);return t.KtG(i.setOperatingExpenses())}),t.qZA()()}if(2&n){const o=t.oxw().$implicit,e=t.oxw().$implicit;t.xp6(1),t.Q6J("ngModel",e[o])}}const p=function(){return[10]};function L(n,s){if(1&n&&(t.TgZ(0,"td",20),t.YNc(1,N,3,4,"div",32),t.YNc(2,U,2,1,"div",33),t.qZA()),2&n){const o=t.oxw(),e=o.index,i=o.$implicit;t.Q6J("ngClass",t.DdM(3,p).includes(e)?"opex-color":null),t.xp6(1),t.Q6J("ngIf","TOTAL OPEX"==i.costHead),t.xp6(1),t.Q6J("ngIf","TOTAL OPEX"!=i.costHead)}}function D(n,s){if(1&n&&(t.TgZ(0,"tr")(1,"td",20),t._uU(2),t.qZA(),t.TgZ(3,"td",21)(4,"div",22)(5,"span"),t._uU(6),t.qZA(),t.YNc(7,H,6,1,"span",23),t.qZA()(),t.TgZ(8,"td",21),t._uU(9),t.qZA(),t.TgZ(10,"td",20),t._uU(11),t.ALo(12,"companyCurrency"),t.qZA(),t.YNc(13,L,3,4,"td",24),t.qZA()),2&n){const o=s.$implicit,e=s.index,i=t.oxw();t.xp6(1),t.Q6J("ngClass",t.DdM(12,p).includes(e)?"opex-color":null),t.xp6(1),t.Oqu(o.sr),t.xp6(1),t.Q6J("ngClass",t.DdM(13,p).includes(e)?"opex-color":null),t.xp6(3),t.hij(" ",o.displayName," "),t.xp6(1),t.Q6J("ngIf",!t.DdM(14,p).includes(e)),t.xp6(1),t.Q6J("ngClass",t.DdM(15,p).includes(e)?"opex-color":null),t.xp6(1),t.hij(" ",o.category," "),t.xp6(1),t.Q6J("ngClass",t.DdM(16,p).includes(e)?"opex-color":null),t.xp6(1),t.hij(" ",t.lcZ(12,10,o.reportingCurrency)," "),t.xp6(2),t.Q6J("ngForOf",i.keys)}}let I=(()=>{class n{constructor(o,e,i,c){this.operatingExpensesService=o,this.spinner=e,this.toastService=i,this.modalService=c,this.costHeadList=[],this.opexAllocation=[],this.rolePermissionActions=f.a1,this.keys=[],this.currentYear=0,this.costHeadTooltip=S.H7}ngOnInit(){this.getInitialData(),this.currentYear=(new Date).getFullYear().toString().slice(-2)}reset(){this.getInitialData()}getTooltipOfCostHead(o){return this.costHeadTooltip[o]||[]}update(){this.spinner.show();let o={};o.costHeadList=this.costHeadList,o.opexAllocation=this.opexAllocation,this.operatingExpensesService.update(o).subscribe(e=>{this.spinner.hide(),this.toastService.success(e.message),this.getInitialData(),this.reset()})}getInitialData(){this.spinner.show(),this.operatingExpensesService.getAllMasterData({}).subscribe(o=>{this.costHeadList=o.costHeadList.map((e,i)=>("TOTAL OPEX"!=e.costHead&&(e.sr=i+1),e)),this.keys=Object.keys(this.costHeadList[0]).filter(e=>e.includes("fy_")).reverse(),this.opexAllocation=o.opexAllocation,this.spinner.hide()})}setOperatingExpenses(){let o=this.costHeadList.map(e=>e.costHead).indexOf("TOTAL OPEX");for(const e of this.keys){let i=this.costHeadList.map(c=>"TOTAL OPEX"!=c.costHead&&c[e]);this.costHeadList[o][e]=i.reduce((c,d)=>c+d,0)}}openAllocationModal(){const o=this.modalService.open(M,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});o.componentInstance.costHeadList=this.costHeadList,o.componentInstance.opexAllocation=this.opexAllocation,o.result.then(e=>{e&&(this.opexAllocation=e)},e=>{})}trackByFn(o,e){return e?._id}static#t=this.\u0275fac=function(e){return new(e||n)(t.Y36(E.Rp),t.Y36(x.V),t.Y36(x.kl),t.Y36(m.FF))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-operating-expenses-form"]],decls:32,vars:4,consts:[[1,"formCard","card"],[1,"set-remaining-margin"],[1,"form-body"],[1,"row","mt-3","justify-content-center"],[1,"col-12"],[1,"table-responsive"],[1,"table","table-bordered","table-sticky"],[1,"bg-primary"],[1,"text-white"],[1,"text-start"],[4,"ngFor","ngForOf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"row","mb-4"],[1,"col-6","d-flex"],["type","button",1,"btn","btn-primary","me-5",3,"click"],[1,"d-flex","align-items-center","fs-4"],["appAccessControl","",1,"col-6","text-end",3,"accessType"],[1,"d-grid","gap-2","d-md-block"],["type","button",1,"btn","btn-primary","px-5","me-3",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[3,"ngClass"],[1,"text-start",3,"ngClass"],[1,"d-flex","justify-content-between"],["class","pointer","data-tip","","data-for","infoTip",4,"ngIf"],[3,"ngClass",4,"ngFor","ngForOf"],["data-tip","","data-for","infoTip",1,"pointer"],["tooltipClass","my-tooltip-class custom-tooltip-class ","xmlns","http://www.w3.org/2000/svg","width","14","height","14","fill","red","viewBox","0 0 16 16",1,"bi","bi-info-circle",3,"ngbTooltip"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"],["list",""],[1,"d-flex","flex-column"],["class","text-start",4,"ngFor","ngForOf"],[4,"ngIf"],["class","d-flex justify-content-center",4,"ngIf"],[1,"d-flex","justify-content-center"],["type","number",1,"form-control","form-control-sm",3,"ngModel","ngModelChange","input"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"table",6)(7,"thead",7)(8,"tr",8)(9,"th"),t._uU(10,"SN"),t.qZA(),t.TgZ(11,"th",9),t._uU(12,"Cost Head"),t.qZA(),t.TgZ(13,"th",9),t._uU(14,"Category"),t.qZA(),t.TgZ(15,"th"),t._uU(16,"Ccy"),t.qZA(),t.YNc(17,w,2,1,"th",10),t.qZA()(),t.TgZ(18,"tbody"),t.YNc(19,D,14,17,"tr",11),t.qZA()()()()(),t.TgZ(20,"div",12)(21,"div",13)(22,"button",14),t.NdJ("click",function(){return i.openAllocationModal()}),t._uU(23," Set Allocation "),t.qZA(),t.TgZ(24,"div",15),t._uU(25,"Note : * - Budgeted OPEX"),t.qZA()(),t.TgZ(26,"div",16)(27,"div",17)(28,"button",18),t.NdJ("click",function(){return i.reset()}),t._uU(29,"Reset"),t.qZA(),t.TgZ(30,"button",19),t.NdJ("click",function(){return i.update()}),t._uU(31,"Save"),t.qZA()()()()()()()),2&e&&(t.xp6(17),t.Q6J("ngForOf",i.keys),t.xp6(2),t.Q6J("ngForOf",i.costHeadList)("ngForTrackBy",i.trackByFn),t.xp6(7),t.Q6J("accessType",i.rolePermissionActions.createAction))},dependencies:[r.mk,r.sg,r.O5,m._L,l.Fj,l.wV,l.JJ,l.On,F.J,r.JJ,k.f],styles:[".opex-color[_ngcontent-%COMP%]{background-color:#fff0ff;border-top:2px groove #007daf;border-bottom:2px groove #007daf;color:#000}"]})}return n})();var Y=a(56208);const Q=[{path:"",redirectTo:"form",pathMatch:"full"},{path:"form",component:I}];let q=(()=>{class n{static#t=this.\u0275fac=function(e){return new(e||n)};static#e=this.\u0275mod=t.oAB({type:n});static#o=this.\u0275inj=t.cJS({imports:[r.ez,_.Bz.forChild(Q),Y.m]})}return n})()},82335:(A,u,a)=>{a.d(u,{DU:()=>f,H7:()=>g,Qn:()=>t,pS:()=>_});const _={costSheetBySKU:"Cost Sheet by SKU",costSheetByProductCategory:"Cost Sheet by Product Category",getAllReportName:function(){return[{label:"Cost Sheet by SKU",value:"Cost Sheet by SKU"},{label:"Cost Sheet by Product Category",value:"Cost Sheet by Product Category"}]}},f={costSheetByDSKU:"Cost Sheet by D-SKU",costSheetByProductCategory:"Cost Sheet by Product Category",getAllReportName:function(){return[{label:"Cost Sheet by D-SKU",value:"Cost Sheet by D-SKU"},{label:"Cost Sheet by Product Category",value:"Cost Sheet by Product Category"}]}},g={Rent:["+ Factory Rent","+ Machine Rent (if any)"],"Indirect Salaries & benefits":["+ Salaries of Permanent Staff","+ Director's Remuneration","+ Staff Welfare + Benefits"],Insurance:["+ Insurance of Premises","+ Insurance of Employees","+ Insurance of Stock","+ Insurance of Machines"],"Maintenance & Repairs":["+ Preventive Maintenance cost","+ Breakdown maintenance","+ AMC","+ General repairs"],"Consumables & Spares":["+ Indirect consumables","+ Engg. spares"],Electricity:["+ Electricity other than machine power cost","+ Office electricity cost"],Utility:["+ Water","+ Gas/Fuel","+ Waste Disposal","+ Telephone/Mobile","+ Internet"],Marketing:["+ Advertising ","+ Promotion","+ Product Development","+ Corporate Gifts","+ Traveling Expenses","+ Food & Entertainment"],"Sales & Distribution":["+ Outward Freight","+ Salaries of Sales staff","+ Commission on sales","+ Premium Packaging","+ Premium Freight"],"Admin & Other":["+ Licenses & permits","+ Office supplies","+ Housekeeping","+ Training & Development","+ Business Conference","+ Miscellaneous"]},t=[{label:"Export with Payment",value:"EXPWP"},{label:"Export without payment",value:"EXPWOP"}]}}]);