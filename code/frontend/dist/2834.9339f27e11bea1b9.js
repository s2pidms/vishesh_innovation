"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[2834],{72834:(He,S,c)=>{c.r(S),c.d(S,{GeneratePurchaseOrderModule:()=>$e});var d=c(96814),g=c(1076),f=c(43818),T=c(25116),v=c(86514),e=c(65879),y=c(48720),m=c(2742),Z=c(88059),h=c(37285),A=c(53421);function M(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td",20,21)(9,"span",22),e._uU(10),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td")(18,"div",23),e._UZ(19,"button",24),e.TgZ(20,"div",25)(21,"a",26),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",n,"view"))}),e._UZ(22,"i",27),e._uU(23," View "),e.qZA(),e.TgZ(24,"a",26),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",n,"edit"))}),e._UZ(25,"i",28),e._uU(26," Edit "),e.qZA(),e.TgZ(27,"a",26),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",n,"approve"))}),e._UZ(28,"i",29),e._uU(29," Approve "),e.qZA(),e.TgZ(30,"a",26),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",n,"reject"))}),e._UZ(31,"i",30),e._uU(32," Reject "),e.qZA(),e.TgZ(33,"a",26),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.update(n,"Report Generated"))}),e._UZ(34,"img",31),e._uU(35," Generate Report "),e.qZA(),e.TgZ(36,"a",26),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateToPrint("/#/print/po_print",n,"print","previewPO"))}),e._UZ(37,"i",32),e._uU(38," Preview PO "),e.qZA()()()()()}if(2&a){const r=s.$implicit,i=e.MAs(8),t=e.oxw();e.xp6(2),e.Oqu(null==r?null:r.PONumber),e.xp6(2),e.Oqu(null==r?null:r.PODateS),e.xp6(2),e.Oqu(null==r?null:r.purchaseCategory),e.xp6(1),e.Udp("width",i.clientWidth),e.xp6(2),e.Q6J("positionTarget",i)("ngbTooltip",r.supplierName),e.xp6(1),e.hij(" ",r.supplierName," "),e.xp6(2),e.Oqu(null==r?null:r.currency),e.xp6(2),e.Oqu(null==r?null:r.netPOValue),e.xp6(2),e.Oqu(null==r?null:r.POStatus),e.xp6(5),e.Q6J("accessType",t.rolePermissionActions.viewAction),e.xp6(3),e.ekj("disable","Approved"===(null==r?null:r.POStatus)||"Rejected"===(null==r?null:r.POStatus)||"Supplementary PO"===(null==r?null:r.POStatus)),e.Q6J("accessType",t.rolePermissionActions.editAction),e.xp6(3),e.ekj("disable","Approved"===(null==r?null:r.POStatus)||"Rejected"===(null==r?null:r.POStatus)),e.Q6J("accessType",t.rolePermissionActions.approveAction),e.xp6(3),e.ekj("disable","Approved"===(null==r?null:r.POStatus)||"Rejected"===(null==r?null:r.POStatus)||"Supplementary PO"===(null==r?null:r.POStatus)),e.Q6J("accessType",t.rolePermissionActions.approveAction),e.xp6(3),e.ekj("disable","Awaiting Approval"===(null==r?null:r.POStatus)||"Rejected"===(null==r?null:r.POStatus)||"Supplementary PO"===(null==r?null:r.POStatus)),e.Q6J("accessType",t.rolePermissionActions.generateReportAction),e.xp6(3),e.Q6J("accessType",t.rolePermissionActions.createAction)}}const q=function(a,s,r,i){return{page:a,pageSize:s,collection:r,search:i,type:"list"}};let F=(()=>{var a;class s{constructor(i,t,n,o,p,u,_){this.purchaseService=i,this.router=t,this.toastService=n,this.spinner=o,this.exportExcelService=p,this.activatedRoute=u,this.exportToPDFService=_,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Report Generated","Cancelled","Rejected","GRN Partial Created","GRN Created","Closed"],this.rolePermissionActions=T.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(i,t,n){return"Awaiting Approval"==t.POStatus&&"view"==n||"Supplementary PO"==t.POStatus&&"view"==n||"Supplementary PO"==t.POStatus&&"approve"==n||"Awaiting Approval"==t.POStatus&&"edit"==n||"Awaiting Approval"==t.POStatus&&"approve"==n||"Awaiting Approval"==t.POStatus&&"reject"==n||"Approved"==t.POStatus&&"view"==n||"Approved"==t.POStatus&&"generate"==n||"Rejected"==t.POStatus&&"view"==n||"create"==n?void this.router.navigate([i],{relativeTo:this.activatedRoute,queryParams:{id:t?._id,action:n}}):null}eventHeader(i){switch(i.key){case"SEARCH":this.search=i.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=i.value,this.getAll()}}navigateToPrint(i,t,n,o){window.open(`${window.location.origin}${i}?id=${t?._id}&action=${n}&preview=${o}`,"_blank")}getAll(i=!1,t=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:i};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.purchaseService.getAll(n).subscribe(o=>{"EXCEL"==t?this.excelDownload(o.rows):"PDF"==t?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(i,t){return t?._id}update(i,t){"Approved"===i?.POStatus&&(this.spinner.show(),this.purchaseService.update(i._id,{POStatus:t}).subscribe(n=>{this.toastService.success(n.message),this.getAll(),this.spinner.hide()}))}excelDownload(i){this.exportExcelService.exportExcel((0,v.vK)(i))}pdfDownload(i){let t=(0,v.i7)(i);this.exportToPDFService.generatePdf(t.tableData,t.title)}onSort({column:i,direction:t}){this.headers.forEach(n=>{n.sortable!==i&&(n.direction="")}),this.column=i,this.direction="asc"==t?1:-1,this.getAll()}}return(a=s).\u0275fac=function(i){return new(i||a)(e.Y36(y.x$),e.Y36(g.F0),e.Y36(m.kl),e.Y36(m.V),e.Y36(m.Ol),e.Y36(g.gz),e.Y36(m.$L))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-po-list"]],viewQuery:function(i,t){if(1&i&&e.Gf(f.j,5),2&i){let n;e.iGM(n=e.CRH())&&(t.headers=n)}},decls:32,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],["type","button",1,"btn","btn-primary","btn-add",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","PONumber",3,"sort"],["sortable","PODateS",3,"sort"],["sortable","purchaseCategory",3,"sort"],["sortable","supplierName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","netPOValue",3,"sort"],["sortable","POStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplierName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","text-success"],["aria-hidden","true",1,"fa","fa-close","fa-lg","text-primary"],["src","./assets/images/new.svg","width","14",1,"me-3"],["aria-hidden","true",1,"fa","fa-print","fa-lg","me-3","text-primary"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Purchase Order[PO] Summary"),e.qZA()(),e.TgZ(4,"div",3)(5,"button",4),e.NdJ("click",function(){return t.navigateTo("../form",{},"create")}),e._UZ(6,"i",5),e._uU(7," Create Purchase Order "),e.qZA()(),e._UZ(8,"hr",6),e.TgZ(9,"div",7)(10,"app-setting-header",8),e.NdJ("dataChange",function(o){return t.eventHeader(o)}),e.qZA(),e.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(15,"PO #"),e.qZA(),e.TgZ(16,"th",13),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(17,"PO Date"),e.qZA(),e.TgZ(18,"th",14),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(19,"Purchase Category"),e.qZA(),e.TgZ(20,"th",15),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(21,"Supplier Name"),e.qZA(),e.TgZ(22,"th",16),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(23,"Currency"),e.qZA(),e.TgZ(24,"th",17),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(25,"PO Value"),e.qZA(),e.TgZ(26,"th",18),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(27,"Status"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Action"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,M,39,25,"tr",19),e.qZA()()()()),2&i&&(e.xp6(4),e.Q6J("accessType",t.rolePermissionActions.createAction),e.xp6(6),e.Q6J("data",e.l5B(4,q,t.page,t.pageSize,t.collection,t.search)),e.xp6(21),e.Q6J("ngForOf",t.tableData)("ngForTrackBy",t.trackByFn))},dependencies:[d.sg,Z.P,h._L,f.j,A.J],encapsulation:2}),s})();var l=c(60095),J=c(21631),I=c(22096),x=c(77203),k=c(31874),R=c(14906);function L(a,s){if(1&a&&(e.TgZ(0,"option",32),e._uU(1),e.qZA()),2&a){const r=s.$implicit;e.Q6J("value",r.value),e.xp6(1),e.hij(" ",r.label," ")}}function Q(a,s){if(1&a&&(e.TgZ(0,"option",32),e._uU(1),e.qZA()),2&a){const r=s.$implicit;e.Q6J("value",r.value),e.xp6(1),e.hij(" ",r.label," ")}}function Y(a,s){if(1&a&&(e.TgZ(0,"div",14)(1,"select",33)(2,"option",16),e._uU(3,"Select Payment Terms"),e.qZA(),e.YNc(4,Q,2,2,"option",17),e.qZA()()),2&a){const r=e.oxw();e.xp6(2),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",r.paymentTermsArr)}}function V(a,s){1&a&&(e.TgZ(0,"div",14),e._UZ(1,"input",34),e.qZA())}function j(a,s){if(1&a&&(e.TgZ(0,"option",32),e._uU(1),e.qZA()),2&a){const r=s.$implicit;e.Q6J("value",r.parameterName),e.xp6(1),e.hij(" ",r.parameterLabel," ")}}function G(a,s){if(1&a&&(e.TgZ(0,"option",32),e._uU(1),e.qZA()),2&a){const r=s.$implicit;e.Q6J("value",r.value),e.xp6(1),e.hij(" ",r.label," ")}}function E(a,s){1&a&&e._UZ(0,"hr",35)}function $(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"button",36),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.dismissModel())}),e._uU(1," Save & Close "),e.qZA()}}const U=function(){return["approve","reject","view","generate","cancel"]};let H=(()=>{var a;class s{get f(){return this.form.controls}constructor(i){this.activeModal=i,this.action="",this.changedPaymentTerms="",this.deliveryLocation="",this.POTerms={},this.paymentTermsArr=[],this.deliveryLocationArr=[],this.freightTermsArr=[],this.transporterArr=[],this.clickCount=1,this.showSelect=!1,this.form=new l.nJ({deliveryLocation:new l.p4(null),changedPaymentTerms:new l.p4(null),freightTerms:new l.p4({value:"FOR - Free On Road",disabled:!0}),transporter:new l.p4(null),PORemarks:new l.p4(null)})}ngOnInit(){this.paymentTermsArr.some(t=>t.label==this.POTerms.changedPaymentTerms)||(this.showSelect=!0,this.clickCount=0),"create"==this.action&&(this.showSelect=!1,this.clickCount=1),this.form.patchValue(this.POTerms),["approve","reject","view","generate","cancel"].includes(this.action)&&this.form.disable()}dismissModel(){this.activeModal.close(this.form.value)}enablePaymentTerms(){this.clickCount++,this.showSelect=this.clickCount%2==0}enableFreightTerms(){["create","edit"].includes(this.action)&&this.form.controls.freightTerms.enable()}}return(a=s).\u0275fac=function(i){return new(i||a)(e.Y36(h.Kz))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-po-change-pt"]],inputs:{action:"action",changedPaymentTerms:"changedPaymentTerms",deliveryLocation:"deliveryLocation",POTerms:"POTerms",paymentTermsArr:"paymentTermsArr",deliveryLocationArr:"deliveryLocationArr",freightTermsArr:"freightTermsArr",transporterArr:"transporterArr"},decls:68,vars:16,consts:[[3,"formGroup"],[1,"modelPage"],[1,"modal-header"],[1,"heading"],["type","button","aria-label","Close",1,"btn","btn-cross","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"container-fluid"],[1,"row","justify-content-center"],[1,"col-12","px-5","mt-5"],[1,"row"],[1,"col-3","mt-1","pe-0"],[1,"form-label","text-nowrap"],[1,"col-auto","px-0"],[1,"fa","fa-caret-right","mt-1","text-secondary"],[1,"col-7","ps-0"],["type","text","formControlName","deliveryLocation",1,"form-select","fs-5"],["selected","","disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"row","mt-4"],[1,"col-3","pe-0"],[1,"form-label"],[1,"fa","fa-caret-right","text-secondary"],["class","col-7 ps-0",4,"ngIf"],[1,"col-1","assetChange","mt-1","pointer",3,"click"],["type","text","formControlName","freightTerms",1,"form-select","fs-5"],[1,"col-1","assetChange","mt-2","pointer",3,"click"],["type","text","formControlName","transporter",1,"form-select","fs-5"],["type","text","formControlName","PORemarks",1,"form-control"],[1,"col","mt-4","px-0"],["class","line-border mb-4",4,"ngIf"],[1,"text-center"],["class","btn bg-primary px-5 mb-4","type","button",3,"click",4,"ngIf"],[3,"value"],["type","text","formControlName","changedPaymentTerms",1,"form-select","fs-5"],["type","text","formControlName","changedPaymentTerms",1,"form-control"],[1,"line-border","mb-4"],["type","button",1,"btn","bg-primary","px-5","mb-4",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"PO Terms"),e.qZA(),e.TgZ(5,"div")(6,"button",4),e.NdJ("click",function(){return t.activeModal.close()}),e._UZ(7,"i",5),e.qZA()()(),e.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"div",10)(13,"label",11),e._uU(14),e.ALo(15,"labelTranslate"),e.qZA()(),e.TgZ(16,"div",12),e._UZ(17,"i",13),e.qZA(),e.TgZ(18,"div",14)(19,"select",15)(20,"option",16),e._uU(21,"Select Location"),e.qZA(),e.YNc(22,L,2,2,"option",17),e.qZA()()(),e.TgZ(23,"div",18)(24,"div",19)(25,"label",20),e._uU(26,"Payment Terms"),e.qZA()(),e.TgZ(27,"div",12),e._UZ(28,"i",21),e.qZA(),e.YNc(29,Y,5,2,"div",22),e.YNc(30,V,2,0,"div",22),e.TgZ(31,"div",23),e.NdJ("click",function(){return t.enablePaymentTerms()}),e.qZA()(),e.TgZ(32,"div",18)(33,"div",19)(34,"label",20),e._uU(35," Freight Terms"),e.qZA()(),e.TgZ(36,"div",12),e._UZ(37,"i",21),e.qZA(),e.TgZ(38,"div",14)(39,"select",24)(40,"option",16),e._uU(41,"Select Freight Terms"),e.qZA(),e.YNc(42,j,2,2,"option",17),e.qZA()(),e.TgZ(43,"div",25),e.NdJ("click",function(){return t.enableFreightTerms()}),e.qZA()(),e.TgZ(44,"div",18)(45,"div",19)(46,"label",11),e._uU(47,"Transporter"),e.qZA()(),e.TgZ(48,"div",12),e._UZ(49,"i",21),e.qZA(),e.TgZ(50,"div",14)(51,"select",26)(52,"option",16),e._uU(53,"Select Transporter"),e.qZA(),e.YNc(54,G,2,2,"option",17),e.qZA()()(),e.TgZ(55,"div",18)(56,"div",19)(57,"label",11),e._uU(58,"PO Remarks"),e.qZA()(),e.TgZ(59,"div",12),e._UZ(60,"i",21),e.qZA(),e.TgZ(61,"div",14),e._UZ(62,"input",27),e.qZA()()()(),e.TgZ(63,"div",9)(64,"div",28),e.YNc(65,E,1,0,"hr",29),e.qZA()(),e.TgZ(66,"div",30),e.YNc(67,$,2,0,"button",31),e.qZA()()()()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(14),e.Oqu(e.lcZ(15,12,"Delivery Location")),e.xp6(6),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",t.deliveryLocationArr),e.xp6(7),e.Q6J("ngIf",!t.showSelect),e.xp6(1),e.Q6J("ngIf",t.showSelect),e.xp6(10),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",t.freightTermsArr),e.xp6(10),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",t.transporterArr),e.xp6(11),e.Q6J("ngIf",!e.DdM(14,U).includes(t.action)),e.xp6(2),e.Q6J("ngIf",!e.DdM(15,U).includes(t.action)))},dependencies:[d.sg,d.O5,l._Y,l.YN,l.Kr,l.Fj,l.EJ,l.JJ,l.JL,l.sg,l.u,R.c],styles:[".fa-caret-right[_ngcontent-%COMP%]{font-size:2rem!important;margin-right:4rem!important}.assetChange[_ngcontent-%COMP%]{background-color:transparent;background-image:url(Asset_change.a4234ac185c40591.svg);background-size:100% 100%;border:0;color:#fff;height:2.2rem;width:2.2rem}"]}),s})();var z=c(45622),K=c(83344);const w=function(){return["create","edit","amend"]};function B(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",28)(1,"div",7)(2,"div",8)(3,"div",9)(4,"input",29),e.NdJ("input",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.updateTotalAmount())})("ngModelChange",function(t){const o=e.CHM(r).$implicit;return e.KtG(o.description=t)}),e.qZA()(),e.TgZ(5,"div",11)(6,"input",30),e.NdJ("ngModelChange",function(t){const o=e.CHM(r).$implicit;return e.KtG(o.SACCode=t)})("input",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.updateTotalAmount())}),e.qZA()()()(),e.TgZ(7,"div",12)(8,"div",8)(9,"div",13)(10,"input",30),e.NdJ("ngModelChange",function(t){const o=e.CHM(r).$implicit;return e.KtG(o.GSTRate=t)})("input",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.updateTotalAmount())}),e.qZA()(),e.TgZ(11,"div",14)(12,"input",31),e.NdJ("ngModelChange",function(t){const o=e.CHM(r).$implicit;return e.KtG(o.currency=t)})("input",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.updateTotalAmount())}),e.qZA()(),e.TgZ(13,"div",15)(14,"input",32),e.NdJ("ngModelChange",function(t){const o=e.CHM(r).$implicit;return e.KtG(o.serviceCharges=t)})("input",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.updateTotalAmount())}),e.qZA()()()()()}if(2&a){const r=s.$implicit,i=e.oxw();e.xp6(4),e.Q6J("ngModel",r.description),e.xp6(2),e.Q6J("ngModel",r.SACCode),e.xp6(4),e.Q6J("ngModel",r.GSTRate),e.xp6(2),e.Q6J("ngModel",r.currency),e.xp6(2),e.Q6J("ngModel",r.serviceCharges)("readonly",!e.DdM(6,w).includes(i.action))}}function X(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",33)(1,"button",34),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.disMissModal())}),e._uU(2,"Save & Close"),e.qZA()()}}const W=function(){return["view","approve"]};let ee=(()=>{var a;class s{constructor(i){this.activeModal=i,this.serviceChargesList=[],this.totalServiceCharges="",this.action=""}ngOnInit(){}updateTotalAmount(){this.totalServiceCharges=this.serviceChargesList?.map(i=>i?.serviceCharges)?.filter(i=>i>0)?.reduce((i,t)=>+i+ +t,0)}disMissModal(){this.activeModal.close({serviceChargesList:this.serviceChargesList,totalServiceCharges:this.totalServiceCharges})}}return(a=s).\u0275fac=function(i){return new(i||a)(e.Y36(h.Kz))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-po-add-service-charges"]],inputs:{serviceChargesList:"serviceChargesList",totalServiceCharges:"totalServiceCharges",action:"action"},decls:46,vars:9,consts:[[1,"modelPage"],[1,"modal-header"],[1,"heading"],["type","button","aria-label","Close",1,"btn","btn-cross","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"container-fluid"],[1,"row","px-2","mt-5"],[1,"col-6","pe-0"],[1,"row"],[1,"col-8","pe-1"],[1,"form-label"],[1,"col-4","ps-2"],[1,"col-6"],[1,"col-4","ps-2","pe-0"],[1,"col-3","px-2"],[1,"col-5","ps-0"],["class","row px-2 mb-3",4,"ngFor","ngForOf"],[1,"col-12","px-0","mt-1"],[1,"line-border"],[1,"row","mb-4","mt-2","px-2"],[1,"d-flex","align-items-center"],[1,"col-form-label","text-nowrap"],[1,"ms-1","me-2"],[1,"d-flex"],[1,"input-group-text","text-secondary","combine-INR"],[1,"vr","ms-3"],["type","number","readonly","",1,"form-control","ps-1","border-start-0",3,"ngModel","disabled","ngModelChange"],["class","col-6 d-flex justify-content-end",4,"ngIf"],[1,"row","px-2","mb-3"],["value","Freight Forwarding","type","text","readonly","",1,"form-control","bg-white-smoke",3,"ngModel","input","ngModelChange"],["type","number","readonly","",1,"form-control","bg-white-smoke",3,"ngModel","ngModelChange","input"],["type","text","readonly","",1,"form-control","bg-white-smoke",3,"ngModel","ngModelChange","input"],["type","number",1,"form-control",3,"ngModel","readonly","ngModelChange","input"],[1,"col-6","d-flex","justify-content-end"],["type","button",1,"btn","btn-primary","px-4",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3,"Add Service Charges"),e.qZA(),e.TgZ(4,"div")(5,"button",3),e.NdJ("click",function(){return t.activeModal.close()}),e._UZ(6,"i",4),e.qZA()()(),e.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),e._uU(13," Description of Services "),e.qZA()(),e.TgZ(14,"div",11)(15,"label",10),e._uU(16,"SAC Code "),e.qZA()()()(),e.TgZ(17,"div",12)(18,"div",8)(19,"div",13)(20,"label",10),e._uU(21,"GST Rate % "),e.qZA()(),e.TgZ(22,"div",14)(23,"label",10),e._uU(24,"Currency "),e.qZA()(),e.TgZ(25,"div",15)(26,"label",10),e._uU(27,"Service Charges "),e.qZA()()()()(),e.YNc(28,B,15,7,"div",16),e.TgZ(29,"div",8)(30,"div",17),e._UZ(31,"hr",18),e.qZA()(),e.TgZ(32,"div",19)(33,"div",12)(34,"div",20)(35,"div",21),e._uU(36," Total Service Charges "),e.TgZ(37,"span",22),e._uU(38,"\u25b6"),e.qZA()(),e.TgZ(39,"div",23)(40,"span",24),e._uU(41),e.ALo(42,"companyCurrency"),e._UZ(43,"div",25),e.qZA(),e.TgZ(44,"input",26),e.NdJ("ngModelChange",function(o){return t.totalServiceCharges=o}),e.qZA()()()(),e.YNc(45,X,3,0,"div",27),e.qZA()()()),2&i&&(e.xp6(28),e.Q6J("ngForOf",t.serviceChargesList),e.xp6(13),e.hij(" ",e.lcZ(42,5,"INR")," "),e.xp6(3),e.Q6J("ngModel",t.totalServiceCharges)("disabled",e.DdM(7,W).includes(t.action)),e.xp6(1),e.Q6J("ngIf",e.DdM(8,w).includes(t.action)))},dependencies:[d.sg,d.O5,l.Fj,l.wV,l.JJ,l.On,K.f],encapsulation:2}),s})();var te=c(16897),ie=c(50363),ne=c(95346),re=c(59103);function oe(a,s){if(1&a&&(e.TgZ(0,"option",80),e._uU(1),e.qZA()),2&a){const r=s.$implicit;e.Q6J("value",r),e.xp6(1),e.hij(" ",r," ")}}function ae(a,s){1&a&&e._UZ(0,"img",85)}function se(a,s){1&a&&e._UZ(0,"img",86)}function le(a,s){if(1&a&&(e.TgZ(0,"li",88)(1,"span",89),e._uU(2),e.qZA()()),2&a){const r=e.oxw(),i=r.$implicit,t=r.pages;e.xp6(2),e.AsE(" Page ",i," of ",t[t.length-1]," ")}}function ce(a,s){1&a&&e.YNc(0,le,3,2,"li",87),2&a&&e.Q6J("ngIf",s.pages.length>0)}function pe(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"ngb-pagination",81),e.NdJ("pageChange",function(t){e.CHM(r);const n=e.oxw();return e.KtG(n.page=t)}),e.YNc(1,ae,1,0,"ng-template",82),e.YNc(2,se,1,0,"ng-template",83),e.YNc(3,ce,1,1,"ng-template",84),e.qZA()}if(2&a){const r=e.oxw();e.Q6J("collectionSize",r.filterItems.length)("page",r.page)("pageSize",r.pageSize)("boundaryLinks",!1)}}function ue(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"th",90),e.NdJ("sort",function(t){e.CHM(r);const n=e.oxw();return e.KtG(n.onSort(t))}),e._uU(1," Standard Rate "),e.qZA()}}function de(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"th",91),e.NdJ("sort",function(t){e.CHM(r);const n=e.oxw();return e.KtG(n.onSort(t))}),e._uU(1," Line PPV "),e.qZA()}}function me(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",106),e.NdJ("click",function(){e.CHM(r);const t=e.oxw().$implicit,n=e.oxw();return e.KtG(n.setConversionOfUnit(t))}),e.qZA()}}function he(a,s){1&a&&e._UZ(0,"div",107)}function _e(a,s){if(1&a&&(e.TgZ(0,"td"),e._uU(1),e.qZA()),2&a){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",r.standardRate," ")}}function ge(a,s){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"number"),e.qZA()),2&a){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,r.POQty,"1.2-2")," ")}}const P=function(){return{standalone:!0}};function fe(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"input",108),e.NdJ("ngModelChange",function(t){e.CHM(r);const n=e.oxw().$implicit;return e.KtG(n.POQty=t)})("input",function(){e.CHM(r);const t=e.oxw().$implicit,n=e.oxw();return e.KtG(n.lineValueRate(t.POLineNumber,t))}),e.qZA()}if(2&a){const r=e.oxw().$implicit;e.Q6J("ngModel",r.POQty)("ngModelOptions",e.DdM(2,P))}}function ve(a,s){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"number"),e.qZA()),2&a){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,r.purchaseRate,"1.3-3")," ")}}function Ce(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"input",109),e.NdJ("ngModelChange",function(t){e.CHM(r);const n=e.oxw().$implicit;return e.KtG(n.purchaseRate=t)})("input",function(){e.CHM(r);const t=e.oxw().$implicit,n=e.oxw();return e.KtG(n.lineValueRate(t.POLineNumber,t))}),e.qZA()}if(2&a){const r=e.oxw().$implicit;e.Q6J("ngModel",r.purchaseRate)("ngModelOptions",e.DdM(2,P))}}function Te(a,s){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"number"),e.qZA()),2&a){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,null==r?null:r.discount,".2-2")," ")}}function Pe(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"input",110),e.NdJ("ngModelChange",function(t){e.CHM(r);const n=e.oxw().$implicit;return e.KtG(n.discount=t)})("input",function(){e.CHM(r);const t=e.oxw().$implicit,n=e.oxw();return e.KtG(n.setNetRate(t))}),e.qZA()}if(2&a){const r=e.oxw().$implicit;e.Q6J("ngModel",r.discount)("ngModelOptions",e.DdM(2,P))}}function ye(a,s){if(1&a&&(e.TgZ(0,"td"),e._uU(1),e.ALo(2,"number"),e.qZA()),2&a){const r=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,null==r?null:r.linePPV,"1.2-2")," ")}}function be(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"span",111),e.NdJ("click",function(){e.CHM(r);const t=e.oxw().$implicit,n=e.oxw();return e.KtG(n.openPOScheduleModal(t))}),e._UZ(1,"div",112),e.qZA()}}function Ze(a,s){1&a&&(e.TgZ(0,"span",113),e._UZ(1,"div",112),e.qZA())}const O=function(){return["view"]},C=function(){return["approve","reject","view","generate","cancel"]},D=function(){return["approve","reject","view"]};function Ae(a,s){if(1&a&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td",92,93)(5,"span",94),e._uU(6),e.qZA()(),e.TgZ(7,"td",92,95)(9,"span",94),e._uU(10),e.qZA()(),e.TgZ(11,"td")(12,"div",96)(13,"span",97),e._uU(14),e.ALo(15,"UOMUnitsMaster"),e.qZA(),e.TgZ(16,"span",98),e.YNc(17,me,1,0,"div",99),e.YNc(18,he,1,0,"div",100),e.qZA()()(),e.YNc(19,_e,2,1,"td",77),e.TgZ(20,"td")(21,"div",54),e.YNc(22,ge,3,4,"span",77),e.YNc(23,fe,1,3,"input",101),e.qZA()(),e.TgZ(24,"td")(25,"div",54),e.YNc(26,ve,3,4,"span",77),e.YNc(27,Ce,1,3,"input",102),e.qZA()(),e.TgZ(28,"td")(29,"div",54),e.YNc(30,Te,3,4,"span",77),e.YNc(31,Pe,1,3,"input",103),e.qZA()(),e.TgZ(32,"td"),e._uU(33),e.ALo(34,"number"),e.qZA(),e.TgZ(35,"td"),e._uU(36),e.ALo(37,"number"),e.qZA(),e.YNc(38,ye,3,4,"td",77),e.TgZ(39,"td"),e.YNc(40,be,2,0,"span",104),e.YNc(41,Ze,2,0,"span",105),e.qZA()()),2&a){const r=s.$implicit,i=e.MAs(4),t=e.MAs(8),n=e.oxw();e.xp6(2),e.Oqu(null==r?null:r.itemCode),e.xp6(1),e.Udp("width",i.clientWidth),e.xp6(2),e.Q6J("positionTarget",i)("ngbTooltip",r.name),e.xp6(1),e.hij(" ",null==r?null:r.name," "),e.xp6(1),e.Udp("width",t.clientWidth),e.xp6(2),e.Q6J("positionTarget",t)("ngbTooltip",r.description),e.xp6(1),e.hij(" ",null==r?null:r.description," "),e.xp6(3),e.Q6J("ngbTooltip",r.unitConversion)("ngClass",r.UOM==r.secondaryUnit?"text-primary pointer":"text-secondary pointer"),e.xp6(1),e.Oqu(e.lcZ(15,28,null==r?null:r.UOM)),e.xp6(3),e.Q6J("ngIf",r.stdCostUom2&&r.stdCostUom1&&r.primaryUnit&&r.secondaryUnit),e.xp6(1),e.Q6J("ngIf",!(r.stdCostUom2&&r.stdCostUom1&&r.primaryUnit&&r.secondaryUnit)),e.xp6(1),e.Q6J("ngIf",e.DdM(36,O).includes(n.action)),e.xp6(3),e.Q6J("ngIf",e.DdM(37,C).includes(n.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(38,C).includes(n.action)),e.xp6(3),e.Q6J("ngIf",e.DdM(39,C).includes(n.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(40,C).includes(n.action)),e.xp6(3),e.Q6J("ngIf",e.DdM(41,C).includes(n.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(42,C).includes(n.action)),e.xp6(2),e.hij(" ",e.xi3(34,30,null==r?null:r.netRate,"1.2-2")," "),e.xp6(3),e.Oqu(e.xi3(37,33,null==r?null:r.lineValue,"1.2-2")),e.xp6(2),e.Q6J("ngIf",e.DdM(43,D).includes(n.action)),e.xp6(2),e.Q6J("ngIf",n.form.controls.POType.value==n.POTypeObj.PLANNED_PO||n.form.controls.POType.value==n.POTypeObj.STANDARD_PO),e.xp6(1),e.Q6J("ngIf",!n.form.controls.POType.value||n.form.controls.POType.value==n.POTypeObj.BLANKET_PO)}}function Oe(a,s){1&a&&(e.TgZ(0,"div",114)(1,"div",19)(2,"div",115),e._uU(3," PO Validity "),e.TgZ(4,"span",116),e._uU(5,"*"),e.qZA(),e._UZ(6,"i",117),e.qZA(),e._UZ(7,"input",118),e.qZA()())}function Se(a,s){1&a&&e._UZ(0,"div",24)}function xe(a,s){1&a&&(e.TgZ(0,"div",119)(1,"div",120)(2,"div",115),e._uU(3,"Rejection Remarks"),e.qZA(),e._UZ(4,"input",121),e.qZA()())}function Ue(a,s){1&a&&(e.TgZ(0,"div",119)(1,"div",120)(2,"div",115),e._uU(3," Reason for Cancellation "),e.TgZ(4,"span",10),e._uU(5,"*"),e.qZA()(),e._UZ(6,"input",122),e.qZA()())}function we(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",123)(1,"button",124),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.reset())}),e._uU(2,"Reset"),e.qZA(),e.TgZ(3,"button",125),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.ESCPreview())}),e._uU(4," Esc "),e.qZA(),e.TgZ(5,"button",126),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.preview())}),e._uU(6,"Preview"),e.qZA(),e.TgZ(7,"button",127),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.submit())}),e._uU(8," Save "),e.qZA()()}if(2&a){const r=e.oxw();e.xp6(3),e.Q6J("disabled",!r.isESCPreview),e.xp6(4),e.Q6J("disabled",!r.isPreview)}}function De(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div")(1,"button",128),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.navigateTo())}),e._uU(2," Back To Action Center "),e.qZA()()}}function Ne(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",129)(1,"button",128),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.submit())}),e._uU(2,"Reject"),e.qZA()()}}function Me(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",129)(1,"button",128),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.submit())}),e._uU(2,"Amend PO"),e.qZA()()}}function qe(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",129)(1,"button",128),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.openCancelModal())}),e._uU(2,"Cancel"),e.qZA()()}}function Fe(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"div",130)(1,"button",128),e.NdJ("click",function(){e.CHM(r);const t=e.oxw();return e.KtG(t.submit())}),e._uU(2,"Approve"),e.qZA()()}}const N=function(){return["cancel","reject"]},Je=function(){return["create","edit"]};let Ie=(()=>{var a;class s{get f(){return this.form.controls}constructor(i,t,n,o,p,u,_,b){this.purchaseService=i,this.activatedRoute=t,this.spinner=n,this.toastService=o,this.validationService=p,this.modalService=u,this.utilityService=_,this.location=b,this.page=1,this.pageSize=5,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.submitted=!1,this.isPreview=!1,this.POTypeObj=T.i3,this.POTypeArr=T.i3.getAllPurchasePOType(),this.action="create",this.earnings=[],this.PODetailsArray=[],this.supplierOptions=[],this.purchaseCategoryValues={},this.selectedSupplierDetails={},this.minDate=new Date,this.filterItems=[],this.ESCPreviewArr=[],this.isESCPreview=!1,this.statusArr={create:"Awaiting Approval",edit:"Awaiting Approval",approve:"Approved",reject:"Rejected",cancel:"Cancelled"},this.masterData={purchaseCategoryOptions:[],paymentTermsOptions:[],freightTermsOptions:[],transporterOptions:[],locationOptions:[],serviceChargesList:[]},this.totalServiceCharges=0,this.form=new l.nJ({_id:new l.p4(null),purchaseCategory:new l.p4(null,[l.kI.required]),supplier:new l.p4(null,[l.kI.required]),changedPaymentTerms:new l.p4(null),POType:new l.p4(this.POTypeObj.STANDARD_PO),PONumber:new l.p4(""),PODate:new l.p4(""),POValidity:new l.p4(null,[l.kI.required]),orderReference:new l.p4(""),currency:new l.p4(""),deliveryLocation:new l.p4(null,[l.kI.required]),freightTerms:new l.p4("FOR - Free On Road"),transporter:new l.p4(null),deliveryDate:new l.p4(""),PODetails:new l.p4([]),remarks:new l.p4(""),PORemarks:new l.p4(""),totalLineValue:new l.p4(0),netPOValue:new l.p4(0),totalPPV:new l.p4(0),cancellationReason:new l.p4(""),serviceChargesInfo:new l.p4([]),totalServiceCharges:new l.p4(0),POStatus:new l.p4("Awaiting Approval")})}ngOnInit(){this.getInitialData()}navigateTo(){this.location.back()}submit(){if(this.submitted=!0,this.isPreview=!1,this.form.enable(),this.validationService.checkErrors(this.form,k.D))return;if("reject"==this.action&&!this.form.controls.remarks.value)return void this.toastService.warning("Reject Remark is Required");if("cancel"==this.action&&!this.form.controls.cancellationReason.value)return void this.toastService.warning("Reason for Cancellation is Required");let i=this.form.value;if(i.serviceChargesInfo=this.masterData?.serviceChargesList,i.PODetails=this.filterItems.filter(t=>t.POQty>0),0!=i.PODetails.length){if(this.POTypeObj.PLANNED_PO==this.f.POType.value){if("create"==this.action&&!i.PODetails.some(n=>n.deliverySchedule))return void this.toastService.warning("Delivery Schedule is required");if("edit"==this.action&&!i.PODetails.some(n=>n.deliverySchedule.length>0))return void this.toastService.warning("Delivery Schedule is required")}i._id?this.update(i):(delete i._id,this.create(i))}else this.toastService.warning("POQty can not be zero")}update(i){this.spinner.show(),this.purchaseService.update(i._id,i).subscribe(t=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(t.message),this.location.back()})}create(i){this.spinner.show(),this.purchaseService.create(i).subscribe(t=>{this.submitted=!1,this.spinner.hide(),this.toastService.success(t.message),this.location.back()})}reset(){this.form.reset(),this.supplierOptions=[],this.isPreview=!1,this.isESCPreview=!1,this.filterItems=[],this.collection=this.filterItems.length,this.getInitialData()}preview(){this.isESCPreview=!0,this.ESCPreviewArr=this.filterItems,this.search="",this.filterItems=this.filterItems.filter(i=>i.POQty>0),this.filterItems.length>0?this.isPreview=!0:(this.toastService.warning("At least One Row is Required"),this.isPreview=!1),this.collection=this.filterItems.length}ESCPreview(){this.search="",this.isPreview=!1,this.filterItems=this.ESCPreviewArr,this.collection=this.filterItems.length}getInitialData(){this.spinner.show(),this.purchaseService.getAllMasterData({}).subscribe(i=>{this.masterData=i,1==this.masterData.locationOptions.length&&this.form.controls.deliveryLocation.patchValue(this.masterData.locationOptions[0]?.label),this.masterData?.serviceChargesList?.length>0&&(this.masterData.serviceChargesList=this.masterData?.serviceChargesList?.map(t=>(t.oldGSTRate=t.GSTRate,t.oldIGSTRate=t.IGSTRate,t.oldSGSTRate=t.SGSTRate,t.oldCGSTRate=t.CGSTRate,t.oldUGSTRate=t.UGSTRate,t.serviceCharges=0,t.currency="INR",t))),this.purchaseCategoryValues=i?.autoIncValues,this.f.PODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.f.deliveryDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.freightTerms.setValue("FOR - Free On Road"),this.form.controls.POType.setValue(this.POTypeObj.STANDARD_PO),this.setPOValidity(),this.form.controls.POStatus.patchValue("Awaiting Approval"),this.form.controls.POStatus.setValue(this.statusArr[this.action]),this.form.controls.currency.setValue("INR"),this.activatedRoute.queryParams.pipe((0,J.z)(t=>(this.action=t.action,this.utilityService.accessDenied(this.action),t.id?this.purchaseService.getById(t.id):(0,I.of)({})))).subscribe(t=>{this.spinner.hide(),0!=Object.keys(t).length&&(t.PODate&&(t.PODate=this.utilityService.getFormatDate(t.PODate,"YYYY-MM-DD")),t.POValidity&&(t.POValidity=this.utilityService.getFormatDate(t.POValidity,"YYYY-MM-DD")),t.supplier._id&&t.supplier&&(t.supplier=t?.supplier?._id),t.deliveryDate&&(t.deliveryDate=this.utilityService.getFormatDate(t.deliveryDate,"YYYY-MM-DD")),t.PODetails.length&&t.PODetails[0].deliveryDate&&(t.PODetails[0].deliveryDate=this.utilityService.getFormatDate(t.PODetails[0].deliveryDate,"YYYY-MM-DD")),t.purchaseCategory&&(this.spinner.show(),this.purchaseService.getSupplierByCategory({purchaseCategory:t.purchaseCategory}).subscribe(n=>{this.supplierOptions=n,this.spinner.hide()})),this.filterItems=t.PODetails.map((n,o)=>(n.unitConversion||(n.unitConversion=n.item.primaryToSecondaryConversion?`1 ${n.item.primaryUnit??"Unit"} = ${n.item.primaryToSecondaryConversion??1} ${n.item.secondaryUnit??"Unit"}`:`1 ${n.item.secondaryUnit??"Unit"} = ${n.item.secondaryToPrimaryConversion??1} ${n.item.primaryUnit??"Unit"}`),n.POLineNumber=o+1,n.netRate=n.netRate??n.purchaseRate,n.discount=n.discount??0,t?.purchaseCategory?.includes("Imports")&&(n.gst=0,n.igst=0,n.cgst=0,n.sgst=0),n)),"edit"!=this.action&&(this.filterItems=this.filterItems.filter(n=>0!=n.POQty)),this.f.totalLineValue.setValue(this.filterItems.map(n=>n.lineValue).reduce((n,o)=>n+o,0).toFixed(2)),this.collection=this.filterItems.length,t.POStatus="Supplementary PO"==t.POStatus?"Closed":this.statusArr[this.action],t.serviceChargesInfo&&(this.masterData.serviceChargesList=t.serviceChargesInfo),this.form.patchValue(t),this.totalServiceCharges=t?.totalServiceCharges??0,this.f.purchaseCategory.disable(),this.f.supplier.disable(),this.f.POType.disable(),"edit"!=this.action&&(this.form.disable(),["approve","reject","cancel"].includes(this.action)&&(this.f.remarks.enable(),this.f.cancellationReason.enable()),this.f.POStatus.enable()),"amend"==this.action&&this.f.PODate.enable())})})}setPOValidityFromPODate(){this.setPOValidity()}setPOValidity(){if(this.POTypeObj.STANDARD_PO==this.f.POType.value){let t=this.utilityService.getAddFormat(this.f.PODate.value,1);this.f.POValidity.setValue(t)}else if(this.POTypeObj.PLANNED_PO==this.f.POType.value){let t=this.utilityService.getAddFormat(this.f.PODate.value,1);this.f.POValidity.setValue(t)}else if(this.POTypeObj.BLANKET_PO==this.f.POType.value){let t=this.utilityService.getAddFormat(this.f.PODate.value,12);this.f.POValidity.setValue(t)}if(this.filterItems=this.filterItems.map(this.POTypeObj.STANDARD_PO!=this.f.POType.value?i=>(i.deliveryDate=this.utilityService.getTodayDate("YYYY-MM-DD"),i):i=>(i.deliveryDate=i.leadDeliveryDate,i)),[this.POTypeObj.STANDARD_PO,this.POTypeObj.PLANNED_PO].includes(this.f.POType.value))for(const i of this.filterItems)if(i.deliverySchedule){let t=1;for(let n=0;n<t;n++)i.deliverySchedule=[{scheduleNo:n+1,quantity:i.POQty,UOM:i.UOM,deliveryDate:i.deliveryDate}],i.scheduleNo=1}}openCancelModal(){const i=this.modalService.open(x.er,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});i.componentInstance.action=this.action,i.componentInstance.heading="PO Cancellation",i.componentInstance.cancelText="Do You Want to Cancel Purchase Order ?",i.result.then(t=>{"Yes"==t&&this.submit()},t=>{})}clearFilter(){this.search="",this.page=1,this.pageSize=10,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.getInitialData()}setDelivery(){this.filterItems=this.filterItems.map(n=>(n.deliveryDate=this.utilityService.getFormatDate(this.f.deliveryDate.value,"YYYY-MM-DD"),n)),this.form.controls.PODate.value>this.form.controls.deliveryDate.value&&(this.toastService.warning("Please Take Proper Date !"),this.form.controls.deliveryDate.reset())}getSuppliers(i){this.form.controls.PONumber.setValue(this.purchaseCategoryValues[i.value]),this.f.supplier.setValue(null),this.selectedSupplierDetails={},this.spinner.show(),this.purchaseService.getSupplierByCategory({purchaseCategory:i.value}).subscribe(t=>{this.supplierOptions=t,this.spinner.hide()}),this.filterItems=[],this.masterData.serviceChargesList=this.f.purchaseCategory.value?.includes("Imports")?this.masterData?.serviceChargesList?.map(t=>(t.GSTRate=0,t.IGSTRate=0,t.SGSTRate=0,t.CGSTRate=0,t.UGSTRate=0,t)):this.masterData?.serviceChargesList?.map(t=>(t.GSTRate=t.oldGSTRate,t.IGSTRate=t.oldIGSTRate,t.SGSTRate=t.oldSGSTRate,t.CGSTRate=t.oldCGSTRate,t.UGSTRate=t.oldUGSTRate,t))}supplierValueChange(i){this.spinner.show(),this.purchaseService.getAllItemsForSupplier({supplierId:i.value}).subscribe(t=>{this.filterItems=t.map((n,o)=>(n.POLineNumber=o+1,n.netRate=n.purchaseRate,n.discount=0,this.f.purchaseCategory.value?.includes("Imports")&&(n.gst=0,n.igst=0,n.cgst=0,n.sgst=0),n.unitConversion||(n.unitConversion=n.primaryToSecondaryConversion?`1 ${n.primaryUnit??"Unit"} = ${n.primaryToSecondaryConversion??1} ${n.secondaryUnit??"Unit"}`:`1 ${n.secondaryUnit??"Unit"} = ${n.secondaryToPrimaryConversion??1} ${n.primaryUnit??"Unit"}`),this.f.POType.value==this.POTypeObj.STANDARD_PO&&(n.deliveryDate=n?.leadDeliveryDate),n)),this.spinner.hide()}),this.f.currency.setValue(i?.supplierCurrency),this.f.transporter.setValue(i?.lastTransporter),this.f.changedPaymentTerms.setValue(i?.supplierPaymentTerms),this.f.deliveryDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.masterData.serviceChargesList=this.masterData?.serviceChargesList?.map(t=>(t.currency=i?.supplierCurrency??"INR",t)),this.collection=this.filterItems.length}lineValueRate(i,t){let n=this.filterItems.map(o=>o.POLineNumber).indexOf(i);if(this.filterItems[n].balancedQty=t.POQty,this.filterItems[n].netRate=+t.purchaseRate-+t.discount/100*+t.purchaseRate,this.filterItems[n].lineValue=Number((+t.POQty*+t.netRate).toFixed(2)),this.filterItems[n].linePPV=Number((+t.POQty*+t.standardRate-+t.POQty*+t.netRate).toFixed(2)),this.f.totalLineValue.setValue(this.filterItems.map(o=>o.lineValue).reduce((o,p)=>o+p,0).toFixed(2)),this.f.netPOValue.setValue((+this.f.totalLineValue.value+ +this.totalServiceCharges).toFixed(2)),this.f.totalPPV.setValue(this.filterItems.map(o=>o.linePPV).reduce((o,p)=>o+p,0).toFixed(2)),this.POTypeObj.STANDARD_PO==this.f.POType.value&&(!t.deliverySchedule||0==t.deliverySchedule.length)){let o=1;for(let p=0;p<o;p++)t.deliverySchedule=[{scheduleNo:p+1,quantity:t.POQty,UOM:t.UOM,deliveryDate:t.deliveryDate}],t.scheduleNo=1}if(t.deliverySchedule){let o=Math.floor(t.POQty/t.deliveryCount),p=t.POQty%t.deliveryCount;for(let u=0;u<t.deliveryCount;u++){let b=o;u===t.deliveryCount-1&&(b+=p),this.filterItems[n].deliverySchedule[u].quantity=b}}}setNetRate(i){let t=this.filterItems.map(n=>n.POLineNumber).indexOf(i?.POLineNumber);this.filterItems[t].netRate=+i.purchaseRate-+i.discount/100*+i.purchaseRate,this.filterItems[t].lineValue=+i.POQty*+i.netRate,this.filterItems[t].linePPV=Number((+i.POQty*+i.standardRate-+i.POQty*+i.netRate).toFixed(2)),this.f.totalLineValue.setValue(this.filterItems.map(n=>+n.lineValue).reduce((n,o)=>+n+ +o,0).toFixed(2)),this.f.netPOValue.setValue((+this.f.totalLineValue.value+ +this.totalServiceCharges).toFixed(2)),this.f.totalPPV.setValue(this.filterItems.map(n=>+n.linePPV).reduce((n,o)=>+n+ +o,0).toFixed(2))}setConversionOfUnit(i){if(["edit","create"].includes(this.action)){let t=this.filterItems.map(n=>n.POLineNumber).indexOf(i.POLineNumber);this.filterItems[t].UOM==i.secondaryUnit?(this.filterItems[t].UOM=i.primaryUnit,this.filterItems[t].purchaseRate=i.stdCostUom1,this.filterItems[t].standardRate=i.stdCostUom1,this.filterItems[t].POQty=0,this.isPreview=!1):(this.filterItems[t].UOM=i.secondaryUnit,this.filterItems[t].purchaseRate=i.stdCostUom2,this.filterItems[t].standardRate=i.stdCostUom2,this.filterItems[t].POQty=0,this.isPreview=!1),this.lineValueRate(i.POLineNumber,i)}}trackByFn(i,t){return t?._id}openOtherChargesModal(){if(0==this.masterData?.serviceChargesList?.length)return void this.toastService.warning("Pls Define Service Charges");const i=this.modalService.open(ee,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});i.componentInstance.action=this.action,i.componentInstance.totalServiceCharges=this.f.totalServiceCharges.value,i.componentInstance.serviceChargesList=this.masterData?.serviceChargesList,i.result.then(t=>{t&&["create","edit","amend"].includes(this.action)&&(console.log("success",t),this.masterData.serviceChargesList=t?.serviceChargesList,this.totalServiceCharges=t?.totalServiceCharges??0,this.f.totalServiceCharges.setValue(t?.totalServiceCharges??0),this.f.netPOValue.setValue((+this.f.totalLineValue.value+ +this.totalServiceCharges).toFixed(2)))},t=>{})}openPOTermsModal(){const i=this.modalService.open(H,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});i.componentInstance.action=this.action,i.componentInstance.paymentTermsArr=this.masterData.paymentTermsOptions,i.componentInstance.deliveryLocationArr=this.masterData.locationOptions,i.componentInstance.freightTermsArr=this.masterData.freightTermsOptions,i.componentInstance.transporterArr=this.masterData.transporterOptions,i.componentInstance.POTerms={deliveryLocation:this.f.deliveryLocation.value,changedPaymentTerms:this.f.changedPaymentTerms.value,freightTerms:this.f.freightTerms.value,transporter:this.f.transporter.value,PORemarks:this.f.PORemarks.value},i.result.then(t=>{t&&["create","edit"].includes(this.action)&&this.form.patchValue(t)},t=>{})}openPOScheduleModal(i){if(!i.POQty)return void this.toastService.warning("Pls enter PO Qty !!");const t=this.modalService.open(z.f,{centered:!0,size:"md",backdrop:"static",keyboard:!1});t.componentInstance.action=this.action,t.componentInstance.POType=this.f.POType.value,t.componentInstance.POQty=i.POQty,t.componentInstance.deliveryCount=i.deliveryCount,t.componentInstance.UOM=i.UOM,t.componentInstance.deliveryDate=this.utilityService.getFormatDate(i.deliveryDate,"YYYY-MM-DD"),i.deliverySchedule&&(t.componentInstance.deliveryScheduleArr=i?.deliverySchedule.map(n=>(n.deliveryDate=this.utilityService.getFormatDate(n.deliveryDate,"YYYY-MM-DD"),n))),t.result.then(n=>{if(n&&["create","edit"].includes(this.action)){let o=this.filterItems.map(p=>p.POLineNumber).indexOf(i.POLineNumber);this.filterItems[o].deliveryCount=n.deliveryCount,this.filterItems[o].deliverySchedule=n.deliverySchedule,this.POTypeObj.STANDARD_PO==this.f.POType.value&&(this.filterItems[o].deliveryDate=n?.deliverySchedule[0]?.deliveryDate)}},n=>{})}onSort({column:i,direction:t}){this.headers.forEach(n=>{n.sortable!==i&&(n.direction="")}),this.filterItems=""===t||""===i?this.filterItems:[...this.filterItems].sort((n,o)=>{let p="string"==typeof n[i]?n[i].toLowerCase():n[i],u="string"==typeof o[i]?o[i].toLowerCase():o[i];const _=p<u?-1:p>u?1:0;return"asc"===t?_:-_})}openSupplierDetailsModal(){const i=this.modalService.open(x.Nx,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});i.componentInstance.action=this.action,i.componentInstance.selectedSupplierDetails=this.selectedSupplierDetails,i.componentInstance.supplierOptions=this.supplierOptions,i.componentInstance.supplier=this.form.controls.supplier.value,i.result.then(t=>{t&&(this.selectedSupplierDetails=t?.selectedSupplierDetails,this.form.controls.supplier.setValue(t?.selectedSupplierDetails?._id),this.supplierValueChange(this.selectedSupplierDetails))},t=>{})}}return(a=s).\u0275fac=function(i){return new(i||a)(e.Y36(y.x$),e.Y36(g.gz),e.Y36(m.V),e.Y36(m.kl),e.Y36(te.RJ),e.Y36(h.FF),e.Y36(m.tI),e.Y36(d.Ye))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-po-form"]],viewQuery:function(i,t){if(1&i&&e.Gf(f.j,5),2&i){let n;e.iGM(n=e.CRH())&&(t.headers=n)}},decls:153,vars:48,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading"],[1,"form-body"],[1,"row","mb-0"],[1,"col-md-5"],[1,"row"],[1,"col-5"],[1,"form-label","mb-1"],[1,"text-danger"],["bindLabel","label","bindValue","value","formControlName","purchaseCategory",3,"items","clearable","change"],[1,"col-3","px-0"],["readonly","","type","text","formControlName","PONumber",1,"form-control"],[1,"col-4","ps-2","pe-5"],["type","date","formControlName","PODate",1,"form-control",3,"input"],[1,"col-7","ps-3"],[1,"col-5","ps-0","pe-4"],[1,"text-danger","pe-5"],[1,"d-flex","align-items-center"],[1,"col-11"],["bindLabel","label","bindValue","value","formControlName","supplier","placeholder","Select a Supplier",3,"items","clearable","change"],["id","basic-addon1",1,"set-input-group-text","input-group-text","bg-primary","pointer","col-auto",2,"height","2.9rem",3,"click"],["aria-hidden","true",1,"fa","fa-search","text-white"],[1,"col-3"],["type","text","formControlName","orderReference",1,"form-control"],[1,"col-1","px-0"],["type","text","formControlName","currency","readonly","",1,"form-control"],["formControlName","POType",1,"form-select","fs-5",3,"change"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"row","line-border"],[1,"row","justify-content-between"],[1,"col-4"],[1,"d-flex"],["id","basic-addon1",1,"set-input-group-text","input-group-text","bg-primary"],["type","text",1,"form-control",3,"ngModel","ngModelOptions","ngModelChange"],[1,"col-4","d-flex","justify-content-center"],[3,"collectionSize","page","pageSize","boundaryLinks","pageChange",4,"ngIf"],[1,"table-responsive",2,"min-height","19rem"],[1,"table","table-bordered","table-sticky","text-center"],[1,"bg-primary"],[1,"text-white"],["sortable","itemCode",3,"sort"],["sortable","name",1,"text-start",3,"sort"],["sortable","description",1,"text-start",3,"sort"],["sortable","UOM",3,"sort"],["sortable","standardRate",3,"sort",4,"ngIf"],["sortable","POQty",3,"sort"],["sortable","purchaseRate",3,"sort"],["sortable","lineValue",3,"sort"],["sortable","linePPV",3,"sort",4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-12","d-flex"],[1,"d-flex","justify-content-center"],[1,"col-form-label","text-nowrap","pe-1","pt-1"],[1,"input-group-text","combine-INR","text-secondary"],[1,"vr","ms-3"],["type","number","formControlName","totalLineValue","readonly","",1,"form-control","border-start-0","ps-0"],[1,"mx-2","align-self-center","mb-2"],["aria-hidden","true",1,"fa","fa-plus","fa-lg","text-info"],[1,"text-nowrap"],["type","button",1,"btn","btn-sm","btn-primary","me-2","d-flex","align-items-center","mb-2",3,"click"],[1,"d-flex","inputGroup"],["type","text","readOnly","",1,"form-control","mt-0","w-25","border-start-0","ps-0",3,"ngModel","ngModelOptions","ngModelChange"],[1,"mx-2","align-text-top"],["aria-hidden","true",1,"fs-3","fw-bolder","text-info","me-0"],["type","number","formControlName","netPOValue","readonly","",1,"form-control","ps-0","border-start-0"],[1,"col-form-label","text-nowrap","pe-1","ms-5","pt-1"],["type","text","readonly","","formControlName","totalPPV",1,"form-control","ps-0","border-start-0"],[1,"col-2","pe-0"],["type","button",1,"btn","btn-primary","px-3",3,"click"],["class","col-3 ps-4 pe-5",4,"ngIf"],["class","col-3",4,"ngIf"],["class","col-6",4,"ngIf"],[1,"col-4","ps-0","d-flex","justify-content-end"],["class","d-grid gap-2 d-md-block",4,"ngIf"],[4,"ngIf"],["class","col-5 text-end",4,"ngIf"],["class","col-5 d-flex justify-content-end",4,"ngIf"],[3,"value"],[3,"collectionSize","page","pageSize","boundaryLinks","pageChange"],["ngbPaginationPrevious",""],["ngbPaginationNext",""],["ngbPaginationPages",""],["src","./assets/new_icons/pagination_prev.svg","width","20rem"],["src","./assets/new_icons/pagination_next.svg","width","20rem"],["class","ngb-custom-pages-item align-self-center",4,"ngIf"],[1,"ngb-custom-pages-item","align-self-center"],[1,"page-label","me-2","ms-1"],["sortable","standardRate",3,"sort"],["sortable","linePPV",3,"sort"],[1,"text-start"],["name",""],[1,"pointer",3,"positionTarget","ngbTooltip"],["description",""],[1,"d-flex","justify-content-between","px-2"],["placement","top",3,"ngbTooltip","ngClass"],[1,"pointer","d-flex","align-items-center"],["class","unit-switch-rev",3,"click",4,"ngIf"],["class","unit-switch-gray",4,"ngIf"],["class","form-control form-control-sm w-25","type","number","min","0",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["class","form-control form-control-sm w-25","type","number",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["type","number","class","form-control form-control-xs w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["class","d-flex justify-content-center pointer",3,"click",4,"ngIf"],["class","d-flex justify-content-center setPOType",4,"ngIf"],[1,"unit-switch-rev",3,"click"],[1,"unit-switch-gray"],["type","number","min","0",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],["type","number",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],["type","number",1,"form-control","form-control-xs","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],[1,"d-flex","justify-content-center","pointer",3,"click"],[1,"assetCalendarTD"],[1,"d-flex","justify-content-center","setPOType"],[1,"col-3","ps-4","pe-5"],[1,"col-form-label","text-nowrap"],[1,"text-danger","pe-2"],[1,"fa","fa-caret-right","fa-5x","mx-1"],["type","date","formControlName","POValidity",1,"form-control"],[1,"col-6"],[1,"d-flex","justify-content-start","align-items-start"],["type","text","formControlName","remarks",1,"form-control","mx-2"],["type","text","formControlName","cancellationReason",1,"form-control","mx-2"],[1,"d-grid","gap-2","d-md-block"],["type","button",1,"btn","btn-primary","px-5","me-3",3,"click"],["type","button",1,"btn","btn-primary","me-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","px-4","me-3",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"disabled","click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"col-5","text-end"],[1,"col-5","d-flex","justify-content-end"]],template:function(i,t){1&i&&(e.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label"),e._uU(5),e.ALo(6,"titlecase"),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"label",9),e._uU(13," Purchase Category"),e.TgZ(14,"span",10),e._uU(15,"*"),e.qZA()(),e.TgZ(16,"ng-select",11),e.NdJ("change",function(o){return t.getSuppliers(o)}),e.qZA()(),e.TgZ(17,"div",12)(18,"label",9),e._uU(19," PO No."),e.qZA(),e._UZ(20,"input",13),e.qZA(),e.TgZ(21,"div",14)(22,"label",9),e._uU(23,"PO Date"),e.qZA(),e.TgZ(24,"input",15),e.NdJ("input",function(){return t.setPOValidityFromPODate()}),e.qZA()()()(),e.TgZ(25,"div",16)(26,"div",7)(27,"div",17)(28,"label",9),e._uU(29," Supplier Name "),e.TgZ(30,"span",18),e._uU(31,"*"),e.qZA()(),e.TgZ(32,"div",19)(33,"div",20)(34,"ng-select",21),e.NdJ("change",function(o){return t.supplierValueChange(o)}),e.qZA()(),e.TgZ(35,"div",22),e.NdJ("click",function(){return t.openSupplierDetailsModal()}),e._UZ(36,"i",23),e.qZA()()(),e.TgZ(37,"div",24)(38,"label",9),e._uU(39," Order Reference"),e.qZA(),e._UZ(40,"input",25),e.qZA(),e.TgZ(41,"div",26)(42,"label",9),e._uU(43," Ccy"),e.qZA(),e._UZ(44,"input",27),e.qZA(),e.TgZ(45,"div",24)(46,"label",9),e._uU(47,"PO Type"),e.qZA(),e.TgZ(48,"select",28),e.NdJ("change",function(){return t.setPOValidity()}),e.TgZ(49,"option",29),e._uU(50,"Select PO Type"),e.qZA(),e.YNc(51,oe,2,2,"option",30),e.qZA()()()()()(),e._UZ(52,"hr",31),e.TgZ(53,"div",32)(54,"div",33)(55,"div",34)(56,"div",35),e._UZ(57,"i",23),e.qZA(),e.TgZ(58,"div")(59,"input",36),e.NdJ("ngModelChange",function(o){return t.search=o}),e.qZA()()()(),e.TgZ(60,"div",37),e.YNc(61,pe,4,4,"ngb-pagination",38),e.qZA(),e._UZ(62,"div",33),e.qZA(),e.TgZ(63,"div",39)(64,"table",40)(65,"thead",41)(66,"tr",42)(67,"th",43),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(68,"Item Code"),e.qZA(),e.TgZ(69,"th",44),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(70,"Item Name"),e.qZA(),e.TgZ(71,"th",45),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(72,"Item Description"),e.qZA(),e.TgZ(73,"th",46),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(74,"UoM"),e.qZA(),e.YNc(75,ue,2,0,"th",47),e.TgZ(76,"th",48),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(77,"PO Qty"),e.qZA(),e.TgZ(78,"th",49),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(79,"Rate/Unit"),e.qZA(),e.TgZ(80,"th",49),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(81,"Disc %"),e.qZA(),e.TgZ(82,"th",50),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(83,"Net Rate"),e.qZA(),e.TgZ(84,"th",50),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(85,"Line Value"),e.qZA(),e.YNc(86,de,2,0,"th",51),e.TgZ(87,"th"),e._uU(88,"Sch."),e.qZA()()(),e.TgZ(89,"tbody"),e.YNc(90,Ae,42,44,"tr",52),e.ALo(91,"slice"),e.ALo(92,"searchFi1ter"),e.qZA()()(),e._UZ(93,"hr",31),e.TgZ(94,"div",7)(95,"div",53)(96,"div",54)(97,"div",55),e._uU(98," Total Item Value: "),e.qZA(),e.TgZ(99,"div",34)(100,"span",56),e._uU(101),e._UZ(102,"div",57),e.qZA(),e._UZ(103,"input",58),e.qZA()(),e.TgZ(104,"div",54)(105,"div",59),e._UZ(106,"i",60),e.qZA(),e.TgZ(107,"div",61)(108,"button",62),e.NdJ("click",function(){return t.openOtherChargesModal()}),e.TgZ(109,"span"),e._uU(110,"Add Service Charges"),e.qZA()()(),e.TgZ(111,"div",63)(112,"div",34)(113,"span",56),e._uU(114),e._UZ(115,"div",57),e.qZA(),e.TgZ(116,"input",64),e.NdJ("ngModelChange",function(o){return t.totalServiceCharges=o}),e.qZA()()()(),e._UZ(117,"div",63),e.TgZ(118,"div",65)(119,"div",66),e._uU(120,"="),e.qZA()(),e.TgZ(121,"div",54)(122,"div",55),e._uU(123," Net PO Value: "),e.qZA(),e.TgZ(124,"div",34)(125,"span",56),e._uU(126),e._UZ(127,"div",57),e.qZA(),e._UZ(128,"input",67),e.qZA()(),e.TgZ(129,"div",54)(130,"div",68),e._uU(131," PPV: "),e.qZA(),e.TgZ(132,"div",34)(133,"span",56),e._uU(134),e._UZ(135,"div",57),e.qZA(),e._UZ(136,"input",69),e.qZA()()()(),e._UZ(137,"hr",31),e.TgZ(138,"div",7)(139,"div",70)(140,"button",71),e.NdJ("click",function(){return t.openPOTermsModal()}),e._uU(141,"Review PO Terms"),e.qZA()(),e.YNc(142,Oe,8,0,"div",72),e.YNc(143,Se,1,0,"div",73),e.YNc(144,xe,5,0,"div",74),e.YNc(145,Ue,7,0,"div",74),e.TgZ(146,"div",75),e.YNc(147,we,9,2,"div",76),e.YNc(148,De,3,0,"div",77),e.YNc(149,Ne,3,0,"div",78),e.YNc(150,Me,3,0,"div",78),e.YNc(151,qe,3,0,"div",78),e.YNc(152,Fe,3,0,"div",79),e.qZA()()()()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(5),e.hij(" ",e.lcZ(6,31,t.action)," Purchase Order "),e.xp6(11),e.Q6J("items",t.masterData.purchaseCategoryOptions)("clearable",!1),e.xp6(18),e.Q6J("items",t.supplierOptions)("clearable",!1),e.xp6(15),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",t.POTypeArr),e.xp6(8),e.Q6J("ngModel",t.search)("ngModelOptions",e.DdM(40,P)),e.xp6(2),e.Q6J("ngIf",t.filterItems.length>0),e.xp6(14),e.Q6J("ngIf",e.DdM(41,O).includes(t.action)),e.xp6(11),e.Q6J("ngIf",e.DdM(42,D).includes(t.action)),e.xp6(4),e.Q6J("ngForOf",e.Dn7(91,33,e.xi3(92,37,t.filterItems,t.search),(t.page-1)*t.pageSize,(t.page-1)*t.pageSize+t.pageSize))("ngForTrackBy",t.trackByFn),e.xp6(11),e.hij(" ",t.f.currency.value," "),e.xp6(13),e.hij(" ",t.f.currency.value," "),e.xp6(2),e.Q6J("ngModel",t.totalServiceCharges)("ngModelOptions",e.DdM(43,P)),e.xp6(10),e.hij(" ",t.f.currency.value," "),e.xp6(8),e.hij(" ",t.f.currency.value," "),e.xp6(8),e.Q6J("ngIf",!e.DdM(44,N).includes(t.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(45,N).includes(t.action)),e.xp6(1),e.Q6J("ngIf","reject"==t.action),e.xp6(1),e.Q6J("ngIf","cancel"==t.action),e.xp6(2),e.Q6J("ngIf",e.DdM(46,Je).includes(t.action)),e.xp6(1),e.Q6J("ngIf",e.DdM(47,O).includes(t.action)),e.xp6(1),e.Q6J("ngIf","reject"==t.action),e.xp6(1),e.Q6J("ngIf","amend"==t.action),e.xp6(1),e.Q6J("ngIf","cancel"==t.action),e.xp6(1),e.Q6J("ngIf","approve"==t.action))},dependencies:[d.mk,d.sg,d.O5,h.N9,h.GZ,h.ju,h.Qy,h._L,l.YN,l.Kr,l.Fj,l.wV,l.EJ,l.JJ,l.JL,l.qQ,l.sg,l.u,l.On,ie.w9,f.j,d.OU,d.JJ,d.rS,ne.G,re.S],styles:[".pagination[_ngcontent-%COMP%]{margin-bottom:0!important}ngb-pagination[_ngcontent-%COMP%]     ul.pagination{margin:0!important}.page-label[_ngcontent-%COMP%]{color:var(--bs-dark);padding:0 1rem;font-size:1.4rem}ngb-pagination[_ngcontent-%COMP%]     ul>li:not(.active)>a{border:none!important;color:var(--bs-white)!important;background-color:#fff!important;box-shadow:none}.fa[_ngcontent-%COMP%]{font-size:1.6rem!important}.set-input-group-text[_ngcontent-%COMP%]{border-radius:0!important;height:2.8rem!important;width:3rem}.settingMargin[_ngcontent-%COMP%]{margin-top:1.5rem;margin-bottom:1.5rem}.currency[_ngcontent-%COMP%]{padding:0 3rem;border-radius:1.5px;border:.1px solid #302f2f!important;color:#555353!important;height:2.3rem;width:4rem;display:flex;align-items:center;justify-content:center;margin-top:.6rem;margin-left:.2rem;font-size:1.3rem}.po-currency-btn-sm[_ngcontent-%COMP%]{height:2.3rem;font-size:1.3rem!important}.setPOType[_ngcontent-%COMP%]{cursor:pointer;opacity:.5}"]}),s})();var ke=c(56208);function Re(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td",17,18)(9,"span",19),e._uU(10),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td")(18,"div",20),e._UZ(19,"button",21),e.TgZ(20,"div",22)(21,"a",23),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",n,"cancel"))}),e._UZ(22,"i",24),e._uU(23," Cancel "),e.qZA()()()()()}if(2&a){const r=s.$implicit,i=e.MAs(8),t=e.oxw();e.xp6(2),e.Oqu(null==r?null:r.PONumber),e.xp6(2),e.Oqu(null==r?null:r.PODateS),e.xp6(2),e.Oqu(null==r?null:r.purchaseCategory),e.xp6(1),e.Udp("width",i.clientWidth),e.xp6(2),e.Q6J("positionTarget",i)("ngbTooltip",r.supplierName),e.xp6(1),e.hij(" ",r.supplierName," "),e.xp6(2),e.Oqu(null==r?null:r.currency),e.xp6(2),e.Oqu(null==r?null:r.netPOValue),e.xp6(2),e.Oqu(null==r?null:r.POStatus),e.xp6(5),e.ekj("disable","Cancelled"===(null==r?null:r.POStatus)),e.Q6J("accessType",t.rolePermissionActions.approveAction)}}const Le=function(a,s,r,i){return{page:a,pageSize:s,collection:r,search:i,type:"list"}};let Qe=(()=>{var a;class s{constructor(i,t,n,o,p,u){this.purchaseService=i,this.router=t,this.spinner=n,this.exportExcelService=o,this.activatedRoute=p,this.exportToPDFService=u,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Rejected","GRN Partial Created","GRN Created","Closed","Cancelled"],this.rolePermissionActions=T.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(i,t,n){this.router.navigate([i],{relativeTo:this.activatedRoute,queryParams:{id:t?._id,action:n}})}eventHeader(i){switch(i.key){case"SEARCH":this.search=i.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=i.value,this.getAll()}}getAll(i=!1,t=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:i};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.purchaseService.getAll(n).subscribe(o=>{"EXCEL"==t?this.excelDownload(o.rows):"PDF"==t?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(i,t){return t?._id}excelDownload(i){this.exportExcelService.exportExcel((0,v.JH)(i))}pdfDownload(i){let t=(0,v.Av)(i);this.exportToPDFService.generatePdf(t.tableData,t.title)}onSort({column:i,direction:t}){this.headers.forEach(n=>{n.sortable!==i&&(n.direction="")}),this.column=i,this.direction="asc"==t?1:-1,this.getAll()}}return(a=s).\u0275fac=function(i){return new(i||a)(e.Y36(y.x$),e.Y36(g.F0),e.Y36(m.V),e.Y36(m.Ol),e.Y36(g.gz),e.Y36(m.$L))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-cancel-list"]],viewQuery:function(i,t){if(1&i&&e.Gf(f.j,5),2&i){let n;e.iGM(n=e.CRH())&&(t.headers=n)}},decls:28,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"row","line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","PONumber",3,"sort"],["sortable","PODateS",3,"sort"],["sortable","purchaseCategory",3,"sort"],["sortable","supplierName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","netPOValue",3,"sort"],["sortable","POStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplierName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-close","fa-lg","text-primary"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Cancellation[PO] Summary"),e.qZA()(),e._UZ(4,"hr",3),e.TgZ(5,"div",4)(6,"app-setting-header",5),e.NdJ("dataChange",function(o){return t.eventHeader(o)}),e.qZA(),e.TgZ(7,"table",6)(8,"thead",7)(9,"tr",8)(10,"th",9),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(11,"PO #"),e.qZA(),e.TgZ(12,"th",10),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(13,"PO Date"),e.qZA(),e.TgZ(14,"th",11),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(15,"Purchase Category"),e.qZA(),e.TgZ(16,"th",12),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(17,"Supplier Name"),e.qZA(),e.TgZ(18,"th",13),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(19,"Currency"),e.qZA(),e.TgZ(20,"th",14),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(21,"PO Value"),e.qZA(),e.TgZ(22,"th",15),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(23,"Status"),e.qZA(),e.TgZ(24,"th"),e._uU(25,"Action"),e.qZA()()(),e.TgZ(26,"tbody"),e.YNc(27,Re,24,14,"tr",16),e.qZA()()()()),2&i&&(e.xp6(6),e.Q6J("data",e.l5B(3,Le,t.page,t.pageSize,t.collection,t.search)),e.xp6(21),e.Q6J("ngForOf",t.tableData)("ngForTrackBy",t.trackByFn))},dependencies:[d.sg,Z.P,h._L,f.j,A.J],encapsulation:2}),s})();var Ye=c(65876);function Ve(a,s){if(1&a){const r=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td",17,18)(9,"span",19),e._uU(10),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td")(18,"div",20),e._UZ(19,"button",21),e.TgZ(20,"div",22)(21,"a",23),e.NdJ("click",function(){const n=e.CHM(r).$implicit,o=e.oxw();return e.KtG(o.navigateTo("/default/purchase/transactions/generate_purchase_order/form",n,"amend"))}),e._UZ(22,"i",24),e._uU(23," Edit "),e.qZA()()()()()}if(2&a){const r=s.$implicit,i=e.MAs(8),t=e.oxw();e.xp6(2),e.Oqu(null==r?null:r.PONumber),e.xp6(2),e.Oqu(null==r?null:r.PODateS),e.xp6(2),e.Oqu(null==r?null:r.purchaseCategory),e.xp6(1),e.Udp("width",i.clientWidth),e.xp6(2),e.Q6J("positionTarget",i)("ngbTooltip",r.supplierName),e.xp6(1),e.hij(" ",r.supplierName," "),e.xp6(2),e.Oqu(null==r?null:r.currency),e.xp6(2),e.Oqu(null==r?null:r.netPOValue),e.xp6(2),e.Oqu(null==r?null:r.POStatus),e.xp6(5),e.ekj("disable","Cancelled"===(null==r?null:r.POStatus)),e.Q6J("accessType",t.rolePermissionActions.editAction)}}const je=function(a,s,r,i){return{page:a,pageSize:s,collection:r,search:i,type:"list"}},Ee=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:F},{path:"form",component:Ie,resolve:{accessScreen:Ye.x}},{path:"cancel_list",component:Qe},{path:"amend_po",component:(()=>{var a;class s{constructor(i,t,n,o,p,u,_){this.purchaseService=i,this.router=t,this.toastService=n,this.spinner=o,this.exportExcelService=p,this.activatedRoute=u,this.exportToPDFService=_,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Awaiting Approval","Rejected","GRN Partial Created","GRN Created","Closed","Cancelled","Supplementary PO"],this.rolePermissionActions=T.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(i,t,n){this.router.navigate([i],{queryParams:{id:t?._id,action:n}})}eventHeader(i){switch(i.key){case"SEARCH":this.search=i.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=i.value,this.getAll()}}getAll(i=!1,t=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:i};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.purchaseService.getAll(n).subscribe(o=>{"EXCEL"==t?this.excelDownload(o.rows):"PDF"==t?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}trackByFn(i,t){return t?._id}update(i,t){"Approved"===i?.POStatus&&(i.POStatus=t,this.spinner.show(),this.purchaseService.update(i._id,i).subscribe(n=>{this.toastService.success(n.message),this.getAll(),this.spinner.hide()}))}excelDownload(i){this.exportExcelService.exportExcel((0,v.W1)(i))}pdfDownload(i){let t=(0,v._A)(i);this.exportToPDFService.generatePdf(t.tableData,t.title)}onSort({column:i,direction:t}){this.headers.forEach(n=>{n.sortable!==i&&(n.direction="")}),this.column=i,this.direction="asc"==t?1:-1,this.getAll()}}return(a=s).\u0275fac=function(i){return new(i||a)(e.Y36(y.x$),e.Y36(g.F0),e.Y36(m.kl),e.Y36(m.V),e.Y36(m.Ol),e.Y36(g.gz),e.Y36(m.$L))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-amend-po"]],viewQuery:function(i,t){if(1&i&&e.Gf(f.j,5),2&i){let n;e.iGM(n=e.CRH())&&(t.headers=n)}},decls:28,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","PONumber",3,"sort"],["sortable","PODateS",3,"sort"],["sortable","purchaseCategory",3,"sort"],["sortable","supplierName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","netPOValue",3,"sort"],["sortable","POStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplierName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Amend PO Summary"),e.qZA()(),e._UZ(4,"hr",3),e.TgZ(5,"div",4)(6,"app-setting-header",5),e.NdJ("dataChange",function(o){return t.eventHeader(o)}),e.qZA(),e.TgZ(7,"table",6)(8,"thead",7)(9,"tr",8)(10,"th",9),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(11,"PO #"),e.qZA(),e.TgZ(12,"th",10),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(13,"PO Date"),e.qZA(),e.TgZ(14,"th",11),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(15,"Purchase Category"),e.qZA(),e.TgZ(16,"th",12),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(17,"Supplier Name"),e.qZA(),e.TgZ(18,"th",13),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(19,"Currency"),e.qZA(),e.TgZ(20,"th",14),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(21,"PO Value"),e.qZA(),e.TgZ(22,"th",15),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(23,"Status"),e.qZA(),e.TgZ(24,"th"),e._uU(25,"Action"),e.qZA()()(),e.TgZ(26,"tbody"),e.YNc(27,Ve,24,14,"tr",16),e.qZA()()()()),2&i&&(e.xp6(6),e.Q6J("data",e.l5B(3,je,t.page,t.pageSize,t.collection,t.search)),e.xp6(21),e.Q6J("ngForOf",t.tableData)("ngForTrackBy",t.trackByFn))},dependencies:[d.sg,Z.P,h._L,f.j,A.J],encapsulation:2}),s})()}];let $e=(()=>{var a;class s{}return(a=s).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[d.ez,g.Bz.forChild(Ee),ke.m]}),s})()}}]);