"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[9692],{99692:(_t,A,c)=>{c.r(A),c.d(A,{BookSalesOrderModule:()=>pt});var m=c(96814),_=c(1076),g=c(43818),S=c(25116),f=c(79250),t=c(65879),p=c(2742),b=c(59840),C=c(88059),O=c(37285),Z=c(53421);function U(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td",21,22)(9,"span",23),t._uU(10),t.qZA()(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td")(18,"div",24),t._UZ(19,"button",25),t.TgZ(20,"div",26)(21,"a",27),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",o,"view"))}),t._UZ(22,"i",28),t._uU(23," View "),t.qZA(),t.TgZ(24,"a",27),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",o,"edit"))}),t._UZ(25,"i",29),t._uU(26," Edit "),t.qZA(),t.TgZ(27,"a",27),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",o,"cancel"))}),t._UZ(28,"i",30),t._uU(29," Cancel "),t.qZA(),t.TgZ(30,"a",27),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.navigateTo("../form",o,"approve"))}),t._UZ(31,"i",31),t._uU(32," Approve "),t.qZA(),t.TgZ(33,"a",27),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.update(o,"Report Generated"))}),t._UZ(34,"img",32),t._uU(35," Generate Report "),t.qZA(),t.TgZ(36,"a",27),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.navigateToPrint("/#/print/so_confirmation",o,"print","previewSO"))}),t._UZ(37,"i",33),t._uU(38," Preview SO "),t.qZA()()()()()}if(2&s){const r=l.$implicit,n=t.MAs(8),e=t.oxw();t.xp6(2),t.Oqu(null==r?null:r.SONumber),t.xp6(2),t.Oqu(null==r?null:r.SODateS),t.xp6(2),t.Oqu(null==r?null:r.salesCategory),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",r.customerName),t.xp6(1),t.hij(" ",r.customerName," "),t.xp6(2),t.Oqu(null==r?null:r.currency),t.xp6(2),t.Oqu(null==r?null:r.SOTotalAmount),t.xp6(2),t.Oqu(null==r?null:r.SOStatus),t.xp6(5),t.Q6J("accessType",e.rolePermissionActions.viewAction),t.xp6(3),t.ekj("disable","Approved"===(null==r?null:r.SOStatus)),t.Q6J("accessType",e.rolePermissionActions.editAction),t.xp6(3),t.ekj("disable","Approved"===(null==r?null:r.SOStatus)),t.Q6J("accessType",e.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Approved"===(null==r?null:r.SOStatus)),t.Q6J("accessType",e.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Created"===(null==r?null:r.SOStatus)),t.Q6J("accessType",e.rolePermissionActions.generateReportAction),t.xp6(3),t.Q6J("accessType",e.rolePermissionActions.createAction)}}const x=function(s,l,r,n){return{page:s,pageSize:l,collection:r,search:n,type:"list"}};let N=(()=>{var s;class l{constructor(n,e,o,i,u,d,h){this.exportExcelService=n,this.salesService=e,this.toastService=o,this.spinner=i,this.activatedRoute=u,this.exportToPDFService=d,this.utilityService=h,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Created","Approved"],this.rolePermissionActions=S.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(n,e,o){this.utilityService.navigateToForm({path:n,status:e.SOStatus,action:o,id:e._id,activatedRoute:this.activatedRoute})}trackByFn(n,e){return e?._id}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=n.value,this.getAll()}}navigateToPrint(n,e,o,i){window.open(`${window.location.origin}${n}?id=${e?._id}&action=${o}&preview=${i}`,"_blank")}update(n,e){"Approved"===n?.SOStatus&&(this.spinner.show(),this.salesService.update(n._id,{_id:n._id,SOStatus:e}).subscribe(o=>{this.toastService.success(o.message),this.getAll(),this.spinner.hide()}))}getAll(n=!1,e=""){this.spinner.show();let o={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,excel:n,statusArray:this.statusArray};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.salesService.getAll(o).subscribe(i=>{"EXCEL"==e?this.excelDownload(i.rows):"PDF"==e?this.pdfDownload(i.rows):(this.tableData=i.rows,this.collection=i.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(n){let e=(0,f.p3)(n);this.exportToPDFService.generatePdf(e.tableData,e.title)}excelDownload(n){this.exportExcelService.exportExcel((0,f.U$)(n))}onSort({column:n,direction:e}){this.headers.forEach(o=>{o.sortable!==n&&(o.direction="")}),this.column=n,this.direction="asc"==e?1:-1,this.getAll()}}return(s=l).\u0275fac=function(n){return new(n||s)(t.Y36(p.Ol),t.Y36(b.VD),t.Y36(p.kl),t.Y36(p.V),t.Y36(_.gz),t.Y36(p.$L),t.Y36(p.tI))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-bso-list"]],viewQuery:function(n,e){if(1&n&&t.Gf(g.j,5),2&n){let o;t.iGM(o=t.CRH())&&(e.headers=o)}},decls:32,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],["type","button",1,"btn","btn-primary","btn-add",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","SONumber",3,"sort"],["sortable","SODateS",3,"sort"],["sortable","salesCategory",3,"sort"],["sortable","customerName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","SOTotalAmount",3,"sort"],["sortable","SOStatus",3,"sort"],["sortable","status",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["customerName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa","fa-times","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","text-success"],["src","./assets/images/new.svg","width","14",1,"me-3"],["aria-hidden","true",1,"fa","fa-print","fa-lg","me-3","text-primary"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3," Sales Order (Entry)"),t.qZA()(),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return e.navigateTo("../form",{},"create")}),t._UZ(6,"i",5),t._uU(7," Generate Sales Order [SO] "),t.qZA()(),t._UZ(8,"hr",6),t.TgZ(9,"div",7)(10,"app-setting-header",8),t.NdJ("dataChange",function(i){return e.eventHeader(i)}),t.qZA(),t.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(15,"SO No."),t.qZA(),t.TgZ(16,"th",13),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(17,"SO Date"),t.qZA(),t.TgZ(18,"th",14),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(19,"Sales Category"),t.qZA(),t.TgZ(20,"th",15),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(21,"Customer Name"),t.qZA(),t.TgZ(22,"th",16),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(23,"Currency"),t.qZA(),t.TgZ(24,"th",17),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(25,"SO Value"),t.qZA(),t.TgZ(26,"th",18),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(27,"Status"),t.qZA(),t.TgZ(28,"th",19),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(29,"Action"),t.qZA()()(),t.TgZ(30,"tbody"),t.YNc(31,U,39,25,"tr",20),t.qZA()()()()),2&n&&(t.xp6(4),t.Q6J("accessType",e.rolePermissionActions.createAction),t.xp6(6),t.Q6J("data",t.l5B(4,x,e.page,e.pageSize,e.collection,e.search)),t.xp6(21),t.Q6J("ngForOf",e.tableData)("ngForTrackBy",e.trackByFn))},dependencies:[m.sg,C.P,O._L,g.j,Z.J],encapsulation:2}),l})();var a=c(60095),w=c(21631),F=c(22096),y=c(77203),v=c(43154),q=c(46634),M=c(45622),k=c(5382),B=c(24992),J=c(16897),P=c(50363),L=c(95346),Y=c(14906),I=c(83344),R=c(84231);function Q(s,l){if(1&s&&(t.TgZ(0,"option",64),t._uU(1),t.qZA()),2&s){const r=l.$implicit;t.Q6J("value",r.value),t.xp6(1),t.hij(" ",r.label," ")}}function E(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&s){const r=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==r?null:r.orderedQty,"1.2-2")," ")}}const D=function(){return{standalone:!0}};function K(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"input",74),t.NdJ("ngModelChange",function(e){t.CHM(r);const o=t.oxw().$implicit;return t.KtG(o.orderedQty=e)})("input",function(){t.CHM(r);const e=t.oxw().$implicit,o=t.oxw();return t.KtG(o.setLineValue(e))}),t.qZA()}if(2&s){const r=t.oxw().$implicit;t.Q6J("ngModel",r.orderedQty)("ngModelOptions",t.DdM(2,D))}}function V(s,l){if(1&s&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&s){const r=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,null==r?null:r.discount,"1.2-2")," ")}}function j(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"input",75),t.NdJ("ngModelChange",function(e){t.CHM(r);const o=t.oxw().$implicit;return t.KtG(o.discount=e)})("input",function(){t.CHM(r);const e=t.oxw().$implicit,o=t.oxw();return t.KtG(o.setNetRate(e))}),t.qZA()}if(2&s){const r=t.oxw().$implicit;t.Q6J("ngModel",r.discount)("ngModelOptions",t.DdM(2,D))}}const T=function(){return["approve","reject","view","generate","cancel"]};function G(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",65,66)(5,"span",67),t._uU(6),t.qZA()(),t.TgZ(7,"td",65,68)(9,"span",67),t._uU(10),t.qZA()(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"SalesUOMUnitMaster"),t.qZA(),t.TgZ(16,"td")(17,"div",56),t.YNc(18,E,3,4,"span",69),t.YNc(19,K,1,3,"input",70),t.qZA()(),t.TgZ(20,"td"),t._uU(21),t.ALo(22,"number"),t.qZA(),t.TgZ(23,"td")(24,"div",56),t.YNc(25,V,3,4,"span",69),t.YNc(26,j,1,3,"input",71),t.qZA()(),t.TgZ(27,"td"),t._uU(28),t.ALo(29,"number"),t.qZA(),t.TgZ(30,"td"),t._uU(31),t.ALo(32,"number"),t.qZA(),t.TgZ(33,"td")(34,"span",72),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.openSOScheduleModal(o))}),t._UZ(35,"div",73),t.qZA()()()}if(2&s){const r=l.$implicit,n=t.MAs(4),e=t.MAs(8),o=t.oxw();t.xp6(2),t.Oqu(null==r?null:r.SKUNo),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",r.SKUName),t.xp6(1),t.hij(" ",r.SKUName," "),t.xp6(1),t.Udp("width",e.clientWidth),t.xp6(2),t.Q6J("positionTarget",e)("ngbTooltip",r.SKUDescription),t.xp6(1),t.hij(" ",r.SKUDescription," "),t.xp6(2),t.Oqu(null==r?null:r.customerPartNo),t.xp6(2),t.Oqu(t.lcZ(15,20,null==r?null:r.UOM)),t.xp6(4),t.Q6J("ngIf",t.DdM(31,T).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(32,T).includes(o.action)),t.xp6(2),t.Oqu(t.xi3(22,22,null==r?null:r.standardRate,"1.2-2")),t.xp6(4),t.Q6J("ngIf",t.DdM(33,T).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(34,T).includes(o.action)),t.xp6(2),t.Oqu(t.xi3(29,25,null==r?null:r.netRate,"1.2-2")),t.xp6(3),t.Oqu(t.xi3(32,28,null==r?null:r.lineValue,"1.2-2"))}}function H(s,l){1&s&&(t.TgZ(0,"div",76)(1,"div",77)(2,"div",78),t._uU(3," Reason for Cancellation"),t.TgZ(4,"span",79),t._uU(5,"*"),t.qZA(),t.TgZ(6,"span"),t._uU(7,"\u25b6"),t.qZA()(),t._UZ(8,"input",80),t.qZA()())}function z(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"div",81)(1,"button",82),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.reset())}),t._uU(2,"Reset"),t.qZA(),t.TgZ(3,"button",83),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.ESCPreview())}),t._uU(4," Esc "),t.qZA(),t.TgZ(5,"button",84),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.preview())}),t._uU(6,"Preview"),t.qZA(),t.TgZ(7,"button",85),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.submit())}),t._uU(8," Save "),t.qZA()()}if(2&s){const r=t.oxw();t.xp6(3),t.Q6J("disabled",!r.isESCPreview),t.xp6(4),t.Q6J("disabled",!r.isPreview)}}function $(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"div",81)(1,"button",86),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.submit())}),t._uU(2,"Save"),t.qZA()()}}function X(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"div",87)(1,"button",86),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.openCancelModal())}),t._uU(2,"Cancel"),t.qZA()()}}function W(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"div",87)(1,"button",86),t.NdJ("click",function(){t.CHM(r);const e=t.oxw();return t.KtG(e.submit())}),t._uU(2,"Approve"),t.qZA()()}}const tt=function(s,l,r,n){return{page:s,pageSize:l,collection:r,search:n,excelDisplay:"none"}},et=function(){return["create"]},nt=function(){return["edit"]};let ot=(()=>{var s;class l{trackByFn(n,e){return e?._id}constructor(n,e,o,i,u,d,h,dt,mt,ht){this.activatedRoute=n,this.spinner=e,this.menuTitleService=o,this.toastService=i,this.salesService=u,this.validationService=d,this.modalService=h,this.utilityService=dt,this.storageService=mt,this.location=ht,this.page=1,this.pageSize=6,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.flag=-1,this.SODetailsArray=[],this.openPONumberArr=[],this.customerOptions=[],this.selectedCustomer={},this.displayName={},this.selectedCustomerDetails={},this.submitted=!1,this.popupResponse="No",this.isPreview=!1,this.action="create",this.statusArr={create:"Created",edit:"Created",approve:"Approved",cancel:"Cancelled"},this.otherCharges={action:"create",packagingAndForwarding:0,freight:0,insurance:0,loadingAndUnloading:0,miscellaneous:0,totalAmount:0},this.SOTypeObj=S.LT,this.SOTypeArr=S.LT.getAllSOType(),this.ESCPreviewArr=[],this.isESCPreview=!1,this.masterData={autoIncrementNo:"",billFromLocationOptions:[],freightTermsOptions:[],modeOfTransportOptions:[],paymentTermsOptions:[],salesCategoryOptions:[],transporterOptions:[],customerOptions:[],companyData:{_id:"",placesOfBusiness:[]}},this.form=new a.nJ({_id:new a.p4(null),salesCategory:new a.p4(null,[a.kI.required]),customer:new a.p4(null,[a.kI.required]),SONumber:new a.p4(null),SODate:new a.p4(""),billFromLocation:new a.p4(null,[a.kI.required]),PONumber:new a.p4(null,[a.kI.required]),PODate:new a.p4("",[a.kI.required]),quotationProformaRef:new a.p4(null),currency:new a.p4(null),SOFileName:new a.p4(null),SOTargetDate:new a.p4(""),SOTotalAmount:new a.p4(null,[a.kI.required]),SODetails:new a.p4([]),customerShippingAddress:new a.p4({}),customerBillingAddress:new a.p4({}),SORemarks:new a.p4(null),SOCancellationReason:new a.p4(null),SOType:new a.p4(this.SOTypeObj.Regular),isActive:new a.p4(!0),SOStatus:new a.p4("Created",[a.kI.required]),billFromAddress:new a.p4({}),billToAddress:new a.p4({}),paymentTerms:new a.p4(null),modeOfTransport:new a.p4(null),frightCharge:new a.p4(null),frightTerms:new a.p4(null),transporter:new a.p4(null),destination:new a.p4(null)})}ngOnInit(){this.displayName=this.storageService.get("menuTitle")?.title,this.getInitialData()}get f(){return this.form.controls}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.page=1,this.flag=-1;break;case"EXCEL":default:break;case"PAGE":this.page=n.value}}submit(){if(this.submitted=!0,this.isPreview=!1,this.form.enable(),"cancel"!=this.action&&this.validationService.checkErrors(this.form,v.tm))return;if("cancel"==this.action&&!this.form.controls.SOCancellationReason.value)return void this.toastService.warning("Reason for Cancellation is Required");let n=this.form.value;if(n.otherCharges=this.otherCharges,n.popupResponse=this.popupResponse,n.SOTargetDate=this.utilityService.getTodayDate("YYYY-MM-DD"),n.SODetails=this.SODetailsArray,n.SODetails=this.SODetailsArray?.map(e=>(e.discount=e.discount??0,e)),this.SOTypeObj.Planned!=this.f.SOType.value)for(const e of n.SODetails)if(!e.dispatchSchedule||0==e.dispatchSchedule.length){let o=1;for(let i=0;i<o;i++)e.dispatchSchedule=[{scheduleNo:i+1,quantity:e.orderedQty,UOM:e.UOM,dispatchDate:e.SOLineTargetDate,PPICDate:e.SOLineTargetDate}],e.dispatchCount=1}if("cancel"!=this.action)for(let e=0;e<v.tm.length;e++){const o=v.tm[e];if(o.key&&!n[o.key])return void this.toastService.warning(o.message)}if(this.SOTypeObj.Planned==this.f.SOType.value||this.SOTypeObj.Regular==this.f.SOType.value){if("create"==this.action&&!n.SODetails.some(o=>o.dispatchSchedule))return void this.toastService.warning("Dispatch Schedule is required");if("edit"==this.action&&!n.SODetails.some(o=>o.dispatchSchedule.length>0))return void this.toastService.warning("Dispatch Schedule is required")}n._id?this.update(n):(delete n._id,this.create(n))}update(n){this.spinner.show(),this.salesService.update(n._id,n).subscribe(e=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(e.message),this.location.back()})}create(n){this.spinner.show(),this.salesService.create(n).subscribe(e=>{this.submitted=!1,this.spinner.hide(),"Yes"==e.POExists?this.openConfirmSOModal():(this.toastService.success(e.message),this.location.back())})}reset(){this.form.reset(),this.SODetailsArray=[],this.customerOptions=[],this.collection=this.SODetailsArray.length,this.openPONumberArr=[],this.getInitialData()}getInitialData(){this.spinner.show(),this.salesService.getAllMasterData({}).subscribe(n=>{this.masterData=n,this.form.controls.SONumber.setValue(this.masterData?.autoIncrementNo),this.form.controls.isActive.setValue(!0),this.form.controls.SOType.setValue(this.SOTypeObj.Regular),this.f.PODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.f.SODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.SOStatus.setValue(this.statusArr[this.action]),this.activatedRoute.queryParams.pipe((0,w.z)(e=>(this.action=e.action,this.utilityService.accessDenied(this.action),e.id?this.salesService.getById(e.id):(0,F.of)({})))).subscribe(e=>{this.spinner.hide(),0!=Object.keys(e).length&&(e.SODate&&(e.SODate=this.utilityService.getFormatDate(e?.SODate,"YYYY-MM-DD")),e.customer=e.customer._id,this.customerOptions=this.masterData?.customerOptions.filter(o=>o.salesCategory==e.customerCategory),e.PODate&&(e.PODate=this.utilityService.getFormatDate(e?.PODate,"YYYY-MM-DD")),e.SOTargetDate&&(e.SOTargetDate=this.utilityService.getFormatDate(e?.SOTargetDate,"YYYY-MM-DD")),this.selectedCustomer=this.masterData?.customerOptions.find(o=>o._id==e.customer),this.SODetailsArray=e?.SODetails.map((o,i)=>({SOLineNumber:o.SOLineNumber,SKU:o?.SKU?._id,SKUNo:o?.SKU?.SKUNo,SKUName:o?.SKU?.SKUName,SKUDescription:o.SKU?.SKUDescription,customerPartNo:o?.customerPartNo,UOM:o?.UOM,dispatchSchedule:o?.dispatchSchedule,dispatchCount:o?.dispatchCount,orderedQty:o?.orderedQty,balancedQty:o?.orderedQty,JCCQty:o?.orderedQty,standardRate:o?.standardRate,discount:o?.discount,netRate:o?.netRate,lineValue:o?.lineValue,SOLineTargetDate:this.utilityService.getFormatDate(o?.SOLineTargetDate,"YYYY-MM-DD")})),this.collection=this.SODetailsArray.length,this.otherCharges=e.otherCharges,e.SOStatus=this.statusArr[this.action],this.form.patchValue(e),("edit"==this.action||"view"==this.action||"cancel"==this.action||"approve"==this.action)&&(this.form.disable(),this.form.controls.SOCancellationReason.enable()))}),this.menuTitleService.set({title:"cancel"==this.action?"Sales Order Cancellation":`${this.displayName}`,subTitle:null,type:null})})}openCancelModal(){const n=this.modalService.open(y.er,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.heading="SO Cancellation",n.componentInstance.cancelText="Do You Want to Cancel Sales Order ?",n.result.then(e=>{"Yes"==e&&this.submit()},e=>{})}openConfirmSOModal(){const n=this.modalService.open(y.er,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.heading="SO Confirmation",n.componentInstance.cancelText="SO already created against this PO. still you want to create new SO against same PO",n.result.then(e=>{"Yes"==e&&(this.popupResponse="Yes",this.submit())},e=>{})}setDelivery(){this.SODetailsArray=this.SODetailsArray.map(n=>(n.SOLineTargetDate=this.utilityService.getFormatDate(this.f.SOLineTargetDate.value,"YYYY-MM-DD"),n))}customerValueChange(n){this.form.controls.PONumber.setValue(null),this.form.controls.PODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.paymentTerms.setValue(n.customerPaymentTerms),this.f.currency.setValue(n?.customerCurrency),this.selectedCustomer=n,this.salesService.getAllSalesSKUList({customerId:n?._id}).subscribe(e=>{this.SODetailsArray=e.SKUList.map((o,i)=>(o.SOLineNumber=1,o)),this.collection=this.SODetailsArray.length,this.openPONumberArr=e?.PODetails})}openPONumber(){const n=this.modalService.open(q.n,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.customerId=this.form.controls.customer.value,n.componentInstance.openPONumberArr=this.openPONumberArr,n.result.then(e=>{e&&["create","edit"].includes(this.action)&&(this.SODetailsArray=e?.SODetailsArray.map((o,i)=>(o.SOLineNumber=i+1,o)),this.collection=this.SODetailsArray.length,this.openPONumberArr=e.openPONumberArr,this.form.controls.PONumber.setValue(e?.selectedData?.PONo),this.form.controls.PODate.setValue(this.utilityService.getFormatDate(e?.selectedData?.PODate,"YYYY-MM-DD")))},e=>{})}getCustomers(){this.f.customer.setValue(null),this.f.currency.setValue(null),this.selectedCustomerDetails={},this.SODetailsArray=[],this.customerOptions=this.masterData?.customerOptions.filter(n=>n.customerCategory==this.f.salesCategory.value)}setLineValue(n){let e=this.SODetailsArray.findIndex(o=>o.SOLineNumber==n.SOLineNumber&&o.SKU==n.SKU);if((this.SODetailsArray[e].lineValue=+n.orderedQty*+n.netRate).toFixed(2),(this.SODetailsArray[e].balancedQty=+n.orderedQty).toFixed(2),(this.SODetailsArray[e].JCCQty=+n.orderedQty).toFixed(2),this.f.SOTotalAmount.setValue(this.SODetailsArray.map(o=>o.lineValue).reduce((o,i)=>o+i,0).toFixed(2)),n.dispatchSchedule){let o=Math.floor(n.orderedQty/n.dispatchCount),i=n.orderedQty%n.dispatchCount;for(let u=0;u<n.dispatchCount;u++){let h=o;u===n.dispatchCount-1&&(h+=i),this.SODetailsArray[e].dispatchSchedule[u].quantity=h}}}setNetRate(n){let e=this.SODetailsArray.findIndex(o=>o.SOLineNumber==n.SOLineNumber&&o.SKU==n.SKU);this.SODetailsArray[e].netRate=n.standardRate-n.standardRate*(n.discount/100),this.SODetailsArray[e].lineValue=n.orderedQty*n.netRate,this.f.SOTotalAmount.setValue(this.SODetailsArray.map(o=>o.lineValue).reduce((o,i)=>o+i,0).toFixed(2))}ESCPreview(){this.search="",this.isPreview=!1,this.SODetailsArray=this.ESCPreviewArr,this.collection=this.SODetailsArray.length}preview(){this.search="",this.isESCPreview=!0,this.ESCPreviewArr=this.SODetailsArray,this.SODetailsArray=this.SODetailsArray.filter(n=>n.orderedQty>0),this.SODetailsArray.length?this.isPreview=!0:(this.toastService.warning("At least One Row is Required"),this.isPreview=!1),this.collection=this.SODetailsArray.length}onSort({column:n,direction:e}){this.headers.forEach(o=>{o.sortable!==n&&(o.direction="")}),this.SODetailsArray=""===e||""===n?this.SODetailsArray:[...this.SODetailsArray].sort((o,i)=>{let u="string"==typeof o[n]?o[n].toLowerCase():o[n],d="string"==typeof i[n]?i[n].toLowerCase():i[n];const h=u<d?-1:u>d?1:0;return"asc"===e?h:-h})}openSOScheduleModal(n){if(!this.form.controls.SOType.value)return void this.toastService.warning("PO Type is required !");const e=this.modalService.open(M.f,{centered:!0,windowClass:"custom-modal-sm",backdrop:"static",keyboard:!1});e.componentInstance.bookSalesOrder="Book Sales Order",e.componentInstance.SOType=this.form.controls.SOType.value,e.componentInstance.action=this.action,e.componentInstance.POQty=n.orderedQty,e.componentInstance.deliveryCount=n.dispatchCount,e.componentInstance.UOM=n.UOM,e.componentInstance.regularType=n,e.componentInstance.dispatchDate=this.utilityService.getFormatDate(n.SOLineTargetDate,"YYYY-MM-DD"),e.componentInstance.PPICDate=this.utilityService.getFormatDate(n.SOLineTargetDate,"YYYY-MM-DD"),n.dispatchSchedule&&(e.componentInstance.deliveryScheduleArr=n?.dispatchSchedule.map(o=>(o.dispatchDate=this.utilityService.getFormatDate(o.dispatchDate,"YYYY-MM-DD"),o.PPICDate=this.utilityService.getFormatDate(o.PPICDate,"YYYY-MM-DD"),o))),e.result.then(o=>{if(o&&["create","edit"].includes(this.action)){let i=this.SODetailsArray.findIndex(u=>u.SOLineNumber==n.SOLineNumber&&u.SKU==n.SKU);this.SODetailsArray[i].dispatchCount=o.deliveryCount,this.SODetailsArray[i].dispatchSchedule=o.deliverySchedule}},o=>{})}openSOTermsDetailsModal(){const n=this.modalService.open(k.y,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.SOTermsArr={transporterArr:this.masterData?.transporterOptions,freightTerms:this.masterData?.freightTermsOptions,modeOfTransport:this.masterData?.modeOfTransportOptions,paymentTermsArr:this.masterData?.paymentTermsOptions},n.componentInstance.SOTermsData={paymentTerms:this.form.controls.paymentTerms.value,modeOfTransport:this.form.controls.modeOfTransport.value,frightCharge:this.form.controls.frightCharge.value,frightTerms:this.form.controls.frightTerms.value,transporter:this.form.controls.transporter.value,destination:this.form.controls.destination.value,SORemarks:this.form.controls.SORemarks.value},n.componentInstance.billFromAddress=this.form.controls.billFromAddress.value,n.componentInstance.billToAddress=this.form.controls.billToAddress.value,n.componentInstance.billFromLocation=this.form.controls.billFromLocation.value,n.componentInstance.billFromCompanyData=this.masterData?.companyData,n.componentInstance.billFromLocationArr=this.masterData?.billFromLocationOptions,n.componentInstance.customerShippingAddress=this.form.controls.customerShippingAddress.value,n.componentInstance.customerBillingAddress=this.form.controls.customerBillingAddress.value,n.componentInstance.selectedCustomerData=this.selectedCustomer?.customerShippingAddress,n.componentInstance.selectedCustomerBillingData=this.selectedCustomer?.customerBillingAddress,n.componentInstance.otherCharges=this.otherCharges,n.result.then(e=>{e&&["create","edit"].includes(this.action)&&(this.form.patchValue(e?.SOTermsData),this.otherCharges=e?.SOTermsData?.otherCharges,this.form.controls.billFromAddress.patchValue(e?.billFromAddress),this.form.controls.billToAddress.patchValue(e?.billToAddress),this.form.controls.customerShippingAddress.patchValue(e?.customerShippingAddress),this.form.controls.customerBillingAddress.patchValue(e?.customerBillingAddress),this.form.controls.billFromLocation.setValue(e?.billFromLocation))},e=>{})}openSOTypeModal(){const n=this.modalService.open(B.Q,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.SOType=this.form.controls.SOType.value,n.result.then(e=>{e&&["create","edit"].includes(this.action)&&this.form.controls.SOType.setValue(e)},e=>{})}openCustomersDetailsModal(){const n=this.modalService.open(y.e7,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});n.componentInstance.action=this.action,n.componentInstance.selectedCustomerDetails=this.selectedCustomerDetails,n.componentInstance.customerOptions=this.customerOptions,n.componentInstance.customer=this.form.controls.customer.value,n.result.then(e=>{e&&(console.log("success",e),this.selectedCustomerDetails=e?.selectedCustomerDetails,this.form.controls.customer.setValue(e?.selectedCustomerDetails?._id),this.customerValueChange(this.selectedCustomerDetails))},e=>{})}}return(s=l).\u0275fac=function(n){return new(n||s)(t.Y36(_.gz),t.Y36(p.V),t.Y36(p.Uh),t.Y36(p.kl),t.Y36(b.VD),t.Y36(J.RJ),t.Y36(O.FF),t.Y36(p.tI),t.Y36(p.V1),t.Y36(m.Ye))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-bso-form"]],viewQuery:function(n,e){if(1&n&&t.Gf(g.j,5),2&n){let o;t.iGM(o=t.CRH())&&(e.headers=o)}},decls:122,vars:39,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading"],[1,""],[1,"form-body"],[1,"row","mb-2"],[1,"col-md-5"],[1,"row"],[1,"col-5"],[1,"form-label","mb-0"],[1,"text-danger"],["formControlName","salesCategory",1,"form-select",3,"change"],["selected","","disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"col-3","px-0"],["type","text","formControlName","SONumber","readonly","",1,"form-control"],[1,"col-4","pe-0"],["type","date","formControlName","SODate","readonly","",1,"form-control"],[1,"col-7"],[1,"col-4","pe-4"],[1,"d-flex","align-items-center"],[1,"col-11"],["bindLabel","customerName","bindValue","_id","formControlName","customer",3,"items","clearable","change"],["id","basic-addon1",1,"input-group-text","bg-primary","pointer","col-auto","fs-4",2,"height","2.9rem",3,"click"],["aria-hidden","true",1,"fa","fa-search","text-white"],[1,"col-3","pe-0"],[1,"form-label","mb-0","d-flex","justify-content-between"],["type","button",1,"btn","btn-primary","px-1","form-btn-sm","py-0",3,"click"],["type","text","formControlName","PONumber",1,"form-control"],[1,"col-3"],["type","date","formControlName","PODate",1,"form-control"],[1,"col-2","ps-0"],["type","text","formControlName","currency","readonly","",1,"form-control",3,"change"],[1,"row","line-border"],[3,"data","dataChange"],[1,"table-responsive","mt-0","text-wrap",2,"min-height","22rem"],[1,"table","table-bordered","mt-0","table-sm"],[1,"bg-info"],[1,"text-white"],["sortable","SKUNo",3,"sort"],["sortable","SKUName",1,"text-start",3,"sort"],["sortable","SKUDescription",1,"text-start",3,"sort"],["sortable","customerPartNo",3,"sort"],["sortable","UOM",3,"sort"],["sortable","orderedQty",3,"sort"],["sortable","standardRate",3,"sort"],["sortable","discount",3,"sort"],["sortable","netRate",3,"sort"],["sortable","lineValue",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"row","mb-3","align-items-center","mt-3"],[1,"col-md-auto"],[1,"plusIconSvg","btn","btn-primary","me-1"],["type","button",1,"btn","btn-primary","me-5","px-4",3,"click"],[1,"col-4","mt-1"],[1,"d-flex","justify-content-center"],[1,"col-form-label","text-nowrap","pe-2","pt-0"],["type","button",1,"btn","btn-info","py-1","ms-2"],["type","number","formControlName","SOTotalAmount","readonly","",1,"form-control"],["class","col px-0",4,"ngIf"],[1,"col-md-auto","ms-auto"],["class","d-grid gap-2 d-md-block",4,"ngIf"],["class","content-end",4,"ngIf"],[3,"value"],[1,"text-start"],["SKUName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],["SKUDescription",""],[4,"ngIf"],["type","number","class","form-control form-control-sm w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["type","number","class","form-control form-control-xs w-25",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],[1,"d-flex","justify-content-center","pointer",3,"click"],[1,"assetCalendarTD"],["type","number",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],["type","number",1,"form-control","form-control-xs","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],[1,"col","px-0"],[1,"d-flex","justify-content-center","align-items-center"],[1,"col-form-label","text-nowrap"],[1,"text-danger","me-2"],["type","text","formControlName","SOCancellationReason",1,"form-control","mx-2"],[1,"d-grid","gap-2","d-md-block"],["type","button",1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","me-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","px-4","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"disabled","click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"content-end"]],template:function(n,e){1&n&&(t.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),t._uU(5),t.ALo(6,"titlecase"),t.qZA()()(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8)(11,"div",9)(12,"label",10),t._uU(13," Customer Category "),t.TgZ(14,"span",11),t._uU(15,"*"),t.qZA()(),t.TgZ(16,"select",12),t.NdJ("change",function(){return e.getCustomers()}),t.TgZ(17,"option",13),t._uU(18,"Select"),t.qZA(),t.YNc(19,Q,2,2,"option",14),t.qZA()(),t.TgZ(20,"div",15)(21,"label",10),t._uU(22," SO No. "),t._UZ(23,"span",11),t.qZA(),t._UZ(24,"input",16),t.qZA(),t.TgZ(25,"div",17)(26,"label",10),t._uU(27," SO Date "),t._UZ(28,"span",11),t.qZA(),t._UZ(29,"input",18),t.qZA()()(),t.TgZ(30,"div",19)(31,"div",8)(32,"div",20)(33,"label",10),t._uU(34," Customer Name "),t.TgZ(35,"span",11),t._uU(36,"*"),t.qZA()(),t.TgZ(37,"div",21)(38,"div",22)(39,"ng-select",23),t.NdJ("change",function(i){return e.customerValueChange(i)}),t.qZA()(),t.TgZ(40,"div",24),t.NdJ("click",function(){return e.openCustomersDetailsModal()}),t._UZ(41,"i",25),t.qZA()()(),t.TgZ(42,"div",26)(43,"label",27),t._uU(44," PO No."),t.TgZ(45,"span",11),t._uU(46,"*"),t.qZA(),t._UZ(47,"span")(48,"span")(49,"span")(50,"span")(51,"span")(52,"span")(53,"span"),t.TgZ(54,"button",28),t.NdJ("click",function(){return e.openSOTypeModal()}),t._uU(55," PO Type "),t.qZA()(),t._UZ(56,"input",29),t.qZA(),t.TgZ(57,"div",30)(58,"label",10),t._uU(59," PO Date "),t.TgZ(60,"span",11),t._uU(61,"*"),t.qZA()(),t._UZ(62,"input",31),t.qZA(),t.TgZ(63,"div",32)(64,"label",10),t._uU(65," Currency "),t.qZA(),t.TgZ(66,"input",33),t.NdJ("change",function(){return e.setDelivery()}),t.qZA()()()()()(),t._UZ(67,"hr",34),t.TgZ(68,"div",4)(69,"app-setting-header",35),t.NdJ("dataChange",function(i){return e.eventHeader(i)}),t.qZA()(),t.TgZ(70,"div",36)(71,"table",37)(72,"thead",38)(73,"tr",39)(74,"th",40),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(75,"SKU Code"),t.qZA(),t.TgZ(76,"th",41),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(77),t.ALo(78,"labelTranslate"),t.qZA(),t.TgZ(79,"th",42),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(80),t.ALo(81,"labelTranslate"),t.qZA(),t.TgZ(82,"th",43),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(83,"Part No."),t.qZA(),t.TgZ(84,"th",44),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(85,"UoM"),t.qZA(),t.TgZ(86,"th",45),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(87,"SO Qty"),t.qZA(),t.TgZ(88,"th",46),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(89,"Rate/Unit"),t.qZA(),t.TgZ(90,"th",47),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(91,"Disc %"),t.qZA(),t.TgZ(92,"th",48),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(93,"Net Rate"),t.qZA(),t.TgZ(94,"th",49),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(95,"Line Value"),t.qZA(),t.TgZ(96,"th"),t._uU(97,"Disp."),t.qZA()()(),t.TgZ(98,"tbody"),t.YNc(99,G,36,35,"tr",50),t.ALo(100,"slice"),t.ALo(101,"searchFi1ter"),t.qZA()()(),t._UZ(102,"hr",34),t.TgZ(103,"div",51)(104,"div",52),t._UZ(105,"button",53),t.TgZ(106,"button",54),t.NdJ("click",function(){return e.openSOTermsDetailsModal()}),t._uU(107," SO Terms/Details "),t.qZA()(),t.TgZ(108,"div",55)(109,"div",56)(110,"div",57),t._uU(111," Net SO Value: "),t.TgZ(112,"button",58),t._uU(113),t.ALo(114,"companyCurrency"),t.qZA()(),t._UZ(115,"input",59),t.qZA()(),t.YNc(116,H,9,0,"div",60),t.TgZ(117,"div",61),t.YNc(118,z,9,2,"div",62),t.YNc(119,$,3,0,"div",62),t.YNc(120,X,3,0,"div",63),t.YNc(121,W,3,0,"div",63),t.qZA()()()()),2&n&&(t.Q6J("formGroup",e.form),t.xp6(5),t.hij("Sales Order (",t.lcZ(6,17,e.action),")"),t.xp6(12),t.Q6J("value",null),t.xp6(2),t.Q6J("ngForOf",null==e.masterData?null:e.masterData.salesCategoryOptions),t.xp6(20),t.Q6J("items",e.customerOptions)("clearable",!1),t.xp6(30),t.Q6J("data",t.l5B(32,tt,e.page,e.pageSize,e.collection,e.search)),t.xp6(8),t.hij(" ",t.lcZ(78,19,"SKU Name")," "),t.xp6(3),t.hij(" ",t.lcZ(81,21,"SKU Description")," "),t.xp6(19),t.Q6J("ngForOf",t.Dn7(100,23,t.xi3(101,27,e.SODetailsArray,e.search),(e.page-1)*e.pageSize,(e.page-1)*e.pageSize+e.pageSize))("ngForTrackBy",e.trackByFn),t.xp6(14),t.hij(" ",t.lcZ(114,30,"INR")," "),t.xp6(3),t.Q6J("ngIf","cancel"==e.action),t.xp6(2),t.Q6J("ngIf",t.DdM(37,et).includes(e.action)),t.xp6(1),t.Q6J("ngIf",t.DdM(38,nt).includes(e.action)),t.xp6(1),t.Q6J("ngIf","cancel"==e.action),t.xp6(1),t.Q6J("ngIf","approve"==e.action))},dependencies:[m.sg,m.O5,C.P,O._L,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.JL,a.sg,a.u,a.On,P.w9,g.j,m.OU,m.JJ,m.rS,L.G,Y.c,I.f,R.Q],styles:[".assetCalendarTD[_ngcontent-%COMP%]{background-color:transparent;background-image:url(Asset_Calendar.26a2ba3b333e16fe.svg);background-size:100% 100%;border:0;color:#fff;height:1.6rem;width:1.6rem}"]}),l})();function rt(s,l){if(1&s){const r=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",18,19)(11,"span",20),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td")(20,"div",21),t._UZ(21,"button",22),t.TgZ(22,"div",23)(23,"a",24),t.NdJ("click",function(){const o=t.CHM(r).$implicit,i=t.oxw();return t.KtG(i.navigateTo("/default/sales/transactions/book_sales_order/form",o,"cancel"))}),t._UZ(24,"i",25),t._uU(25," Cancel "),t.qZA()()()()()}if(2&s){const r=l.$implicit,n=t.MAs(10),e=t.oxw();t.xp6(2),t.Oqu(null==r?null:r.SONumber),t.xp6(2),t.Oqu(null==r?null:r.SODateS),t.xp6(2),t.Oqu(null==r?null:r.PONumber),t.xp6(2),t.Oqu(null==r?null:r.salesCategory),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",r.customerName),t.xp6(1),t.hij(" ",null==r?null:r.customerName," "),t.xp6(2),t.Oqu(null==r?null:r.currency),t.xp6(2),t.Oqu(null==r?null:r.SOTotalAmount),t.xp6(2),t.Oqu(null==r?null:r.SOStatus),t.xp6(5),t.Q6J("accessType",e.rolePermissionActions.approveAction)}}const it=function(s,l,r,n){return{page:s,pageSize:l,collection:r,search:n,type:"list"}},lt=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:N},{path:"cso-list",component:(()=>{var s;class l{constructor(n,e,o,i,u,d){this.exportExcelService=n,this.salesService=e,this.router=o,this.spinner=i,this.activatedRoute=u,this.exportToPDFService=d,this.page=1,this.pageSize=10,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Created","Approved","Report Generated"],this.rolePermissionActions=S.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(n,e,o){this.router.navigate([n],{queryParams:{id:e?._id,action:o}})}trackByFn(n,e){return e?._id}eventHeader(n){switch(n.key){case"SEARCH":this.search=n.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=n.value,this.getAll()}}getAll(n=!1,e=""){this.spinner.show();let o={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:n};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.salesService.getAll(o).subscribe(i=>{"EXCEL"==e?this.excelDownload(i.rows):"PDF"==e?this.pdfDownload(i.rows):(this.tableData=i.rows,this.collection=i.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(n){let e=(0,f.S$)(n);this.exportToPDFService.generatePdf(e.tableData,e.title)}excelDownload(n){this.exportExcelService.exportExcel((0,f.B6)(n))}onSort({column:n,direction:e}){this.headers.forEach(o=>{o.sortable!==n&&(o.direction="")}),this.column=n,this.direction="asc"==e?1:-1,this.getAll()}}return(s=l).\u0275fac=function(n){return new(n||s)(t.Y36(p.Ol),t.Y36(b.VD),t.Y36(_.F0),t.Y36(p.V),t.Y36(_.gz),t.Y36(p.$L))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-bso-list"]],viewQuery:function(n,e){if(1&n&&t.Gf(g.j,5),2&n){let o;t.iGM(o=t.CRH())&&(e.headers=o)}},decls:30,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered","table-sticky"],[1,"bg-primary"],[1,"text-white"],["sortable","SONumber",3,"sort"],["sortable","SODateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","salesCategory",3,"sort"],["sortable","customerName",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","SOTotalAmount",3,"sort"],["sortable","status",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["customerName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa","fa-times","fa-lg","me-2","text-primary"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Cancellation[SO] Summary"),t.qZA()(),t._UZ(4,"hr",3),t.TgZ(5,"div",4)(6,"app-setting-header",5),t.NdJ("dataChange",function(i){return e.eventHeader(i)}),t.qZA(),t.TgZ(7,"table",6)(8,"thead",7)(9,"tr",8)(10,"th",9),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(11,"SO No."),t.qZA(),t.TgZ(12,"th",10),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(13,"SO Date"),t.qZA(),t.TgZ(14,"th",11),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(15,"PO No."),t.qZA(),t.TgZ(16,"th",12),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(17,"Sales Category"),t.qZA(),t.TgZ(18,"th",13),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(19,"Customer Name"),t.qZA(),t.TgZ(20,"th",14),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(21,"Currency"),t.qZA(),t.TgZ(22,"th",15),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(23,"SO Value"),t.qZA(),t.TgZ(24,"th",15),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(25,"Status"),t.qZA(),t.TgZ(26,"th",16),t.NdJ("sort",function(i){return e.onSort(i)}),t._uU(27,"Action"),t.qZA()()(),t.TgZ(28,"tbody"),t.YNc(29,rt,26,13,"tr",17),t.qZA()()()()),2&n&&(t.xp6(6),t.Q6J("data",t.l5B(3,it,e.page,e.pageSize,e.collection,e.search)),t.xp6(23),t.Q6J("ngForOf",e.tableData)("ngForTrackBy",e.trackByFn))},dependencies:[m.sg,C.P,O._L,g.j,Z.J],encapsulation:2}),l})()},{path:"form",component:ot,resolve:{accessScreen:c(65876).x}}];let ct=(()=>{var s;class l{}return(s=l).\u0275fac=function(n){return new(n||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[_.Bz.forChild(lt),_.Bz]}),l})();var ut=c(56208);let pt=(()=>{var s;class l{}return(s=l).\u0275fac=function(n){return new(n||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[m.ez,ct,ut.m]}),l})()}}]);