"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[1637],{50120:(A,_,p)=>{p.r(_),p.d(_,{ServicePurchaseOrderModule:()=>ne});var c=p(96814),v=p(1076),h=p(43818),C=p(25116),Z=p(86514),e=p(65879),d=p(2742),g=p(48720),T=p(88059),b=p(37285),O=p(53421);function x(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td",20,21)(9,"span",22),e._uU(10),e.qZA()(),e.TgZ(11,"td"),e._uU(12),e.qZA(),e.TgZ(13,"td"),e._uU(14),e.qZA(),e.TgZ(15,"td"),e._uU(16),e.qZA(),e.TgZ(17,"td")(18,"div",23),e._UZ(19,"button",24),e.TgZ(20,"div",25)(21,"a",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",r,"view"))}),e._UZ(22,"i",27),e._uU(23," View "),e.qZA(),e.TgZ(24,"a",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",r,"edit"))}),e._UZ(25,"i",28),e._uU(26," Edit "),e.qZA(),e.TgZ(27,"a",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",r,"approve"))}),e._UZ(28,"i",29),e._uU(29," Approve "),e.qZA(),e.TgZ(30,"a",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,o=e.oxw();return e.KtG(o.navigateTo("../form",r,"reject"))}),e._UZ(31,"i",30),e._uU(32," Reject "),e.qZA(),e.TgZ(33,"a",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,o=e.oxw();return e.KtG(o.update(r,"Report Generated"))}),e._UZ(34,"img",31),e._uU(35," Generate Report "),e.qZA(),e.TgZ(36,"a",26),e.NdJ("click",function(){const r=e.CHM(n).$implicit,o=e.oxw();return e.KtG(o.navigateToPrint("/#/print/spo",r,"print","previewSPO"))}),e._UZ(37,"i",32),e._uU(38," Preview SPO "),e.qZA()()()()()}if(2&s){const n=l.$implicit,i=e.MAs(8),t=e.oxw();e.xp6(2),e.Oqu(null==n?null:n.SPONumber),e.xp6(2),e.Oqu(null==n?null:n.SPODateS),e.xp6(2),e.Oqu(null==n?null:n.purchaseCategory),e.xp6(1),e.Udp("width",i.clientWidth),e.xp6(2),e.Q6J("positionTarget",i)("ngbTooltip",n.supplier),e.xp6(1),e.hij(" ",n.supplier," "),e.xp6(2),e.Oqu(null==n?null:n.currency),e.xp6(2),e.Oqu(null==n?null:n.netSPOValue),e.xp6(2),e.Oqu(null==n?null:n.SPOStatus),e.xp6(5),e.Q6J("accessType",t.rolePermissionActions.viewAction),e.xp6(3),e.ekj("disable","Approved"===(null==n?null:n.SPOStatus)||"Rejected"===(null==n?null:n.SPOStatus)),e.Q6J("accessType",t.rolePermissionActions.editAction),e.xp6(3),e.ekj("disable","Approved"===(null==n?null:n.SPOStatus)||"Rejected"===(null==n?null:n.SPOStatus)),e.Q6J("accessType",t.rolePermissionActions.approveAction),e.xp6(3),e.ekj("disable","Approved"===(null==n?null:n.SPOStatus)||"Rejected"===(null==n?null:n.SPOStatus)),e.Q6J("accessType",t.rolePermissionActions.approveAction),e.xp6(3),e.ekj("disable","Awaiting Approval"===(null==n?null:n.SPOStatus)||"Rejected"===(null==n?null:n.SPOStatus)),e.Q6J("accessType",t.rolePermissionActions.generateReportAction),e.xp6(3),e.Q6J("accessType",t.rolePermissionActions.createAction)}}const P=function(s,l,n,i){return{page:s,pageSize:l,collection:n,search:i,type:"list"}};let D=(()=>{var s;class l{constructor(i,t,r,o,u,m,S){this.exportExcelService=i,this.servicePurchaseOrderService=t,this.toastService=r,this.spinner=o,this.activatedRoute=u,this.exportToPDFService=m,this.utilityService=S,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.rolePermissionActions=C.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(i,t,r){this.utilityService.navigateToForm({path:i,status:t.SPOStatus,action:r,id:t._id,activatedRoute:this.activatedRoute})}update(i,t){"Approved"===i?.SPOStatus&&(i.SPOStatus=t,i.supplier=i.supplier_id,this.spinner.show(),this.servicePurchaseOrderService.update(i._id,i).subscribe(r=>{this.toastService.success(r.message),this.getAll(),this.spinner.hide()}))}trackByFn(i,t){return t?._id}eventHeader(i){switch(i.key){case"SEARCH":this.search=i.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=i.value,this.getAll()}}getAll(i=!1,t=""){this.spinner.show();let r={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,excel:i};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.servicePurchaseOrderService.getAll(r).subscribe(o=>{"EXCEL"==t?this.excelDownload(o.rows):"PDF"==t?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}excelDownload(i){this.exportExcelService.exportExcel((0,Z.YZ)(i))}pdfDownload(i){let t=(0,Z.pU)(i);this.exportToPDFService.generatePdf(t.tableData,t.title)}navigateToPrint(i,t,r,o){window.open(`${window.location.origin}${i}?id=${t?._id}&action=${r}&preview=${o}`,"_blank")}onSort({column:i,direction:t}){this.headers.forEach(r=>{r.sortable!==i&&(r.direction="")}),this.column=i,this.direction="asc"==t?1:-1,this.getAll()}}return(s=l).\u0275fac=function(i){return new(i||s)(e.Y36(d.Ol),e.Y36(g.Uz),e.Y36(d.kl),e.Y36(d.V),e.Y36(v.gz),e.Y36(d.$L),e.Y36(d.tI))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-spo-list"]],viewQuery:function(i,t){if(1&i&&e.Gf(h.j,5),2&i){let r;e.iGM(r=e.CRH())&&(t.headers=r)}},decls:32,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],["type","button",1,"btn","btn-primary","btn-add",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","SPONumber",3,"sort"],["sortable","SPODateS",3,"sort"],["sortable","purchaseCategory",3,"sort"],["sortable","supplier",1,"text-start",3,"sort"],["sortable","currency",3,"sort"],["sortable","netSPOValue",3,"sort"],["sortable","SPOStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplier",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","me-2","text-success"],["aria-hidden","true",1,"fa","fa-close","me-2","text-primary"],["src"," ./assets/images/new.svg","width","14",1,"me-2"],["aria-hidden","true",1,"fa","fa-print","fa-lg","me-3","text-primary"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"label",2),e._uU(3,"Service Purchase Order[SPO] Summary"),e.qZA()(),e.TgZ(4,"div",3)(5,"button",4),e.NdJ("click",function(){return t.navigateTo("../form",{},"create")}),e._UZ(6,"i",5),e._uU(7," Service Purchase Order [SPO] "),e.qZA()(),e._UZ(8,"hr",6),e.TgZ(9,"div",7)(10,"app-setting-header",8),e.NdJ("dataChange",function(o){return t.eventHeader(o)}),e.qZA(),e.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(15,"SPO #"),e.qZA(),e.TgZ(16,"th",13),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(17,"SPO Date"),e.qZA(),e.TgZ(18,"th",14),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(19,"Purchase Category"),e.qZA(),e.TgZ(20,"th",15),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(21,"Supplier Name"),e.qZA(),e.TgZ(22,"th",16),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(23,"Currency"),e.qZA(),e.TgZ(24,"th",17),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(25,"SPO Value"),e.qZA(),e.TgZ(26,"th",18),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(27,"Status"),e.qZA(),e.TgZ(28,"th"),e._uU(29,"Action"),e.qZA()()(),e.TgZ(30,"tbody"),e.YNc(31,x,39,25,"tr",19),e.qZA()()()()),2&i&&(e.xp6(4),e.Q6J("accessType",t.rolePermissionActions.createAction),e.xp6(6),e.Q6J("data",e.l5B(4,P,t.page,t.pageSize,t.collection,t.search)),e.xp6(21),e.Q6J("ngForOf",t.tableData)("ngForTrackBy",t.trackByFn))},dependencies:[c.sg,T.P,b._L,h.j,O.J],encapsulation:2}),l})();var a=p(60095),w=p(21631),F=p(22096),M=p(66929),U=p(77203),q=p(16897),J=p(50363),N=p(95346),k=p(14906);function I(s,l){if(1&s&&(e.TgZ(0,"option",49),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n.value),e.xp6(1),e.hij(" ",n.label," ")}}function Y(s,l){if(1&s&&(e.TgZ(0,"option",49),e._uU(1),e.qZA()),2&s){const n=l.$implicit;e.Q6J("value",n.value),e.xp6(1),e.hij(" ",n.label," ")}}function Q(s,l){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"number"),e.qZA()),2&s){const n=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,n.SPOQty,"1.2-2")," ")}}const y=function(){return{standalone:!0}};function R(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"input",57),e.NdJ("ngModelChange",function(t){e.CHM(n);const r=e.oxw().$implicit;return e.KtG(r.SPOQty=t)})("ngModelChange",function(t){e.CHM(n);const r=e.oxw().index,o=e.oxw();return e.KtG(o.spoQtyChange(t,r))})("input",function(){e.CHM(n);const t=e.oxw().$implicit,r=e.oxw();return e.KtG(r.lineValueRate(t.SPOLineNumber,t))}),e.qZA()}if(2&s){const n=e.oxw().$implicit;e.Q6J("ngModel",n.SPOQty)("ngModelOptions",e.DdM(2,y))}}function L(s,l){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"number"),e.qZA()),2&s){const n=e.oxw().$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,n.purchaseRate,"1.2-2")," ")}}function V(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"input",57),e.NdJ("ngModelChange",function(t){e.CHM(n);const r=e.oxw().$implicit;return e.KtG(r.purchaseRate=t)})("ngModelChange",function(t){e.CHM(n);const r=e.oxw().index,o=e.oxw();return e.KtG(o.purchaseRateQtyChange(t,r))})("input",function(){e.CHM(n);const t=e.oxw().$implicit,r=e.oxw();return e.KtG(r.lineValueRate(t.SPOLineNumber,t))}),e.qZA()}if(2&s){const n=e.oxw().$implicit;e.Q6J("ngModel",n.purchaseRate)("ngModelOptions",e.DdM(2,y))}}function E(s,l){if(1&s&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&s){const n=e.oxw().$implicit;e.xp6(1),e.hij(" ",n.deliveryDate," ")}}function j(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"input",58),e.NdJ("ngModelChange",function(t){e.CHM(n);const r=e.oxw().$implicit;return e.KtG(r.deliveryDate=t)}),e.qZA()}if(2&s){const n=e.oxw().$implicit;e.Q6J("ngModel",n.deliveryDate)("ngModelOptions",e.DdM(2,y))}}const f=function(){return["approve","reject","view","generate"]};function G(s,l){if(1&s&&(e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td",50,51)(7,"span",52),e._uU(8),e.qZA()(),e.TgZ(9,"td")(10,"div",53),e.YNc(11,Q,3,4,"span",54),e.YNc(12,R,1,3,"input",55),e.qZA()(),e.TgZ(13,"td")(14,"div",53),e.YNc(15,L,3,4,"span",54),e.YNc(16,V,1,3,"input",55),e.qZA()(),e.TgZ(17,"td"),e._uU(18),e.ALo(19,"number"),e.qZA(),e.TgZ(20,"td")(21,"div",53),e.YNc(22,E,2,1,"span",54),e.YNc(23,j,1,3,"input",56),e.qZA()()()),2&s){const n=l.$implicit,i=l.index,t=e.MAs(6),r=e.oxw();e.xp6(2),e.Oqu(i+1+(r.page-1)*r.pageSize),e.xp6(2),e.Oqu(null==n?null:n.serviceCode),e.xp6(1),e.Udp("width",t.clientWidth),e.xp6(2),e.Q6J("positionTarget",t)("ngbTooltip",n.serviceDescription),e.xp6(1),e.hij(" ",n.serviceDescription," "),e.xp6(3),e.Q6J("ngIf",e.DdM(17,f).includes(r.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(18,f).includes(r.action)),e.xp6(3),e.Q6J("ngIf",e.DdM(19,f).includes(r.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(20,f).includes(r.action)),e.xp6(2),e.Oqu(e.xi3(19,14,null==n?null:n.lineValue,"1.2-2")),e.xp6(4),e.Q6J("ngIf",e.DdM(21,f).includes(r.action)),e.xp6(1),e.Q6J("ngIf",!e.DdM(22,f).includes(r.action))}}function H(s,l){1&s&&(e.TgZ(0,"div",59)(1,"div",41)(2,"span",42),e._uU(3," SPO Remarks"),e.qZA(),e._UZ(4,"input",60),e.qZA()())}function $(s,l){1&s&&(e.TgZ(0,"div",59)(1,"div",41)(2,"span",42),e._uU(3,"Remarks"),e.qZA(),e._UZ(4,"input",61),e.qZA()())}function z(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"div",62)(1,"button",63),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.reset())}),e._uU(2,"Reset"),e.qZA(),e.TgZ(3,"button",64),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.ESCPreview())}),e._uU(4," Esc "),e.qZA(),e.TgZ(5,"button",65),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.preview())}),e._uU(6,"Preview"),e.qZA(),e.TgZ(7,"button",66),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.submit())}),e._uU(8," Save "),e.qZA()()}if(2&s){const n=e.oxw();e.xp6(3),e.Q6J("disabled",!n.isESCPreview),e.xp6(4),e.Q6J("disabled",!n.isPreview)}}function K(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"div",67)(1,"button",68),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.submit())}),e._uU(2,"Reject"),e.qZA()()}}function B(s,l){if(1&s){const n=e.EpF();e.TgZ(0,"div",45)(1,"button",68),e.NdJ("click",function(){e.CHM(n);const t=e.oxw();return e.KtG(t.submit())}),e._uU(2,"Approve"),e.qZA()()}}const X=function(s,l,n,i){return{page:s,pageSize:l,collection:n,search:i,excelDisplay:"none"}},W=function(){return["create","edit"]};let ee=(()=>{var s;class l{get f(){return this.form.controls}constructor(i,t,r,o,u,m,S,oe){this.SPOService=i,this.toastService=t,this.activatedRoute=r,this.spinner=o,this.validationService=u,this.utilityService=m,this.modalService=S,this.location=oe,this.page=1,this.pageSize=5,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.ESCPreviewArr=[],this.isESCPreview=!1,this.submitted=!1,this.isPreview=!1,this.action="create",this.supplierOptions=[],this.filterItems=[],this.SPODetailsArray=[],this.selectedSupplierDetails={},this.statusArr={create:"Awaiting Approval",edit:"Awaiting Approval",approve:"Approved",reject:"Rejected"},this.masterData={autoIncrementNo:"",purchaseCategories:[],locationOptions:[],serviceMasters:[],suppliersOptions:[]},this.form=new a.nJ({_id:new a.p4(null),purchaseCategory:new a.p4(null,[a.kI.required]),supplier:new a.p4(null,[a.kI.required]),SPONumber:new a.p4(null,[a.kI.required]),SPODate:new a.p4(null,[a.kI.required]),orderReference:new a.p4(null,[a.kI.required]),currency:new a.p4(null,[a.kI.required]),deliveryLocation:new a.p4(null,[a.kI.required]),deliveryDate:new a.p4(null,[a.kI.required]),SPODetails:new a.p4([]),remarks:new a.p4(null),SPORemarks:new a.p4(null),netSPOValue:new a.p4(null),totalPPV:new a.p4(null),isActive:new a.p4("Y",[a.kI.required]),SPOStatus:new a.p4(null,[a.kI.required])})}ngOnInit(){this.getInitialData()}submit(){if(this.submitted=!0,this.validationService.checkErrors(this.form,M.jd))return;this.form.enable();let i=this.form.value;i.SPODetails=this.filterItems,i._id?this.update(i):(delete i._id,this.create(i))}reset(){this.form.reset(),this.supplierOptions=[],this.filterItems=[],this.collection=this.filterItems.length,this.getInitialData()}update(i){this.spinner.show(),this.SPOService.update(i._id,i).subscribe(t=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(t.message),this.location.back()})}create(i){this.spinner.show(),this.SPOService.create(i).subscribe(t=>{this.submitted=!1,this.spinner.hide(),this.toastService.success(t.message),this.location.back()})}getInitialData(){this.spinner.show(),this.SPOService.getAllMasterData({}).subscribe(i=>{this.masterData=i,this.form.controls.SPONumber.setValue(this.masterData?.autoIncrementNo),this.form.controls.isActive.setValue("Y"),this.form.controls.SPODate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.deliveryDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.SPOStatus.setValue(this.statusArr[this.action]),this.activatedRoute.queryParams.pipe((0,w.z)(t=>(this.action=t.action,this.utilityService.accessDenied(this.action),t.id?this.SPOService.getById(t.id):(0,F.of)({})))).subscribe(t=>{this.spinner.hide(),0!=Object.keys(t).length&&(t.SPODate&&(t.SPODate=this.utilityService.getFormatDate(t.SPODate,"YYYY-MM-DD")),this.supplierOptions=this.masterData?.suppliersOptions.filter(r=>r.supplierPurchaseType==t.purchaseCategory),t.supplier._id&&(t.supplier=t?.supplier?._id),t.deliveryDate&&(t.deliveryDate=this.utilityService.getFormatDate(t.deliveryDate,"YYYY-MM-DD")),this.filterItems=t.SPODetails.map((r,o)=>({serviceMaster:r?.serviceMaster?._id,SPOLineNumber:r?.SPOLineNumber,serviceCode:r?.serviceCode,serviceDescription:r?.serviceDescription,SPOQty:r?.SPOQty,purchaseRate:r?.purchaseRate,lineValue:r?.lineValue,deliveryDate:this.utilityService.getFormatDate(r.deliveryDate,"YYYY-MM-DD"),gst:r.gst,igst:r.igst,cgst:r.cgst,sgst:r.sgst,ugst:r.ugst})),this.collection=this.filterItems.length,t.SPOStatus=this.statusArr[this.action],this.form.patchValue(t),this.f.purchaseCategory.disable(),this.f.supplier.disable(),"edit"!=this.action&&(this.form.disable(),["approve","reject"].includes(this.action)&&this.f.remarks.enable(),this.f.SPOStatus.enable()))})})}eventHeader(i){switch(i.key){case"SEARCH":this.search=i.value,this.page=1;break;case"EXCEL":break;case"PAGE":this.page=i.value}}trackByFn(i,t){return t?._id}getSuppliers(){this.f.supplier.setValue(null),this.f.currency.setValue(null),this.selectedSupplierDetails={},this.supplierOptions=this.masterData?.suppliersOptions.filter(i=>i.supplierPurchaseType==this.f.purchaseCategory.value),this.filterItems=[]}supplierValueChange(i){this.f.currency.setValue(i.supplierCurrency),this.filterItems=this.masterData?.serviceMasters?.map((t,r)=>({serviceMaster:t._id,SPOLineNumber:r+1,serviceCode:t.serviceCode,serviceDescription:t.serviceDescription,SPOQty:0,purchaseRate:t.purchaseRate,lineValue:0,deliveryDate:this.utilityService.getFormatDate(this.f.deliveryDate.value,"YYYY-MM-DD"),gst:t.gst,igst:t.igst,cgst:t.cgst,sgst:t.sgst,ugst:t.ugst})),this.collection=this.filterItems.length}preview(){this.isESCPreview=!0,this.ESCPreviewArr=this.filterItems,this.search="",this.filterItems=this.filterItems.filter(t=>t.SPOQty>0);let i=this.filterItems.map(t=>+t.lineValue).reduce((t,r)=>+t+ +r,0);this.f.netSPOValue.setValue(+i.toFixed(2)),this.filterItems.length>0?this.isPreview=!0:(this.toastService.warning("At least One Row is Required"),this.isPreview=!1),this.collection=this.filterItems.length}ESCPreview(){this.search="",this.isPreview=!1,this.filterItems=this.ESCPreviewArr,this.collection=this.filterItems.length}lineValueRate(i,t){let r=this.filterItems.map(u=>u.SPOLineNumber).indexOf(i);this.filterItems[r].lineValue=+(+t.SPOQty*+t.purchaseRate).toFixed(2);let o=this.filterItems.map(u=>+u.lineValue).reduce((u,m)=>+u+ +m,0);this.f.netSPOValue.setValue(+o.toFixed(2))}spoQtyChange(i,t){this.filterItems[t].SPOQty=Math.abs(i)}purchaseRateQtyChange(i,t){this.filterItems[t].purchaseRate=Math.abs(i)}setDeliveryDate(){this.filterItems=this.filterItems.map(r=>(r.deliveryDate=this.utilityService.getFormatDate(this.f.deliveryDate.value,"YYYY-MM-DD"),r)),this.form.controls.SPODate.value>this.form.controls.deliveryDate.value&&(this.toastService.warning("Please Take Proper Date !"),this.form.controls.deliveryDate.reset())}onSort({column:i,direction:t}){this.headers.forEach(r=>{r.sortable!==i&&(r.direction="")}),this.filterItems=""===t||""===i?this.filterItems:[...this.filterItems].sort((r,o)=>{let u="string"==typeof r[i]?r[i].toLowerCase():r[i],m="string"==typeof o[i]?o[i].toLowerCase():o[i];const S=u<m?-1:u>m?1:0;return"asc"===t?S:-S})}openSupplierDetailsModal(){const i=this.modalService.open(U.Nx,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});i.componentInstance.action=this.action,i.componentInstance.selectedSupplierDetails=this.selectedSupplierDetails,i.componentInstance.supplierOptions=this.supplierOptions,i.componentInstance.supplier=this.form.controls.supplier.value,i.result.then(t=>{t&&(this.selectedSupplierDetails=t?.selectedSupplierDetails,this.form.controls.supplier.setValue(t?.selectedSupplierDetails?._id),this.supplierValueChange(this.selectedSupplierDetails))},t=>{})}}return(s=l).\u0275fac=function(i){return new(i||s)(e.Y36(g.Uz),e.Y36(d.kl),e.Y36(v.gz),e.Y36(d.V),e.Y36(q.RJ),e.Y36(d.tI),e.Y36(b.FF),e.Y36(c.Ye))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-spo-form"]],viewQuery:function(i,t){if(1&i&&e.Gf(h.j,5),2&i){let r;e.iGM(r=e.CRH())&&(t.headers=r)}},decls:105,vars:34,consts:[[1,"formCard","card",3,"formGroup"],[1,"set-remaining-margin"],[1,"row","form-header"],[1,"col","heading"],[1,"form-body"],[1,"row"],[1,"col-md-3"],[1,"form-label"],[1,"text-danger"],["formControlName","purchaseCategory",1,"form-select",3,"change"],["disabled","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"col-md-3","pe-5"],[1,"d-flex","align-items-center"],[1,"col-11"],["bindLabel","label","bindValue","value","formControlName","supplier","placeholder","Select a Supplier",3,"items","clearable","change"],["id","basic-addon1",1,"input-group-text","bg-primary","pointer","col-auto","fs-4",2,"height","2.9rem",3,"click"],["aria-hidden","true",1,"fa","fa-search","text-white"],["readonly","","type","text","formControlName","SPONumber",1,"form-control"],["type","date","formControlName","SPODate",1,"form-control"],["type","text","formControlName","orderReference",1,"form-control"],[1,"text-primary"],["type","text","readonly","","formControlName","currency",1,"form-control"],["formControlName","deliveryLocation",1,"form-select"],["type","date","formControlName","deliveryDate",1,"form-control",3,"change"],[1,"row","line-border"],[3,"data","dataChange"],[1,"table-responsive",2,"min-height","18.6rem"],[1,"table","table-bordered","table-sticky"],[1,"bg-primary"],[1,"text-white"],["sortable","SPOLineNumber",3,"sort"],["sortable","serviceCode",3,"sort"],["sortable","serviceDescription",1,"text-start",3,"sort"],["sortable","SPOQty",3,"sort"],["sortable","purchaseRate",3,"sort"],["sortable","lineValue",3,"sort"],["sortable","deliveryDate",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"row","line-border","mt-3"],[1,"row","footer-div"],[1,"d-flex","inputGroup"],["id","Remarks_Field-2",1,"input-group-text"],["type","text","readOnly","","formControlName","netSPOValue",1,"form-control"],["class","col-md-4",4,"ngIf"],[1,"col-5","d-flex","justify-content-end"],["class","d-grid gap-2 d-md-block",4,"ngIf"],["class","col-5 text-end",4,"ngIf"],["class","col-5 d-flex justify-content-end",4,"ngIf"],[3,"value"],[1,"text-start"],["serviceDescription",""],[1,"pointer",3,"positionTarget","ngbTooltip"],[1,"d-flex","justify-content-center"],[4,"ngIf"],["class","form-control form-control-sm w-25","type","number",3,"ngModel","ngModelOptions","ngModelChange","input",4,"ngIf"],["class","form-control form-control-sm w-25","type","date",3,"ngModel","ngModelOptions","ngModelChange",4,"ngIf"],["type","number",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","ngModelChange","input"],["type","date",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","ngModelChange"],[1,"col-md-4"],["id","SPORemarks","type","text","name","SPORemarks","formControlName","SPORemarks",1,"form-control"],["type","text","formControlName","remarks",1,"form-control"],[1,"d-grid","gap-2","d-md-block"],["type","button",1,"btn","btn-primary","px-5","me-3",3,"click"],["type","button",1,"btn","btn-primary","me-1",3,"disabled","click"],["type","button",1,"btn","btn-primary","me-3",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"disabled","click"],[1,"col-5","text-end"],["type","button",1,"btn","btn-primary","px-5",3,"click"]],template:function(i,t){1&i&&(e.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4),e.ALo(5,"titlecase"),e.qZA()(),e.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),e._uU(10,"Purchase Category"),e.TgZ(11,"span",8),e._uU(12,"*"),e.qZA()(),e.TgZ(13,"select",9),e.NdJ("change",function(){return t.getSuppliers()}),e.TgZ(14,"option",10),e._uU(15,"Select"),e.qZA(),e.YNc(16,I,2,2,"option",11),e.qZA()(),e.TgZ(17,"div",12)(18,"label",7),e._uU(19,"Supplier Name"),e.TgZ(20,"span",8),e._uU(21,"*"),e.qZA()(),e.TgZ(22,"div",13)(23,"div",14)(24,"ng-select",15),e.NdJ("change",function(o){return t.supplierValueChange(o)}),e.qZA()(),e.TgZ(25,"div",16),e.NdJ("click",function(){return t.openSupplierDetailsModal()}),e._UZ(26,"i",17),e.qZA()()(),e.TgZ(27,"div",6)(28,"label",7),e._uU(29,"Service Purchase Order #"),e.TgZ(30,"span",8),e._uU(31,"*"),e.qZA()(),e._UZ(32,"input",18),e.qZA(),e.TgZ(33,"div",6)(34,"label",7),e._uU(35,"Service Purchase Order Date"),e.TgZ(36,"span",8),e._uU(37,"*"),e.qZA()(),e._UZ(38,"input",19),e.qZA()(),e.TgZ(39,"div",5)(40,"div",6)(41,"label",7),e._uU(42,"Order Reference "),e.TgZ(43,"span",8),e._uU(44,"*"),e.qZA()(),e._UZ(45,"input",20),e.qZA(),e.TgZ(46,"div",6)(47,"label",7),e._uU(48,"Currency"),e.TgZ(49,"span",21),e._uU(50,"*"),e.qZA()(),e._UZ(51,"input",22),e.qZA(),e.TgZ(52,"div",6)(53,"label",7),e._uU(54),e.ALo(55,"labelTranslate"),e.TgZ(56,"span",8),e._uU(57,"*"),e.qZA()(),e.TgZ(58,"select",23)(59,"option",10),e._uU(60,"Select Location"),e.qZA(),e.YNc(61,Y,2,2,"option",11),e.qZA()(),e.TgZ(62,"div",6)(63,"label",7),e._uU(64,"Delivery Date"),e.TgZ(65,"span",8),e._uU(66,"*"),e.qZA()(),e.TgZ(67,"input",24),e.NdJ("change",function(){return t.setDeliveryDate()}),e.qZA()()()(),e._UZ(68,"hr",25),e.TgZ(69,"app-setting-header",26),e.NdJ("dataChange",function(o){return t.eventHeader(o)}),e.qZA(),e.TgZ(70,"div",27)(71,"table",28)(72,"thead",29)(73,"tr",30)(74,"th",31),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(75,"#"),e.qZA(),e.TgZ(76,"th",32),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(77,"Service Code"),e.qZA(),e.TgZ(78,"th",33),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(79," Service Description "),e.qZA(),e.TgZ(80,"th",34),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(81,"SPO Qty"),e.qZA(),e.TgZ(82,"th",35),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(83,"Purchase Rate"),e.qZA(),e.TgZ(84,"th",36),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(85,"Line Value"),e.qZA(),e.TgZ(86,"th",37),e.NdJ("sort",function(o){return t.onSort(o)}),e._uU(87,"Delivery Date"),e.qZA()()(),e.TgZ(88,"tbody"),e.YNc(89,G,24,23,"tr",38),e.ALo(90,"slice"),e.ALo(91,"searchFi1ter"),e.qZA()()(),e._UZ(92,"hr",39),e.TgZ(93,"div",40)(94,"div",6)(95,"div",41)(96,"span",42),e._uU(97,"Net SPO Value"),e.qZA(),e._UZ(98,"input",43),e.qZA()(),e.YNc(99,H,5,0,"div",44),e.YNc(100,$,5,0,"div",44),e.TgZ(101,"div",45),e.YNc(102,z,9,2,"div",46),e.YNc(103,K,3,0,"div",47),e.YNc(104,B,3,0,"div",48),e.qZA()()()()),2&i&&(e.Q6J("formGroup",t.form),e.xp6(4),e.hij("Generate SPO [",e.lcZ(5,17,t.action),"]"),e.xp6(10),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",null==t.masterData?null:t.masterData.purchaseCategories),e.xp6(8),e.Q6J("items",t.supplierOptions)("clearable",!1),e.xp6(30),e.Oqu(e.lcZ(55,19,"Delivery Location")),e.xp6(5),e.Q6J("value",null),e.xp6(2),e.Q6J("ngForOf",null==t.masterData?null:t.masterData.locationOptions),e.xp6(8),e.Q6J("data",e.l5B(28,X,t.page,t.pageSize,t.collection,t.search)),e.xp6(20),e.Q6J("ngForOf",e.Dn7(90,21,e.xi3(91,25,t.filterItems,t.search),(t.page-1)*t.pageSize,(t.page-1)*t.pageSize+t.pageSize))("ngForTrackBy",t.trackByFn),e.xp6(10),e.Q6J("ngIf","approve"!=t.action),e.xp6(1),e.Q6J("ngIf","approve"==t.action),e.xp6(2),e.Q6J("ngIf",e.DdM(33,W).includes(t.action)),e.xp6(1),e.Q6J("ngIf","reject"==t.action),e.xp6(1),e.Q6J("ngIf","approve"==t.action))},dependencies:[c.sg,c.O5,T.P,b._L,a.YN,a.Kr,a.Fj,a.wV,a.EJ,a.JJ,a.JL,a.sg,a.u,a.On,J.w9,h.j,c.OU,c.JJ,c.rS,N.G,k.c],encapsulation:2}),l})();var te=p(56208);const re=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:D},{path:"form",component:ee,resolve:{accessScreen:p(65876).x}}];let ne=(()=>{var s;class l{}return(s=l).\u0275fac=function(i){return new(i||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[c.ez,v.Bz.forChild(re),te.m]}),l})()},13107:(A,_,p)=>{p.d(_,{t:()=>c});const c={width:24,style:{alignment:{vertical:"middle",horizontal:"center",wrapText:!0}}}},28402:(A,_,p)=>{p.d(_,{J:()=>c});const c=({data:v,headers:h,widths:C,title:Z})=>({tableData:{widths:C,headerRows:1,body:[h.map(g=>({text:g.header,style:"header"})),...v.map(g=>h.map(T=>({style:"subheader",text:g[T.key]})))]},title:Z})}}]);