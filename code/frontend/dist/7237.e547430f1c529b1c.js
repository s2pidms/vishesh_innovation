"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[7237],{27237:(ft,T,l)=>{l.r(T),l.d(T,{GRNModule:()=>_t});var u=l(96814),h=l(1076),s=l(60095),R=l(21631),x=l(22096),_=l(43818),U=l(63375),t=l(65879),g=l(37285),A=l(50363);let G=(()=>{class a{get f(){return this.form.controls}constructor(e){this.activeModal=e,this.action="",this.receivedDocuments={},this.transporterArr=[],this.form=new s.nJ({goodsDeliveryDate:new s.p4(null),transporterName:new s.p4(null),AWB_LR_BR:new s.p4(null),freightChargesPaid:new s.p4(null),otherChargesPaid:new s.p4(null),isTaxInvoice:new s.p4(null),isEWayBill:new s.p4(null),isDeliveryChallan:new s.p4(null),isPackingList:new s.p4(null),isCOATC:new s.p4(null)})}ngOnInit(){this.form.patchValue(this.receivedDocuments),["view","cancel"].includes(this.action)&&this.form.disable()}dismissModel(){this.activeModal.close(this.form.value)}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(g.Kz))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-addtional-info-modal"]],inputs:{action:"action",receivedDocuments:"receivedDocuments",transporterArr:"transporterArr"},decls:106,vars:3,consts:[[3,"formGroup"],[1,"modelPage"],[1,"modal-header"],[1,"heading"],["type","button","aria-label","Close",1,"btn","btn-cross","btn-sm",3,"click"],["aria-hidden","true",1,"fa","fa-times-circle"],[1,"container-fluid","px-0"],[1,"row","px-5"],[1,"col-7","mt-4","pe-0"],[1,"text-primary","mb-0"],[1,""],["src","./assets/new_icons/transport_ul_1px.svg","alt","","width","132","height","6"],[1,"row","mt-4"],[1,"col-4","mt-1","pe-0"],[1,"form-label","text-nowrap"],[1,"col-auto","ps-4","pe-0"],[1,"fa","fa-caret-right","mt-1","text-primary"],[1,"col-6","ps-0"],["type","date","formControlName","goodsDeliveryDate",1,"form-control"],[1,"col-4","pe-0"],[1,"form-label"],[1,"fa","fa-caret-right","text-primary"],["bindLabel","label","bindValue","value","formControlName","transporterName",3,"items","clearable"],["type","text","formControlName","AWB_LR_BR",1,"form-control"],["type","number","formControlName","freightChargesPaid",1,"form-control"],["type","number","formControlName","otherChargesPaid",1,"form-control"],[1,"col-1","separator","text-center"],["src","./assets/new_icons/separator_1px.svg","width","8","height","260","alt",""],[1,"col-4","mt-4","p-0"],["src","./assets/new_icons/transport_ul_1px.svg","alt","","width","151","height","6"],[1,"col-4","text-start"],[1,"col-auto","ps-5","pe-0"],[1,"fa","fa-caret-right","text-primary","ps-5","pe-0"],[1,"col","text-start","ps-0"],["formControlName","isTaxInvoice","type","checkbox",1,"form-check-input","pointer","ps-0"],[1,"row","margin"],[1,"col-4","text-start","pe-0"],["formControlName","isEWayBill","type","checkbox",1,"form-check-input","pointer"],["formControlName","isDeliveryChallan","type","checkbox",1,"form-check-input","pointer"],["formControlName","isPackingList","type","checkbox",1,"form-check-input","pointer"],["formControlName","isCOATC","type","checkbox",1,"form-check-input","pointer"],[1,"line-border","my-5","px-5"],[1,"text-center"],["type","button",1,"btn","bg-primary","px-5","mb-5",3,"click"]],template:function(i,n){1&i&&(t.TgZ(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4,"Addional Information"),t.qZA(),t.TgZ(5,"div")(6,"button",4),t.NdJ("click",function(){return n.dismissModel()}),t._UZ(7,"i",5),t.qZA()()(),t.TgZ(8,"div",6)(9,"div",7)(10,"div",8)(11,"h4",9),t._uU(12,"Transport Details"),t.qZA(),t.TgZ(13,"span",10),t._UZ(14,"img",11),t.qZA(),t.TgZ(15,"div",12)(16,"div",13)(17,"label",14),t._uU(18,"Goods Delivery Date"),t.qZA()(),t.TgZ(19,"div",15),t._UZ(20,"i",16),t.qZA(),t.TgZ(21,"div",17),t._UZ(22,"input",18),t.qZA()(),t.TgZ(23,"div",12)(24,"div",19)(25,"label",20),t._uU(26,"Transporter Name"),t.qZA()(),t.TgZ(27,"div",15),t._UZ(28,"i",21),t.qZA(),t.TgZ(29,"div",17),t._UZ(30,"ng-select",22),t.qZA()(),t.TgZ(31,"div",12)(32,"div",19)(33,"label",20),t._uU(34,"Docket/AWB No."),t.qZA()(),t.TgZ(35,"div",15),t._UZ(36,"i",21),t.qZA(),t.TgZ(37,"div",17),t._UZ(38,"input",23),t.qZA()(),t.TgZ(39,"div",12)(40,"div",19)(41,"label",14),t._uU(42,"Freight Charges Paid"),t.qZA()(),t.TgZ(43,"div",15),t._UZ(44,"i",21),t.qZA(),t.TgZ(45,"div",17),t._UZ(46,"input",24),t.qZA()(),t.TgZ(47,"div",12)(48,"div",19)(49,"label",14),t._uU(50,"Other Charges Paid"),t.qZA()(),t.TgZ(51,"div",15),t._UZ(52,"i",21),t.qZA(),t.TgZ(53,"div",17),t._UZ(54,"input",25),t.qZA()()(),t.TgZ(55,"div",26),t._UZ(56,"img",27),t.qZA(),t.TgZ(57,"div",28)(58,"h4",9),t._uU(59,"Document Checklist"),t.qZA(),t.TgZ(60,"span",10),t._UZ(61,"img",29),t.qZA(),t.TgZ(62,"div",12)(63,"div",30)(64,"label",14),t._uU(65,"Tax Invoice"),t.qZA()(),t.TgZ(66,"div",31),t._UZ(67,"i",32),t.qZA(),t.TgZ(68,"div",33),t._UZ(69,"input",34),t.qZA()(),t.TgZ(70,"div",35)(71,"div",36)(72,"label",14),t._uU(73,"E-way Bill"),t.qZA()(),t.TgZ(74,"div",31),t._UZ(75,"i",32),t.qZA(),t.TgZ(76,"div",33),t._UZ(77,"input",37),t.qZA()(),t.TgZ(78,"div",35)(79,"div",30)(80,"label",14),t._uU(81,"Delivery Challan"),t.qZA()(),t.TgZ(82,"div",31),t._UZ(83,"i",32),t.qZA(),t.TgZ(84,"div",33),t._UZ(85,"input",38),t.qZA()(),t.TgZ(86,"div",35)(87,"div",30)(88,"label",14),t._uU(89,"Packing List"),t.qZA()(),t.TgZ(90,"div",31),t._UZ(91,"i",32),t.qZA(),t.TgZ(92,"div",33),t._UZ(93,"input",39),t.qZA()(),t.TgZ(94,"div",35)(95,"div",30)(96,"label",14),t._uU(97,"PDIR/TC/CoA"),t.qZA()(),t.TgZ(98,"div",31),t._UZ(99,"i",32),t.qZA(),t.TgZ(100,"div",33),t._UZ(101,"input",40),t.qZA()()()(),t._UZ(102,"hr",41),t.TgZ(103,"div",42)(104,"button",43),t.NdJ("click",function(){return n.dismissModel()}),t._uU(105," Save & Close "),t.qZA()()()()()),2&i&&(t.Q6J("formGroup",n.form),t.xp6(30),t.Q6J("items",n.transporterArr)("clearable",!1))},dependencies:[s._Y,s.Fj,s.wV,s.Wl,s.JJ,s.JL,s.sg,s.u,A.w9],styles:[".fa-caret-right[_ngcontent-%COMP%]{font-size:2rem!important;margin-right:4rem!important}.margin[_ngcontent-%COMP%]{margin-top:2.2rem;justify-content:flex-end}.separator[_ngcontent-%COMP%]{margin-top:4rem}"]})}return a})();var S=l(73634),q=l(86007),w=l(77609),v=l(73374),p=l(98977),M=l(16897),Z=l(88059),O=l(95346),P=l(14906),F=l(83344),I=l(59103);function J(a,c){1&a&&t._UZ(0,"div",68)}function Q(a,c){1&a&&t._UZ(0,"div",68)}function k(a,c){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.GRNQty,"1.2-2")," ")}}const b=function(){return{standalone:!0}};function L(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"input",69),t.NdJ("input",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.changeGRNQty(n.GRNLineNumber,n))})("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.GRNQty=n)})("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit,r=t.oxw();return t.KtG(r.grnQtyChange(n,o.GRNLineNumber))}),t.qZA()}if(2&a){const e=t.oxw().$implicit;t.Q6J("ngModel",e.GRNQty)("ngModelOptions",t.DdM(2,b))}}function Y(a,c){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.batchDate," ")}}function E(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"input",70),t.NdJ("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.batchDate=n)}),t.qZA()}if(2&a){const e=t.oxw().$implicit;t.Q6J("ngModel",e.batchDate)("ngModelOptions",t.DdM(2,b))}}function B(a,c){if(1&a&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"number"),t.qZA()),2&a){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",t.xi3(2,1,e.invoicedQty,"1.2-2")," ")}}function j(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"input",71),t.NdJ("input",function(){t.CHM(e);const n=t.oxw().$implicit,o=t.oxw();return t.KtG(o.setInvoiceQty(n.GRNLineNumber,n))})("ngModelChange",function(n){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.invoicedQty=n)}),t.qZA()}if(2&a){const e=t.oxw().$implicit;t.Q6J("ngModel",e.invoicedQty)("ngModelOptions",t.DdM(2,b))}}const f=function(){return["approve","view","generate","cancel"]},N=function(){return["view","generate","cancel"]};function z(a,c){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td",55,56)(7,"span",57),t._uU(8),t.qZA()(),t.TgZ(9,"td",55,58)(11,"span",57),t._uU(12),t.qZA()(),t.TgZ(13,"td")(14,"div",59)(15,"span",60),t._uU(16),t.ALo(17,"UOMUnitsMaster"),t.qZA(),t.TgZ(18,"span",61),t.YNc(19,J,1,0,"div",62),t.YNc(20,Q,1,0,"div",62),t.qZA()()(),t.TgZ(21,"td"),t._uU(22),t.ALo(23,"number"),t.qZA(),t.TgZ(24,"td")(25,"div",63),t.YNc(26,k,3,4,"span",64),t.YNc(27,L,1,3,"input",65),t.qZA()(),t.TgZ(28,"td")(29,"div",63),t.YNc(30,Y,2,1,"span",64),t.YNc(31,E,1,3,"input",66),t.qZA()(),t.TgZ(32,"td")(33,"div",63),t.YNc(34,B,3,4,"span",64),t.YNc(35,j,1,3,"input",67),t.qZA()(),t.TgZ(36,"td"),t._uU(37),t.qZA(),t.TgZ(38,"td"),t._uU(39),t.ALo(40,"number"),t.qZA()()),2&a){const e=c.$implicit,i=t.MAs(6),n=t.MAs(10),o=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.GRNLineNumber),t.xp6(2),t.Oqu(null==e?null:e.itemCode),t.xp6(1),t.Udp("width",i.clientWidth),t.xp6(2),t.Q6J("positionTarget",i)("ngbTooltip",e.itemName),t.xp6(1),t.hij(" ",null==e?null:e.itemName," "),t.xp6(1),t.Udp("width",n.clientWidth),t.xp6(2),t.Q6J("positionTarget",n)("ngbTooltip",e.itemDescription),t.xp6(1),t.hij(" ",null==e?null:e.itemDescription," "),t.xp6(3),t.Q6J("ngbTooltip",e.conversionOfUnits)("ngClass",e.UOM==e.secondaryUnit?"text-primary pointer":"text-secondary pointer"),t.xp6(1),t.hij(" ",t.lcZ(17,26,null==e?null:e.UOM)," "),t.xp6(3),t.Q6J("ngIf",e.secondaryUnit),t.xp6(1),t.Q6J("ngIf",!e.secondaryUnit),t.xp6(2),t.Oqu(t.xi3(23,28,null==e?null:e.balancedQty,"1.2-2")),t.xp6(4),t.Q6J("ngIf",t.DdM(34,f).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(35,f).includes(o.action)),t.xp6(3),t.Q6J("ngIf",t.DdM(36,f).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(37,f).includes(o.action)),t.xp6(3),t.Q6J("ngIf",t.DdM(38,N).includes(o.action)),t.xp6(1),t.Q6J("ngIf",!t.DdM(39,N).includes(o.action)),t.xp6(2),t.Oqu(null==e?null:e.purchaseRate),t.xp6(2),t.hij(" ",t.xi3(40,31,(null==e?null:e.purchaseRate)*(null!=e&&e.invoicedQty?null==e?null:e.invoicedQty:0),"1.2-2")," ")}}function H(a,c){1&a&&(t.TgZ(0,"div",72)(1,"div",45)(2,"span",73),t._uU(3,"GRN Remark "),t.qZA(),t._UZ(4,"input",74),t.qZA()())}function $(a,c){1&a&&(t.TgZ(0,"div",7)(1,"div",45)(2,"span",73),t._uU(3,"Reason for Cancellation "),t.qZA(),t._UZ(4,"input",75),t.qZA()())}function V(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"button",80),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.reset())}),t._uU(1," Reset "),t.qZA()}}function W(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"button",81),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.submit())}),t._uU(1," Save "),t.qZA()}}function K(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"div",82)(1,"button",81),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.submit())}),t._uU(2,"Approve"),t.qZA()()}}function X(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"div",82)(1,"button",81),t.NdJ("click",function(){t.CHM(e);const n=t.oxw(2);return t.KtG(n.openCancelModal())}),t._uU(2,"Cancel"),t.qZA()()}}const tt=function(){return["edit","generate","approve","cancel"]};function et(a,c){if(1&a&&(t.TgZ(0,"div",76)(1,"div"),t.YNc(2,V,2,0,"button",77),t.YNc(3,W,2,0,"button",78),t.qZA(),t.YNc(4,K,3,0,"div",79),t.YNc(5,X,3,0,"div",79),t.qZA()),2&a){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",!t.DdM(4,tt).includes(e.action)),t.xp6(1),t.Q6J("ngIf","approve"!=e.action&&"generate"!=e.action&&"cancel"!=e.action),t.xp6(1),t.Q6J("ngIf","approve"==e.action),t.xp6(1),t.Q6J("ngIf","cancel"==e.action)}}const nt=function(a,c,e,i){return{page:a,pageSize:c,collection:e,search:i,excelDisplay:"none"}};let it=(()=>{class a{get f(){return this.form.controls}constructor(e,i,n,o,r,d,m,gt){this.grnServices=e,this.activatedRoute=i,this.spinner=n,this.toastService=o,this.validationService=r,this.utilityService=d,this.modalService=m,this.location=gt,this.page=1,this.pageSize=5,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.flag=-1,this.submitted=!1,this.action="create",this.POFilter=[],this.selectedSupplierDetails={},this.GRNDetailsArray=[],this.masterData={autoIncrementNo:"",GRNQtyPercent:0,transporterOptions:[],suppliersOptions:[]},this.statusArr={create:"Awaiting Approval",edit:"Awaiting Approval",approve:"Approved",generate:"Report Generated",cancel:"Cancelled"},this.form=new s.nJ({_id:new s.p4(null),GRNNumber:new s.p4(null,[s.kI.required]),GRNDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD"),[s.kI.required]),PONumber:new s.p4(null,[s.kI.required]),PODate:new s.p4(null),supplier:new s.p4(null,[s.kI.required]),supplierInvoiceRef:new s.p4(null,[s.kI.required]),supplierInvoiceRefDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD"),[s.kI.required]),GRNStatus:new s.p4("Awaiting Approval",[s.kI.required]),remarks:new s.p4(null),transporterName:new s.p4(null),goodsDeliveryDate:new s.p4(this.utilityService.getTodayDate("YYYY-MM-DD")),freightChargesPaid:new s.p4(null),otherChargesPaid:new s.p4(null),AWB_LR_BR:new s.p4(null),GRNDetails:new s.p4([]),isTaxInvoice:new s.p4(!1),isEWayBill:new s.p4(!1),isDeliveryChallan:new s.p4(!1),isPackingList:new s.p4(!1),isCOATC:new s.p4(!1),deliveryLocation:new s.p4(null),cancellationReason:new s.p4(null),storageLocationMapping:new s.p4({})})}ngOnInit(){this.getInitialData()}submit(){if(this.GRNDetailsArray=this.GRNDetailsArray.filter(i=>i.GRNQty>0),this.submitted=!0,this.form.value.GRNDetails=this.GRNDetailsArray,this.validationService.checkErrors(this.form,U.BL))return;if(0==this.GRNDetailsArray.length)return void this.toastService.warning("Please select at least 1 Order");this.form.enable();let e=this.form.value;e.GRNDetails=this.GRNDetailsArray,"approve"==this.action&&e.GRNDetails.some(i=>i.invoicedQty<=0)?this.toastService.warning("Invoice quantity can not be zero"):e._id?this.update(e):(delete e._id,this.create(e))}update(e){this.spinner.show(),this.grnServices.update(e._id,e).subscribe(i=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(i.message),this.location.back()})}create(e){this.spinner.show(),this.grnServices.create(e).subscribe(i=>{this.submitted=!1,this.spinner.hide(),this.toastService.success(i.message),this.location.back()})}reset(){this.form.reset(),this.GRNDetailsArray=[],this.POFilter=[],this.collection=this.GRNDetailsArray.length,this.getInitialData()}trackByFn(e,i){return i?._id}getInitialData(){this.spinner.show(),this.spinner.show(),this.grnServices.getAllMasterData({}).subscribe(e=>{this.masterData=e,this.form.controls.GRNNumber.setValue(this.masterData?.autoIncrementNo),this.form.controls.GRNStatus.setValue("Awaiting Approval"),this.form.controls.goodsDeliveryDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.GRNDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.form.controls.supplierInvoiceRefDate.setValue(this.utilityService.getTodayDate("YYYY-MM-DD")),this.activatedRoute.queryParams.pipe((0,R.z)(i=>(this.action=i.action,this.utilityService.accessDenied(this.action),i.id?this.grnServices.getById(i.id):(0,x.of)({})))).subscribe(i=>{this.spinner.hide(),0!=Object.keys(i).length&&(this.GRNDetailsArray=i.GRNDetails.map((n,o)=>({POLineNumber:n.POLineNumber,GRNLineNumber:o+1,item:n?.item?._id,itemCode:n?.item?.itemCode,itemName:n?.item?.itemName,itemDescription:n?.item?.itemDescription,conversionOfUnits:n?.item?.conversionOfUnits,standardRate:n?.standardRate,purchaseRate:n?.purchaseRate,primaryUnit:n?.primaryUnit,secondaryUnit:n?.secondaryUnit,primaryToSecondaryConversion:n?.primaryToSecondaryConversion,secondaryToPrimaryConversion:n?.secondaryToPrimaryConversion,UOM:n.UOM?n.UOM:n.primaryUnit,POQty:n?.POQty,GRNQty:n?.GRNQty,invoicedQty:n?.invoicedQty,balancedQty:n?.balancedQty,receivedQty:n?.receivedQty,canceledQty:n?.canceledQty,batchDate:this.utilityService.getFormatDate(n?.batchDate,"YYYY-MM-DD")})),this.collection=this.GRNDetailsArray.length,this.POFilter=[{PONumber:i?.PONumber.PONumber,_id:i?.PONumber._id}],i.PONumber=i.PONumber._id,i.supplier=i.supplier._id,i.PODate&&(i.PODate=this.utilityService.getFormatDate(i.PODate,"YYYY-MM-DD")),i.GRNDate=this.utilityService.getFormatDate(i.GRNDate,"YYYY-MM-DD"),i.supplierInvoiceRefDate=this.utilityService.getFormatDate(i.supplierInvoiceRefDate,"YYYY-MM-DD"),i.GRNStatus=this.statusArr[this.action],this.form.patchValue(i),this.f.PONumber.disable(),this.f.supplier.disable(),"edit"!=this.action&&(this.form.disable(),"cancel"==this.action&&this.f.cancellationReason.enable()))}),this.spinner.hide()})}cancelGRN(){this.form.enable();let e=this.form.value;e.cancellationReason?(this.spinner.show(),this.grnServices.updateOnCancel(e._id,e).subscribe(i=>{this.spinner.hide(),this.submitted=!1,this.toastService.success(i.message),this.location.back()})):this.toastService.warning("Reason for Cancellation is Required")}openCancelModal(){const e=this.modalService.open(q.e,{centered:!0,size:"sm",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.heading="GRN Cancellation",e.componentInstance.cancelText="Do You Want to Cancel GRN ?",e.result.then(i=>{"Yes"==i&&this.cancelGRN()},i=>{})}getPONum(e){this.f.PONumber.setValue(null),this.f.PODate.setValue(null),this.f.deliveryLocation.setValue(null),this.GRNDetailsArray=[],this.collection=this.GRNDetailsArray.length,this.spinner.show(),this.grnServices.getPOBySupplierId(e?.value).subscribe(i=>{this.POFilter=i,this.spinner.hide()})}setTableDetails(e){this.f.PODate.setValue(this.utilityService.getFormatDate(e?.PODate,"YYYY-MM-DD")),this.f.deliveryLocation.setValue(e?.deliveryLocation),this.spinner.show(),this.grnServices.getGRNDetailsByPOId(e._id).subscribe(i=>{this.GRNDetailsArray=i.map((n,o)=>(n.GRNLineNumber=o+1,n)),this.collection=this.GRNDetailsArray.length,this.spinner.hide()})}setInvoiceQty(e,i){let n=this.GRNDetailsArray.map(o=>o.GRNLineNumber).indexOf(e);i.invoicedQty>i.balancedQty+i.balancedQty*+this.masterData.GRNQtyPercent&&(this.GRNDetailsArray[n].invoicedQty=0,this.toastService.warning(`Invoice Quantity '${i.invoicedQty}' cannot be greater than Balance Quantity '${i.balancedQty}'!Tolerance allowed is 50%.`))}changeGRNQty(e,i){let n=this.GRNDetailsArray.map(o=>o.GRNLineNumber).indexOf(e);i.GRNQty>i.balancedQty+i.balancedQty*+this.masterData.GRNQtyPercent&&(this.GRNDetailsArray[n].GRNQty=0,this.toastService.warning(`GRN Quantity '${i.GRNQty}' cannot be greater than Balance Quantity '${i.balancedQty}'!Tolerance allowed is 50%.`))}grnQtyChange(e,i){let n=this.GRNDetailsArray.map(o=>o.GRNLineNumber).indexOf(i);this.GRNDetailsArray[n].GRNQty=Math.abs(e)}setConversionOfUnit(e){let i=this.GRNDetailsArray.map(n=>n.GRNLineNumber).indexOf(e.GRNLineNumber);this.GRNDetailsArray[i].UOM=this.GRNDetailsArray[i].UOM==e.secondaryUnit?e.primaryUnit:e.secondaryUnit}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.flag=-1;break;case"EXCEL":default:break;case"PAGE":this.page=e.value}}onSort({column:e,direction:i}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.GRNDetailsArray=""===i||""===e?this.GRNDetailsArray:[...this.GRNDetailsArray].sort((n,o)=>{let r="string"==typeof n[e]?n[e].toLowerCase():n[e],d="string"==typeof o[e]?o[e].toLowerCase():o[e];const m=r<d?-1:r>d?1:0;return"asc"===i?m:-m})}openAditionalInfoModal(){const e=this.modalService.open(G,{centered:!0,size:"lg",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.transporterArr=this.masterData?.transporterOptions,e.componentInstance.receivedDocuments={isTaxInvoice:this.form.value.isTaxInvoice,isEWayBill:this.form.value.isEWayBill,isDeliveryChallan:this.form.value.isDeliveryChallan,isPackingList:this.form.value.isPackingList,isCOATC:this.form.value.isCOATC,goodsDeliveryDate:this.form.value.goodsDeliveryDate,transporterName:this.form.value.transporterName,AWB_LR_BR:this.form.value.AWB_LR_BR,freightChargesPaid:this.form.value.freightChargesPaid,otherChargesPaid:this.form.value.otherChargesPaid},e.result.then(i=>{this.form.patchValue(i)},i=>{})}openStorageLocationMappingModal(){const e=this.modalService.open(S.o,{centered:!0,size:"md",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.storageLocationMapping=this.form.value.storageLocationMapping,e.result.then(i=>{this.form.controls.storageLocationMapping.patchValue(i)},i=>{})}openSupplierDetailsModal(){const e=this.modalService.open(w.Nx,{centered:!0,size:"xl",backdrop:"static",keyboard:!1});e.componentInstance.action=this.action,e.componentInstance.selectedSupplierDetails=this.selectedSupplierDetails,e.componentInstance.supplierOptions=this.masterData.suppliersOptions,e.componentInstance.supplier=this.form.controls.supplier.value,e.result.then(i=>{i&&(this.selectedSupplierDetails=i?.selectedSupplierDetails,this.form.controls.supplier.setValue(i?.selectedSupplierDetails?._id),this.getPONum(this.selectedSupplierDetails))},i=>{})}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(v.zP),t.Y36(h.gz),t.Y36(p.V),t.Y36(p.kl),t.Y36(M.RJ),t.Y36(p.tI),t.Y36(g.FF),t.Y36(u.Ye))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-form"]],viewQuery:function(i,n){if(1&i&&t.Gf(_.j,5),2&i){let o;t.iGM(o=t.CRH())&&(n.headers=o)}},decls:102,vars:35,consts:[[1,"formCard","card",3,"formGroup"],[1,"container"],[1,"row","form-header"],[1,"col","heading"],[1,""],[1,"form-body"],[1,"row"],[1,"col-6"],[1,"col-3","pe-2"],[1,"form-label"],["type","text","formControlName","GRNNumber","readonly","",1,"form-control"],["type","date","formControlName","GRNDate",1,"form-control"],[1,"col-6","pe-5"],[1,"text-danger"],[1,"d-flex","align-items-center"],[1,"col-11"],["bindLabel","label","bindValue","value","formControlName","supplier","placeholder","Select a Supplier",3,"items","clearable","change"],["id","basic-addon1",1,"input-group-text","bg-primary","pointer","col-auto","fs-4",2,"height","2.9rem",3,"click"],["aria-hidden","true",1,"fa","fa-search","text-white"],[1,"col-3","ps-2"],["bindLabel","PONumber","bindValue","_id","formControlName","PONumber","placeholder","Select Purchase Order No.",3,"items","clearable","change"],["type","date","formControlName","PODate","readonly","",1,"form-control","pe-0"],["type","text","name","supplierInvoiceRef","formControlName","supplierInvoiceRef",1,"form-control"],["type","date","formControlName","supplierInvoiceRefDate",1,"form-control"],[1,"row","line-border"],[3,"data","dataChange"],[1,"table-responsive",2,"min-height","22rem"],[1,"table","table-bordered","table-sticky"],[1,"bg-primary"],[1,"text-white"],["sortable","GRNLineNumber",3,"sort"],["sortable","itemCode",3,"sort"],["sortable","itemName",1,"text-start",3,"sort"],["sortable","itemDescription",1,"text-start",3,"sort"],["sortable","UOM",3,"sort"],["sortable","balancedQty",3,"sort"],["sortable","GRNQty",3,"sort"],["sortable","batchDate",3,"sort"],["sortable","invoicedQty",3,"sort"],["sortable","purchaseRate",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-4"],[1,"d-flex","justify-content-end"],[1,"text-nowrap"],[1,"text-nowrap","bg-secondary","text-white","d-flex","align-items-center","px-3","fs-4","h-100"],[1,"d-flex"],["type","text","formControlName","deliveryLocation","readonly","",1,"form-control","border-end-0"],[1,"input-group-text","statusSpanHeight"],[1,"bomDocInfo","pointer",3,"click"],[1,"col-3"],["type","button",1,"btn","btn-primary","px-5","me-3",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],["class","col-4 ps-0 ms-0",4,"ngIf"],["class","col-6",4,"ngIf"],["class","col-md-auto ms-auto",4,"ngIf"],[1,"text-start"],["itemName",""],[1,"pointer",3,"positionTarget","ngbTooltip"],["itemDescription",""],[1,"d-flex","justify-content-between","px-2"],["placement","top",3,"ngbTooltip","ngClass"],[1,"pointer","d-flex","align-items-center"],["class","unit-switch-gray",4,"ngIf"],[1,"d-flex","justify-content-center"],[4,"ngIf"],["class","form-control form-control-sm w-75","type","number",3,"ngModel","ngModelOptions","input","ngModelChange",4,"ngIf"],["class","form-control form-control-sm w-75","type","date",3,"ngModel","ngModelOptions","ngModelChange",4,"ngIf"],["class","form-control form-control-sm w-25","type","number",3,"ngModel","ngModelOptions","input","ngModelChange",4,"ngIf"],[1,"unit-switch-gray"],["type","number",1,"form-control","form-control-sm","w-75",3,"ngModel","ngModelOptions","input","ngModelChange"],["type","date",1,"form-control","form-control-sm","w-75",3,"ngModel","ngModelOptions","ngModelChange"],["type","number",1,"form-control","form-control-sm","w-25",3,"ngModel","ngModelOptions","input","ngModelChange"],[1,"col-4","ps-0","ms-0"],[1,"text-nowrap","bg-primary","text-white","d-flex","align-items-center","px-3","fs-4"],["type","text","formControlName","remarks",1,"form-control","input-margin"],["type","text","formControlName","cancellationReason",1,"form-control","input-margin"],[1,"col-md-auto","ms-auto"],["class","btn btn-primary px-5 me-4","type","button",3,"click",4,"ngIf"],["type","button","class","btn btn-primary px-5",3,"click",4,"ngIf"],["class","content-end",4,"ngIf"],["type","button",1,"btn","btn-primary","px-5","me-4",3,"click"],["type","button",1,"btn","btn-primary","px-5",3,"click"],[1,"content-end"]],template:function(i,n){1&i&&(t.TgZ(0,"Form",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"label",4),t._uU(5),t.ALo(6,"titlecase"),t.qZA()()(),t.TgZ(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",6)(11,"div",8)(12,"label",9),t._uU(13,"GRN No."),t.qZA(),t._UZ(14,"input",10),t.qZA(),t.TgZ(15,"div",8)(16,"label",9),t._uU(17,"GRN Date"),t.qZA(),t._UZ(18,"input",11),t.qZA(),t.TgZ(19,"div",12)(20,"label",9),t._uU(21," Supplier Name"),t.TgZ(22,"span",13),t._uU(23,"*"),t.qZA()(),t.TgZ(24,"div",14)(25,"div",15)(26,"ng-select",16),t.NdJ("change",function(r){return n.getPONum(r)}),t.qZA()(),t.TgZ(27,"div",17),t.NdJ("click",function(){return n.openSupplierDetailsModal()}),t._UZ(28,"i",18),t.qZA()()()()(),t.TgZ(29,"div",7)(30,"div",6)(31,"div",19)(32,"label",9),t._uU(33,"PO No."),t.qZA(),t.TgZ(34,"ng-select",20),t.NdJ("change",function(r){return n.setTableDetails(r)}),t.qZA()(),t.TgZ(35,"div",19)(36,"label",9),t._uU(37,"PO Date"),t.qZA(),t._UZ(38,"input",21),t.qZA(),t.TgZ(39,"div",19)(40,"label",9),t._uU(41,"Supplier Inv. No."),t.qZA(),t._UZ(42,"input",22),t.qZA(),t.TgZ(43,"div",19)(44,"label",9),t._uU(45,"Supplier Inv. Dt."),t.qZA(),t._UZ(46,"input",23),t.qZA()()()(),t._UZ(47,"hr",24),t.TgZ(48,"app-setting-header",25),t.NdJ("dataChange",function(r){return n.eventHeader(r)}),t.qZA(),t.TgZ(49,"div",26)(50,"table",27)(51,"thead",28)(52,"tr",29)(53,"th",30),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(54,"SN"),t.qZA(),t.TgZ(55,"th",31),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(56,"Item Code"),t.qZA(),t.TgZ(57,"th",32),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(58,"Item Name"),t.qZA(),t.TgZ(59,"th",33),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(60," Item Description "),t.qZA(),t.TgZ(61,"th",34),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(62,"UoM"),t.qZA(),t.TgZ(63,"th",35),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(64,"PO Bal Qty"),t.qZA(),t.TgZ(65,"th",36),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(66,"GRN Qty"),t.qZA(),t.TgZ(67,"th",37),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(68,"Batch Dt"),t.qZA(),t.TgZ(69,"th",38),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(70,"Inv Qty"),t.qZA(),t.TgZ(71,"th",39),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(72),t.ALo(73,"companyCurrency"),t.qZA(),t.TgZ(74,"th",35),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(75),t.ALo(76,"companyCurrency"),t.qZA()()(),t.TgZ(77,"tbody"),t.YNc(78,z,41,40,"tr",40),t.ALo(79,"slice"),t.ALo(80,"searchFi1ter"),t.qZA()()(),t.TgZ(81,"div",6)(82,"div",41)(83,"div",42)(84,"div",43)(85,"span",44),t._uU(86),t.ALo(87,"labelTranslate"),t.qZA()(),t.TgZ(88,"div",45),t._UZ(89,"input",46),t.TgZ(90,"span",47)(91,"div",48),t.NdJ("click",function(){return n.openStorageLocationMappingModal()}),t.qZA()()()()()(),t._UZ(92,"hr",24),t.TgZ(93,"div",6)(94,"div",49)(95,"div")(96,"button",50),t.NdJ("click",function(){return n.openAditionalInfoModal()}),t._UZ(97,"i",51),t._uU(98," Addional Info "),t.qZA()()(),t.YNc(99,H,5,0,"div",52),t.YNc(100,$,5,0,"div",53),t.YNc(101,et,6,5,"div",54),t.qZA()()()()),2&i&&(t.Q6J("formGroup",n.form),t.xp6(5),t.hij("GRN (",t.lcZ(6,15,n.action),")"),t.xp6(21),t.Q6J("items",n.masterData.suppliersOptions)("clearable",!1),t.xp6(8),t.Q6J("items",n.POFilter)("clearable",!1),t.xp6(14),t.Q6J("data",t.l5B(30,nt,n.page,n.pageSize,n.collection,n.search)),t.xp6(24),t.hij(" Rate | ",t.lcZ(73,17,"INR")," "),t.xp6(3),t.hij(" Inv Amt | ",t.lcZ(76,19,"INR")," "),t.xp6(3),t.Q6J("ngForOf",t.Dn7(79,21,t.xi3(80,25,n.GRNDetailsArray,n.search),(n.page-1)*n.pageSize,(n.page-1)*n.pageSize+n.pageSize))("ngForTrackBy",n.trackByFn),t.xp6(8),t.hij(" ",t.lcZ(87,28,"Delivery Location")," "),t.xp6(13),t.Q6J("ngIf","cancel"!=n.action),t.xp6(1),t.Q6J("ngIf","cancel"==n.action),t.xp6(1),t.Q6J("ngIf","view"!=n.action))},dependencies:[u.mk,u.sg,u.O5,Z.P,g._L,s.Fj,s.wV,s.JJ,s.JL,s.sg,s.u,s.On,A.w9,_.j,u.OU,u.JJ,u.rS,O.G,P.c,F.f,I.S],styles:[".location[_ngcontent-%COMP%]{padding:0 3rem;border-radius:1.5px;border:.1px solid #302f2f!important;color:#555353!important;height:2.3rem;width:4rem;display:flex;align-items:center;justify-content:center;margin-top:0rem;margin-left:.2rem;font-size:1.3rem}.grn-location-btn-sm[_ngcontent-%COMP%]{margin-top:-.6rem!important;height:2.8rem;font-size:1.4rem!important}.input-margin[_ngcontent-%COMP%]{margin-top:.1rem}"]})}return a})();var C=l(25116),ot=l(31655),y=l(17645),D=l(53421);function rt(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",22,23)(11,"span",24),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td")(22,"div",25),t._UZ(23,"button",26),t.TgZ(24,"div",27)(25,"a",28),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"view"))}),t._UZ(26,"i",29),t._uU(27," View "),t.qZA(),t.TgZ(28,"a",28),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"edit"))}),t._UZ(29,"i",30),t._uU(30," Edit "),t.qZA(),t.TgZ(31,"a",28),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"approve"))}),t._UZ(32,"i",31),t._uU(33," Approve "),t.qZA(),t.TgZ(34,"a",28),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.update(o,"Report Generated"))}),t._UZ(35,"img",32),t._uU(36," Generate Report "),t.qZA()()()()()}if(2&a){const e=c.$implicit,i=t.MAs(10),n=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.GRNNumber),t.xp6(2),t.Oqu(null==e?null:e.GRNDateS),t.xp6(2),t.Oqu(null==e?null:e.PONumber),t.xp6(2),t.Oqu(null==e?null:e.PODate),t.xp6(1),t.Udp("width",i.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",e.supplier)("positionTarget",i),t.xp6(1),t.hij(" ",e.supplier," "),t.xp6(2),t.Oqu(null==e?null:e.supplierInvoiceRef),t.xp6(2),t.Oqu(null==e?null:e.supplierInvoiceRefDate),t.xp6(2),t.Oqu(null==e?null:e.deliveryLocation),t.xp6(2),t.Oqu(null==e?null:e.GRNStatus),t.xp6(5),t.Q6J("accessType",n.rolePermissionActions.viewAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.GRNStatus)||"Report Generated"===(null==e?null:e.GRNStatus)),t.Q6J("accessType",n.rolePermissionActions.editAction),t.xp6(3),t.ekj("disable","Approved"===(null==e?null:e.GRNStatus)||"edit"===(null==e?null:e.GRNStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction),t.xp6(3),t.ekj("disable","Awaiting Approval"===(null==e?null:e.GRNStatus)||"Report Generated"===(null==e?null:e.GRNStatus)),t.Q6J("accessType",n.rolePermissionActions.generateReportAction)}}const at=function(a,c,e,i){return{page:a,pageSize:c,collection:e,search:i,type:"list"}};let st=(()=>{class a{constructor(e,i,n,o,r,d,m){this.exportExcelService=e,this.grnServices=i,this.toastService=n,this.spinner=o,this.activatedRoute=r,this.exportToPDFService=d,this.utilityService=m,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Report Generated","Closed","Cancelled"],this.rolePermissionActions=C.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(e,i,n){this.utilityService.navigateToForm({path:e,status:i.GRNStatus,action:n,id:i._id,activatedRoute:this.activatedRoute})}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=e.value,this.getAll()}}update(e,i){"Approved"==e?.GRNStatus&&(this.spinner.show(),this.grnServices.update(e._id,{GRNStatus:i}).subscribe(n=>{this.toastService.success(n.message),this.getAll(),this.spinner.hide()}))}trackByFn(e,i){return i?._id}getAll(e=!1,i=""){this.spinner.show();let n={page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:e};this.subscription&&this.subscription.unsubscribe(),this.subscription=this.grnServices.getAll(n).subscribe(o=>{"EXCEL"==i?this.excelDownload(o.rows):"PDF"==i?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}pdfDownload(e){let i=(0,ot.Fh)(e);this.exportToPDFService.generatePdf(i.tableData,i.title)}excelDownload(e){this.exportExcelService.exportExcel((0,y.S8)(e))}onSort({column:e,direction:i}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.column=e,this.direction="asc"==i?1:-1,this.getAll()}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(p.Ol),t.Y36(v.zP),t.Y36(p.kl),t.Y36(p.V),t.Y36(h.gz),t.Y36(p.$L),t.Y36(p.tI))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-list"]],viewQuery:function(i,n){if(1&i&&t.Gf(_.j,5),2&i){let o;t.iGM(o=t.CRH())&&(n.headers=o)}},decls:36,vars:9,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],["appAccessControl","",1,"text-center",3,"accessType"],["type","button",1,"btn","btn-primary","btn-add",3,"click"],["aria-hidden","true",1,"fa","fa-plus-square","fa-lg","me-2"],[1,"line-border"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","GRNNumber",3,"sort"],["sortable","GRNDateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","PODate",3,"sort"],["sortable","supplier",1,"text-start",3,"sort"],["sortable","supplierInvoiceRef",3,"sort"],["sortable","supplierInvoiceRefDate",3,"sort"],["sortable","deliveryLocation",3,"sort"],["sortable","GRNStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplier",""],[1,"pointer",3,"ngbTooltip","positionTarget"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-eye","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-pencil-square-o","fa-lg","me-2","text-primary"],["aria-hidden","true",1,"fa","fa-check","fa-lg","me-2","text-success"],["src","./assets/images/new.svg","width","14",1,"me-2"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Goods Receipt Note [GRN] Summary"),t.qZA()(),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return n.navigateTo("../form",{},"create")}),t._UZ(6,"i",5),t._uU(7," Create Goods Receipt Note (GRN) "),t.qZA()(),t._UZ(8,"hr",6),t.TgZ(9,"div",7)(10,"app-setting-header",8),t.NdJ("dataChange",function(r){return n.eventHeader(r)}),t.qZA(),t.TgZ(11,"table",9)(12,"thead",10)(13,"tr",11)(14,"th",12),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(15,"GRN No."),t.qZA(),t.TgZ(16,"th",13),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(17,"GRN Dt."),t.qZA(),t.TgZ(18,"th",14),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(19,"PO No."),t.qZA(),t.TgZ(20,"th",15),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(21,"PO Date"),t.qZA(),t.TgZ(22,"th",16),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(23,"Supplier Name"),t.qZA(),t.TgZ(24,"th",17),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(25,"Supplier Inv. #"),t.qZA(),t.TgZ(26,"th",18),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(27,"Invoice Dt."),t.qZA(),t.TgZ(28,"th",19),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(29,"Location"),t.qZA(),t.TgZ(30,"th",20),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(31,"GRN Status"),t.qZA(),t.TgZ(32,"th"),t._uU(33,"Action"),t.qZA()()(),t.TgZ(34,"tbody"),t.YNc(35,rt,37,23,"tr",21),t.qZA()()()()),2&i&&(t.xp6(4),t.Q6J("accessType",n.rolePermissionActions.createAction),t.xp6(6),t.Q6J("data",t.l5B(4,at,n.page,n.pageSize,n.collection,n.search)),t.xp6(25),t.Q6J("ngForOf",n.tableData)("ngForTrackBy",n.trackByFn))},dependencies:[u.sg,Z.P,g._L,_.j,D.J],encapsulation:2})}return a})();var lt=l(65876);function ct(a,c){if(1&a){const e=t.EpF();t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td",18,19)(11,"span",20),t._uU(12),t.qZA()(),t.TgZ(13,"td"),t._uU(14),t.qZA(),t.TgZ(15,"td"),t._uU(16),t.qZA(),t.TgZ(17,"td"),t._uU(18),t.qZA(),t.TgZ(19,"td"),t._uU(20),t.qZA(),t.TgZ(21,"td")(22,"div",21),t._UZ(23,"button",22),t.TgZ(24,"div",23)(25,"a",24),t.NdJ("click",function(){const o=t.CHM(e).$implicit,r=t.oxw();return t.KtG(r.navigateTo("../form",o,"cancel"))}),t._UZ(26,"i",25),t._uU(27," Cancel "),t.qZA()()()()()}if(2&a){const e=c.$implicit,i=t.MAs(10),n=t.oxw();t.xp6(2),t.Oqu(null==e?null:e.GRNNumber),t.xp6(2),t.Oqu(null==e?null:e.GRNDateS),t.xp6(2),t.Oqu(null==e?null:e.PONumber),t.xp6(2),t.Oqu(null==e?null:e.PODate),t.xp6(1),t.Udp("width",i.clientWidth),t.xp6(2),t.Q6J("ngbTooltip",e.supplier)("positionTarget",i),t.xp6(1),t.hij(" ",e.supplier," "),t.xp6(2),t.Oqu(null==e?null:e.supplierInvoiceRef),t.xp6(2),t.Oqu(null==e?null:e.supplierInvoiceRefDate),t.xp6(2),t.Oqu(null==e?null:e.deliveryLocation),t.xp6(2),t.Oqu(null==e?null:e.GRNStatus),t.xp6(5),t.ekj("disable","Cancelled"===(null==e?null:e.GRNStatus)),t.Q6J("accessType",n.rolePermissionActions.approveAction)}}const pt=function(a,c,e,i){return{page:a,pageSize:c,collection:e,search:i,type:"list"}},dt=[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:st},{path:"form",component:it,resolve:{accessScreen:lt.x}},{path:"cancel_grn",component:(()=>{class a{constructor(e,i,n,o,r,d,m){this.exportExcelService=e,this.grnServices=i,this.toastService=n,this.router=o,this.spinner=r,this.activatedRoute=d,this.exportToPDFService=m,this.page=1,this.pageSize=8,this.collection=0,this.column="createdAt",this.direction=-1,this.search="",this.tableData=[],this.statusArray=["Awaiting Approval","Rejected","GRN Partial Created","GRN Created","Closed","Cancelled"],this.rolePermissionActions=C.a1}ngOnInit(){this.page=Number(this.activatedRoute.snapshot.queryParamMap.get("page")??1),this.getAll()}navigateTo(e,i,n){this.router.navigate([e],{relativeTo:this.activatedRoute,queryParams:{id:i?._id,action:n}})}eventHeader(e){switch(e.key){case"SEARCH":this.search=e.value,this.getAll();break;case"PDF":this.getAll(!0,"PDF");break;case"EXCEL":this.getAll(!0,"EXCEL");break;case"PAGE":this.page=e.value,this.getAll()}}update(e,i){"Approved"==e?.GRNStatus&&(this.spinner.show(),this.grnServices.update(e._id,{GRNStatus:i}).subscribe(n=>{this.toastService.success(n.message),this.getAll(),this.spinner.hide()}))}trackByFn(e,i){return i?._id}getAll(e=!1,i=""){this.spinner.show(),this.grnServices.getAll({page:this.page,pageSize:this.pageSize,search:this.search,column:this.column,direction:this.direction,statusArray:this.statusArray,excel:e}).subscribe(o=>{"EXCEL"==i?this.excelDownload(o.rows):"PDF"==i?this.pdfDownload(o.rows):(this.tableData=o.rows,this.collection=o.count),this.spinner.hide()})}pdfDownload(e){let i=(0,y.G1)(e);this.exportToPDFService.generatePdf(i.tableData,i.title)}excelDownload(e){this.exportExcelService.exportExcel((0,y.Fq)(e))}onSort({column:e,direction:i}){this.headers.forEach(n=>{n.sortable!==e&&(n.direction="")}),this.column=e,this.direction="asc"==i?1:-1,this.getAll()}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(p.Ol),t.Y36(v.zP),t.Y36(p.kl),t.Y36(h.F0),t.Y36(p.V),t.Y36(h.gz),t.Y36(p.$L))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-cancel-grn"]],viewQuery:function(i,n){if(1&i&&t.Gf(_.j,5),2&i){let o;t.iGM(o=t.CRH())&&(n.headers=o)}},decls:31,vars:8,consts:[[1,"listCard","card"],[1,"table-header"],[1,"heading"],[1,"table-responsive"],[3,"data","dataChange"],[1,"table","table-bordered"],[1,"bg-primary"],[1,"text-white"],["sortable","GRNNumber",3,"sort"],["sortable","GRNDateS",3,"sort"],["sortable","PONumber",3,"sort"],["sortable","PODate",3,"sort"],["sortable","supplier",1,"text-start",3,"sort"],["sortable","supplierInvoiceRef",3,"sort"],["sortable","supplierInvoiceRefDate",3,"sort"],["sortable","deliveryLocation",3,"sort"],["sortable","GRNStatus",3,"sort"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"text-start"],["supplier",""],[1,"pointer",3,"ngbTooltip","positionTarget"],[1,"dropdown"],[1,"dropbtn"],[1,"dropdown-content"],["appAccessControl","","href","javascript:void(0)",3,"accessType","click"],["aria-hidden","true",1,"fa","fa-close","fa-lg","text-primary"]],template:function(i,n){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"label",2),t._uU(3,"Cancellation [GRN] Summary"),t.qZA()(),t.TgZ(4,"div",3)(5,"app-setting-header",4),t.NdJ("dataChange",function(r){return n.eventHeader(r)}),t.qZA(),t.TgZ(6,"table",5)(7,"thead",6)(8,"tr",7)(9,"th",8),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(10,"GRN No."),t.qZA(),t.TgZ(11,"th",9),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(12,"GRN Dt."),t.qZA(),t.TgZ(13,"th",10),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(14,"PO No."),t.qZA(),t.TgZ(15,"th",11),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(16,"PO Date"),t.qZA(),t.TgZ(17,"th",12),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(18,"Supplier Name"),t.qZA(),t.TgZ(19,"th",13),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(20,"Supplier Inv. #"),t.qZA(),t.TgZ(21,"th",14),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(22,"Invoice Dt."),t.qZA(),t.TgZ(23,"th",15),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(24,"Location"),t.qZA(),t.TgZ(25,"th",16),t.NdJ("sort",function(r){return n.onSort(r)}),t._uU(26,"GRN Status"),t.qZA(),t.TgZ(27,"th"),t._uU(28,"Action"),t.qZA()()(),t.TgZ(29,"tbody"),t.YNc(30,ct,28,16,"tr",17),t.qZA()()()()),2&i&&(t.xp6(5),t.Q6J("data",t.l5B(3,pt,n.page,n.pageSize,n.collection,n.search)),t.xp6(25),t.Q6J("ngForOf",n.tableData)("ngForTrackBy",n.trackByFn))},dependencies:[u.sg,Z.P,g._L,_.j,D.J],encapsulation:2})}return a})()}];let mt=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#n=this.\u0275inj=t.cJS({imports:[h.Bz.forChild(dt),h.Bz]})}return a})();var ht=l(56208);let _t=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#n=this.\u0275inj=t.cJS({imports:[u.ez,mt,ht.m]})}return a})()}}]);