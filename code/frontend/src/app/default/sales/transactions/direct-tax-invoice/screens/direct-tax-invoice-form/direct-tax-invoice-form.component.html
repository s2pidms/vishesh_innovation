<Form class="px-2" [formGroup]="form" class="formCard card">
    <div class="set-remaining-margin">
        <div class="row form-header">
            <div class="col heading">
                <label>{{ this.action | titlecase }} Direct Tax Invoice</label>
            </div>
        </div>
        <div class="form-body">
            <div class="row mb-2">
                <div class="col-2">
                    <label class="form-label mb-0">Bill From Location<span class="text-danger"></span> </label>
                    <ng-select
                        [items]="masterData.billFromLocationOptions"
                        bindLabel="label"
                        bindValue="value"
                        [clearable]="false"
                        formControlName="billFromLocation"
                        (change)="setBillFromAddress($event)"
                    >
                    </ng-select>
                </div>
                <div class="col-2">
                    <label class="form-label mb-0"> Invoice # <span class="text-danger"></span> </label>
                    <input class="form-control" type="text" formControlName="DTICode" readonly />
                </div>

                <div class="col-2">
                    <label class="form-label mb-0"> Invoice Date <span class="text-danger"></span> </label>
                    <input class="form-control" type="date" formControlName="salesInvoiceDate" readonly />
                </div>

                <div class="col-3">
                    <label class="form-label mb-0"> Customer Category <span class="text-danger">*</span> </label>
                    <select class="form-select" formControlName="customerCategory" (change)="getCustomers()">
                        <option [value]="null" selected disabled>Select Category</option>
                        <option [value]="ele.value" *ngFor="let ele of masterData?.customerCategoryOptions">
                            {{ ele.label }}
                        </option>
                    </select>
                </div>

                <div class="col-3 pe-5">
                    <label class="form-label mb-0"> Customer Name <span class="text-danger">*</span> </label>

                    <div class="d-flex align-items-center">
                        <div class="col-11">
                            <ng-select
                                [items]="customerOptions"
                                bindLabel="customerName"
                                bindValue="customer"
                                [clearable]="false"
                                formControlName="customer"
                                (change)="customerValueChange($event)"
                            >
                            </ng-select>
                        </div>
                        <div
                            style="height: 2.9rem"
                            class="input-group-text bg-primary pointer col-auto fs-4"
                            id="basic-addon1"
                            (click)="openCustomersDetailsModal()"
                        >
                            <i class="fa fa-search text-white" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr class="row line-border mt-3" />

        <div class="">
            <app-setting-header
                [data]="{page,pageSize,collection,search, excelDisplay : 'none'}"
                (dataChange)="eventHeader($event)"
            >
            </app-setting-header>
        </div>

        <div class="table-responsive mt-0 text-wrap" style="min-height: 18.8rem">
            <table class="table table-bordered mt-0 table-sticky">
                <thead class="bg-info">
                    <tr class="text-white">
                        <th sortable="SKUNo" (sort)="onSort($event)">SKU No.</th>
                        <th class="text-start" sortable="SKUName" (sort)="onSort($event)">
                            {{ "SKU Name" | labelTranslate }}
                        </th>
                        <th class="text-start" sortable="SKUDescription" (sort)="onSort($event)">
                            {{ "SKU Description" | labelTranslate }}
                        </th>
                        <th sortable="unit" (sort)="onSort($event)">UoM</th>
                        <th sortable="dispatchQty" (sort)="onSort($event)">Qty.</th>
                        <th sortable="purchaseRate" (sort)="onSort($event)">Rate/Unit</th>
                        <th sortable="discount" (sort)="onSort($event)">Disc %</th>
                        <th sortable="salesInvoiceUnitRate" (sort)="onSort($event)">Net Rate</th>
                        <th sortable="salesInvoiceLineValue" (sort)="onSort($event)">Line Value</th>
                    </tr>
                </thead>

                <tbody>
                    <tr
                        *ngFor="
                            let d of DTIDetailsArray
                                | searchFi1ter : search
                                | slice : (page - 1) * pageSize : (page - 1) * pageSize + pageSize;
                            trackBy: trackByFn
                        "
                    >
                        <td>{{ d?.SKUNo }}</td>
                        <td class="text-start" [style.width]="SKUName.clientWidth" #SKUName>
                            <span class="pointer" [positionTarget]="SKUName" [ngbTooltip]="d.SKUName">
                                {{ d?.SKUName }}
                            </span>
                        </td>
                        <td class="text-start" [style.width]="SKUDescription.clientWidth" #SKUDescription>
                            <span class="pointer" [positionTarget]="SKUDescription" [ngbTooltip]="d.SKUDescription">
                                {{ d?.SKUDescription }}
                            </span>
                        </td>
                        <td>{{ d?.unit | SalesUOMUnitMaster }}</td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span *ngIf="['approval', 'rejection', 'view', 'generate', 'cancel'].includes(action)">
                                    {{ d?.dispatchQty | number : "1.2-2" }}
                                </span>
                                <input
                                    type="number"
                                    class="form-control form-control-sm w-25"
                                    *ngIf="!['approval', 'rejection', 'view', 'generate', 'cancel'].includes(action)"
                                    [(ngModel)]="d.dispatchQty"
                                    [ngModelOptions]="{standalone: true}"
                                    (input)="checkDispatchQty(d)"
                                />
                            </div>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span *ngIf="['approval', 'rejection', 'view', 'generate', 'cancel'].includes(action)">
                                    {{ d?.purchaseRate | number : "1.2-2" }}
                                </span>
                                <input
                                    type="number"
                                    class="form-control form-control-sm w-25"
                                    *ngIf="!['approval', 'rejection', 'view', 'generate', 'cancel'].includes(action)"
                                    [(ngModel)]="d.purchaseRate"
                                    [ngModelOptions]="{standalone: true}"
                                    (input)="checkDispatchQty(d)"
                                />
                            </div>
                        </td>
                        <td>
                            <div class="d-flex justify-content-center">
                                <span *ngIf="['approval', 'rejection', 'view', 'generate', 'cancel'].includes(action)">
                                    {{ d?.discount | number : ".2-2" }}
                                </span>
                                <input
                                    type="number"
                                    class="form-control form-control-xs w-25"
                                    *ngIf="!['approval', 'rejection', 'view', 'generate', 'cancel'].includes(action)"
                                    [(ngModel)]="d.discount"
                                    [ngModelOptions]="{standalone: true}"
                                    (input)="setNetRate(d.DTILineNumber, d)"
                                />
                            </div>
                        </td>
                        <td>{{ d?.salesInvoiceUnitRate | number : "1.2-2" }}</td>
                        <td>{{ d?.salesInvoiceLineValue | number : "1.2-2" }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <hr class="row line-border" />
        <ng-container>
            <div class="col-md-12 d-flex">
                <div class="d-flex justify-content-center">
                    <div class="col-form-label text-nowrap pe-1 pt-0">
                        Product Value:
                        <button type="button" class="btn btn-info py-1 ms-2">
                            {{ "INR" | companyCurrency }}
                        </button>
                    </div>
                    <input class="form-control" type="number" formControlName="DTIValue" readonly />
                </div>
                <div class="d-flex justify-content-center">
                    <div class="mx-2 align-self-center mb-2">
                        <i class="fa fa-plus fa-lg text-info" aria-hidden="true"></i>
                    </div>
                    <div class="text-nowrap">
                        <button
                            type="button "
                            class="btn btn-sm btn-primary me-2 d-flex align-items-center mb-2"
                            (click)="openShipmentDetailsModal()"
                        >
                            <span>Add other charges</span>
                        </button>
                    </div>

                    <div class="d-flex inputGroup">
                        <input
                            type="text"
                            class="form-control mt-0 w-25"
                            readOnly
                            [(ngModel)]="otherCharges.totalAmount"
                            [ngModelOptions]="{standalone: true}"
                        />
                    </div>
                </div>
                <div class="d-flex inputGroup"></div>
                <div class="mx-2 align-text-top">
                    <div class="fs-3 fw-bolder text-info me-2" aria-hidden="true">=</div>
                </div>
                <div class="d-flex justify-content-center">
                    <div class="col-form-label text-nowrap pe-1 pt-0">
                        Direct Tax Invoice Value:
                        <button type="button" class="btn btn-info py-1 ms-2">
                            {{ "INR" | companyCurrency }}
                        </button>
                    </div>
                    <input class="form-control" type="number" formControlName="salesInvoiceTotalAmount" readonly />
                </div>
            </div>

            <hr class="row line-border mt-2" />

            <div class="row d-flex justify-content-between align-items-center mb-3">
                <div class="col-2 d-flex justify-content-start align-items-end">
                    <button class="btn btn-primary px-4" type="button" (click)="openViewDRNTermsModal()">
                        Tax Invoice Details
                    </button>
                </div>
                <div class="col-md-auto ms-auto">
                    <div *ngIf="['create'].includes(action)" class="d-grid gap-2 d-md-block">
                        <button class="btn btn-primary px-5 me-4" (click)="reset()">Reset</button>
                        <button class="btn btn-primary px-4 me-4" (click)="preview()">Preview</button>
                        <button class="btn btn-primary px-5" type="button" (click)="submit()" [disabled]="!isPreview">
                            Save
                        </button>
                    </div>
                    <div *ngIf="['edit'].includes(action)" class="d-grid gap-2 d-md-block">
                        <button type="button" class="btn btn-primary px-5" (click)="submit()">Save</button>
                    </div>
                    <div *ngIf="action == 'rejection'" class="content-end">
                        <button class="btn btn-primary px-5" type="button" (click)="submit()">Reject</button>
                    </div>
                    <div *ngIf="action == 'approval'" class="content-end">
                        <button class="btn btn-primary px-5" type="button" (click)="submit()">Approve</button>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>
</Form>
